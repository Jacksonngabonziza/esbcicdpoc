<application guid="PACS008_TO_MT103" version="1.0"><display name="PACS008_To_MT103" categories="ISO20022.MX_To_MT" /><Metadata productVersion="12" buildNo="12350" createdBy="admin" /><creation date="26-02-2021 12:11:32" lastModifiedDate="08-09-2022 14:55:37" authors="eStudio" schema-version="2.0" /><deployment label="Development" /><deleteDestinationAfterStop value="Fetch_From_FES" /><storeSourceContext value="false" /><durableRoute value="Fetch_From_FES" /><service-instances><inst name="SwiftTranslator"><service guid="Xslt" version="4.0" /><short-description>Transforms input XML based on Mappings defined and generates an output XML</short-description><long-description>Transforms input XML based on Mappings defined and generates an output XML</long-description><config-file name="SwiftTranslator.xml" /><resource-properties><resource-property name="XSL">&lt;?xml version="1.0" encoding="UTF-8"?>
&lt;xsl:stylesheet version="1.0" xmlns:xalan="http://xml.apache.org/xslt" xmlns:datetime="http://exslt.org/dates-and-times" xmlns:math="http://exslt.org/math" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:lxslt="http://xml.apache.org/xslt" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:java="http://xml.apache.org/xslt/java" xmlns:set="http://exslt.org/sets" exclude-result-prefixes="xalan java lxslt" xmlns:ns4="urn:iso:std:iso:20022:tech:xsd:head.001.001.02" xmlns:ns2="http://www.w3.org/2001/XMLSchema" xmlns:ns5="urn:swift:xsd:mtmsg.2020" xmlns:ns6="urn:swift:xsd:fin.103.2020" xmlns:ns1="urn:swift:xsd:envelope" xmlns:ns3="urn:iso:std:iso:20022:tech:xsd:pacs.008.001.08" xmlns:MX2MT="http://xml.apache.org/xslt/java" xmlns:MXToMT="http://xml.apache.org/xslt/java" xmlns:MXtoMT="http://xml.apache.org/xslt/java" xmlns:QueryGenerator="QueryGenerator" xmlns:dateConversion="dateConversion" xmlns:myext="myext" xmlns:strings="strings" extension-element-prefixes="datetime set math MX2MT MXToMT MXtoMT QueryGenerator dateConversion myext strings">
  &lt;xsl:import href="GLOBAL_FUNCLET_PATH">&lt;/xsl:import>
  &lt;xsl:output method="xml" indent="yes" encoding="UTF-8" xalan:indent-amount="2" omit-xml-declaration="no">&lt;/xsl:output>
  &lt;xsl:variable name="document" select="/">&lt;/xsl:variable>
  &lt;xsl:variable name="document_IN_PORT" select="document('IN_PORT')">&lt;/xsl:variable>&lt;xsl:variable name="LineSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFLINE'"/>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:variable name="VariableSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFVAR'"/>&#xd;
&lt;/xsl:variable>
  &lt;xsl:template match="/">
    &lt;ns5:FinMessage>
      &lt;ns5:Block1>&lt;ns5:ApplicationIdentifier>&#xd;
          &lt;xsl:value-of select="'F'">&lt;/xsl:value-of>&#xd;
        &lt;/ns5:ApplicationIdentifier>&#xd;
        &lt;ns5:ServiceIdentifier>&#xd;
          &lt;xsl:value-of select="'01'">&lt;/xsl:value-of>&#xd;
        &lt;/ns5:ServiceIdentifier>&#xd;
        &lt;ns5:LogicalTerminalAddress>&#xd;
          &lt;xsl:variable name="if0">&#xd;
            &lt;xsl:choose>&#xd;
              &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))">&#xd;
                &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:To/ns4:FIId/ns4:FinInstnId/ns4:BICFI">&lt;/xsl:value-of>&#xd;
              &lt;/xsl:when>&#xd;
              &lt;xsl:otherwise>&#xd;
                &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI">&lt;/xsl:value-of>&#xd;
              &lt;/xsl:otherwise>&#xd;
            &lt;/xsl:choose>&#xd;
          &lt;/xsl:variable>&#xd;
          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_BICFI_LogicalAddress(string($if0))">&lt;/xsl:value-of>&#xd;
        &lt;/ns5:LogicalTerminalAddress>&#xd;
 &lt;ns5:SessionNumber>&#xd;
	&lt;xsl:value-of select="substring(java:_getStringProperty($_TIF_MESSAGE_, 'SequenceNumber'),'1','4')"/>&#xd;
&lt;/ns5:SessionNumber>&#xd;
&lt;ns5:SequenceNumber>&#xd;
	&lt;xsl:value-of select="substring(java:_getStringProperty($_TIF_MESSAGE_, 'SequenceNumber'),'5','6')"/>&#xd;
&lt;/ns5:SequenceNumber>&#xd;
&#xd;
&lt;!--
        &lt;ns5:ApplicationIdentifier>
          &lt;xsl:value-of select="'F'">&lt;/xsl:value-of>
        &lt;/ns5:ApplicationIdentifier>
        &lt;ns5:ServiceIdentifier>
          &lt;xsl:value-of select="'01'">&lt;/xsl:value-of>
        &lt;/ns5:ServiceIdentifier>
        &lt;ns5:LogicalTerminalAddress>
          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_BICFI_LogicalAddress(string($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:To/ns4:FIId/ns4:FinInstnId/ns4:BICFI))">&lt;/xsl:value-of>
        &lt;/ns5:LogicalTerminalAddress>
        &lt;ns5:SessionNumber>
          &lt;xsl:value-of select="'0000'">&lt;/xsl:value-of>
        &lt;/ns5:SessionNumber>
        &lt;ns5:SequenceNumber>
          &lt;xsl:value-of select="'000000'">&lt;/xsl:value-of>
        &lt;/ns5:SequenceNumber>-->&lt;/ns5:Block1>
      &lt;ns5:Block2>&lt;!-- User code ends here -->&#xd;
&#xd;
        &lt;ns5:InputIdentifier>&#xd;
          &lt;xsl:variable name="if1">&#xd;
            &lt;xsl:choose>&#xd;
              &lt;xsl:when test="(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))=('I')">&#xd;
                &lt;xsl:value-of select="'I'">&lt;/xsl:value-of>&#xd;
              &lt;/xsl:when>&#xd;
            &lt;/xsl:choose>&#xd;
          &lt;/xsl:variable>&#xd;
          &lt;xsl:value-of select="$if1">&lt;/xsl:value-of>&#xd;
        &lt;/ns5:InputIdentifier>&#xd;
        &lt;ns5:MessageType>&#xd;
          &lt;xsl:variable name="if2">&#xd;
            &lt;xsl:choose>&#xd;
              &lt;xsl:when test="(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))=('I')">&#xd;
                &lt;xsl:value-of select="'103'">&lt;/xsl:value-of>&#xd;
              &lt;/xsl:when>&#xd;
            &lt;/xsl:choose>&#xd;
          &lt;/xsl:variable>&#xd;
          &lt;xsl:value-of select="$if2">&lt;/xsl:value-of>&#xd;
        &lt;/ns5:MessageType>&#xd;
        &lt;ns5:DestinationAddress>&#xd;
          &lt;xsl:variable name="if3">&#xd;
            &lt;xsl:choose>&#xd;
              &lt;xsl:when test="(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))=('I')">&#xd;
                &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_BICFI_LogicalAddress(string($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:To/ns4:FIId/ns4:FinInstnId/ns4:BICFI))">&lt;/xsl:value-of>&#xd;
              &lt;/xsl:when>&#xd;
            &lt;/xsl:choose>&#xd;
          &lt;/xsl:variable>&#xd;
          &lt;xsl:value-of select="$if3">&lt;/xsl:value-of>&#xd;
        &lt;/ns5:DestinationAddress>&#xd;
        &lt;ns5:MessagePriority>&#xd;
          &lt;xsl:variable name="if4">&#xd;
            &lt;xsl:choose>&#xd;
              &lt;xsl:when test="(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))=('I')">&#xd;
                &lt;xsl:variable name="if5">&#xd;
                  &lt;xsl:choose>&#xd;
                    &lt;xsl:when test="($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Prty)=('HIGH')">&#xd;
                      &lt;xsl:value-of select="'U'">&lt;/xsl:value-of>&#xd;
                    &lt;/xsl:when>&#xd;
                    &lt;xsl:otherwise>&#xd;
                      &lt;xsl:value-of select="'N'">&lt;/xsl:value-of>&#xd;
                    &lt;/xsl:otherwise>&#xd;
                  &lt;/xsl:choose>&#xd;
                &lt;/xsl:variable>&#xd;
                &lt;xsl:value-of select="$if5">&lt;/xsl:value-of>&#xd;
              &lt;/xsl:when>&#xd;
            &lt;/xsl:choose>&#xd;
          &lt;/xsl:variable>&#xd;
          &lt;xsl:value-of select="$if4">&lt;/xsl:value-of>&#xd;
        &lt;/ns5:MessagePriority>&#xd;
        &lt;ns5:OutputIdentifier>&#xd;
          &lt;xsl:variable name="if6">&#xd;
            &lt;xsl:choose>&#xd;
              &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))">&#xd;
                &lt;xsl:value-of select="'O'">&lt;/xsl:value-of>&#xd;
              &lt;/xsl:when>&#xd;
            &lt;/xsl:choose>&#xd;
          &lt;/xsl:variable>&#xd;
          &lt;xsl:value-of select="$if6">&lt;/xsl:value-of>&#xd;
        &lt;/ns5:OutputIdentifier>&#xd;
        &lt;ns5:MessageType>&#xd;
          &lt;xsl:variable name="if7">&#xd;
            &lt;xsl:choose>&#xd;
              &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))">&#xd;
                &lt;xsl:value-of select="'103'">&lt;/xsl:value-of>&#xd;
              &lt;/xsl:when>&#xd;
            &lt;/xsl:choose>&#xd;
          &lt;/xsl:variable>&#xd;
          &lt;xsl:value-of select="$if7">&lt;/xsl:value-of>&#xd;
        &lt;/ns5:MessageType>&#xd;
        &lt;ns5:InputTime>&#xd;
          &lt;xsl:variable name="if8">&#xd;
             &lt;xsl:choose>&#xd;
                &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputTime'))">&#xd;
                  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'OutputTime')">&lt;/xsl:value-of>&#xd;
                &lt;/xsl:when>&#xd;
				&#xd;
				 &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and (not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputTime'))))">&#xd;
                   &lt;xsl:value-of select="'0000'">&lt;/xsl:value-of>&#xd;
                &lt;/xsl:when>&#xd;
              &lt;/xsl:choose>&#xd;
          &lt;/xsl:variable>&#xd;
          &lt;xsl:value-of select="$if8">&lt;/xsl:value-of>&#xd;
        &lt;/ns5:InputTime>&#xd;
        &lt;ns5:MessageInputReference>&#xd;
          &lt;ns5:Date>&#xd;
            &lt;xsl:variable name="if9">&#xd;
                &lt;xsl:choose>&#xd;
                &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputDate'))">&#xd;
                  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'OutputDate')">&lt;/xsl:value-of>&#xd;
                &lt;/xsl:when>&#xd;
				&#xd;
				 &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and (not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputDate'))))">&#xd;
                   &lt;xsl:value-of select="'991231'">&lt;/xsl:value-of>&#xd;
                &lt;/xsl:when>&#xd;
              &lt;/xsl:choose>&#xd;
            &lt;/xsl:variable>&#xd;
            &lt;xsl:value-of select="$if9">&lt;/xsl:value-of>&#xd;
          &lt;/ns5:Date>&#xd;
          &lt;ns5:LTIdentifier>&#xd;
            &lt;xsl:variable name="if10">&#xd;
              &lt;xsl:choose>&#xd;
                &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))">&#xd;
                  &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_BICFI_LTIAddress(string($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI))">&lt;/xsl:value-of>&#xd;
                &lt;/xsl:when>&#xd;
              &lt;/xsl:choose>&#xd;
            &lt;/xsl:variable>&#xd;
            &lt;xsl:value-of select="$if10">&lt;/xsl:value-of>&#xd;
          &lt;/ns5:LTIdentifier>&#xd;
          &lt;ns5:BranchCode>&#xd;
            &lt;xsl:variable name="if11">&#xd;
              &lt;xsl:choose>&#xd;
                &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))">&#xd;
                  &lt;xsl:variable name="if12">&#xd;
                    &lt;xsl:choose>&#xd;
                      &lt;xsl:when test="(string-length($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI))&amp;gt;=('11')">&#xd;
                        &lt;xsl:value-of select="substring($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI,(string-length($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI))-('2'),string-length($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI))">&lt;/xsl:value-of>&#xd;
                      &lt;/xsl:when>&#xd;
                      &lt;xsl:otherwise>&#xd;
                        &lt;xsl:value-of select="'XXX'">&lt;/xsl:value-of>&#xd;
                      &lt;/xsl:otherwise>&#xd;
                    &lt;/xsl:choose>&#xd;
                  &lt;/xsl:variable>&#xd;
                  &lt;xsl:value-of select="$if12">&lt;/xsl:value-of>&#xd;
                &lt;/xsl:when>&#xd;
              &lt;/xsl:choose>&#xd;
            &lt;/xsl:variable>&#xd;
            &lt;xsl:value-of select="$if11">&lt;/xsl:value-of>&#xd;
          &lt;/ns5:BranchCode>&#xd;
          &lt;ns5:SessionNumber>&#xd;
            &lt;xsl:variable name="if13">&#xd;
              &lt;xsl:choose>&#xd;
                &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))">&#xd;
                  &lt;xsl:value-of select="substring(java:_getStringProperty($_TIF_MESSAGE_, 'SequenceNumber'),'1','4')"/>&#xd;
                &lt;/xsl:when>&#xd;
              &lt;/xsl:choose>&#xd;
            &lt;/xsl:variable>&#xd;
            &lt;xsl:value-of select="$if13">&lt;/xsl:value-of>&#xd;
          &lt;/ns5:SessionNumber>&#xd;
          &lt;ns5:ISN>&#xd;
            &lt;xsl:variable name="if14">&#xd;
              &lt;xsl:choose>&#xd;
                &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))">&#xd;
                  &lt;xsl:value-of select="substring(java:_getStringProperty($_TIF_MESSAGE_, 'SequenceNumber'),'5','6')"/>&#xd;
                &lt;/xsl:when>&#xd;
              &lt;/xsl:choose>&#xd;
            &lt;/xsl:variable>&#xd;
            &lt;xsl:value-of select="$if14">&lt;/xsl:value-of>&#xd;
          &lt;/ns5:ISN>&#xd;
        &lt;/ns5:MessageInputReference>&#xd;
        &lt;ns5:Date>&#xd;
          &lt;xsl:variable name="if15">&#xd;
              &lt;xsl:choose>&#xd;
                &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputDate'))">&#xd;
                  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'OutputDate')">&lt;/xsl:value-of>&#xd;
                &lt;/xsl:when>&#xd;
				&#xd;
				 &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and (not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputDate'))))">&#xd;
                   &lt;xsl:value-of select="'991231'">&lt;/xsl:value-of>&#xd;
                &lt;/xsl:when>&#xd;
              &lt;/xsl:choose>&#xd;
          &lt;/xsl:variable>&#xd;
          &lt;xsl:value-of select="$if15">&lt;/xsl:value-of>&#xd;
        &lt;/ns5:Date>&#xd;
        &lt;ns5:Time>&#xd;
          &lt;xsl:variable name="if16">&#xd;
           &lt;xsl:choose>&#xd;
                &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputTime'))">&#xd;
                  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'OutputTime')">&lt;/xsl:value-of>&#xd;
                &lt;/xsl:when>&#xd;
				&#xd;
				 &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and (not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputTime'))))">&#xd;
                   &lt;xsl:value-of select="'0000'">&lt;/xsl:value-of>&#xd;
                &lt;/xsl:when>&#xd;
              &lt;/xsl:choose>&#xd;
          &lt;/xsl:variable>&#xd;
          &lt;xsl:value-of select="$if16">&lt;/xsl:value-of>&#xd;
        &lt;/ns5:Time>&#xd;
        &lt;ns5:MessagePriority>&#xd;
          &lt;xsl:variable name="if17">&#xd;
            &lt;xsl:choose>&#xd;
              &lt;xsl:when test="((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))">&#xd;
                &lt;xsl:variable name="if18">&#xd;
                  &lt;xsl:choose>&#xd;
                    &lt;xsl:when test="($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Prty)=('HIGH')">&#xd;
                      &lt;xsl:value-of select="'U'">&lt;/xsl:value-of>&#xd;
                    &lt;/xsl:when>&#xd;
                    &lt;xsl:otherwise>&#xd;
                      &lt;xsl:value-of select="'N'">&lt;/xsl:value-of>&#xd;
                    &lt;/xsl:otherwise>&#xd;
                  &lt;/xsl:choose>&#xd;
                &lt;/xsl:variable>&#xd;
                &lt;xsl:value-of select="$if18">&lt;/xsl:value-of>&#xd;
              &lt;/xsl:when>&#xd;
            &lt;/xsl:choose>&#xd;
          &lt;/xsl:variable>&#xd;
          &lt;xsl:value-of select="$if17">&lt;/xsl:value-of>&#xd;
        &lt;/ns5:MessagePriority>&#xd;
&lt;!--
        &lt;xsl:if test="string-length('O')">
          &lt;ns5:OutputIdentifier>
            &lt;xsl:value-of select="'O'">&lt;/xsl:value-of>
          &lt;/ns5:OutputIdentifier>
        &lt;/xsl:if>
        &lt;xsl:if test="string-length('103')">
          &lt;ns5:MessageType>
            &lt;xsl:value-of select="'103'">&lt;/xsl:value-of>
          &lt;/ns5:MessageType>
        &lt;/xsl:if>
        &lt;xsl:if test="string-length('0000')">
          &lt;ns5:InputTime>
            &lt;xsl:value-of select="'0000'">&lt;/xsl:value-of>
          &lt;/ns5:InputTime>
        &lt;/xsl:if>
        &lt;ns5:MessageInputReference>
          &lt;ns5:Date>
            &lt;xsl:value-of select="'991231'">&lt;/xsl:value-of>
          &lt;/ns5:Date>
          &lt;ns5:LTIdentifier>
            &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_BICFI_LTIAddress(string($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI))">&lt;/xsl:value-of>
          &lt;/ns5:LTIdentifier>
          &lt;ns5:BranchCode>
            &lt;xsl:variable name="if0">
              &lt;xsl:choose>
                &lt;xsl:when test="(string-length($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI))&amp;gt;=('11')">
                  &lt;xsl:value-of select="substring($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI,(string-length($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI))-('2'))">&lt;/xsl:value-of>
                &lt;/xsl:when>
                &lt;xsl:otherwise>
                  &lt;xsl:value-of select="'XXX'">&lt;/xsl:value-of>
                &lt;/xsl:otherwise>
              &lt;/xsl:choose>
            &lt;/xsl:variable>
            &lt;xsl:value-of select="$if0">&lt;/xsl:value-of>
          &lt;/ns5:BranchCode>
          &lt;ns5:SessionNumber>
            &lt;xsl:value-of select="'0000'">&lt;/xsl:value-of>
          &lt;/ns5:SessionNumber>
          &lt;ns5:ISN>
            &lt;xsl:value-of select="'000000'">&lt;/xsl:value-of>
          &lt;/ns5:ISN>
        &lt;/ns5:MessageInputReference>
        &lt;xsl:if test="string-length('991231')">
          &lt;ns5:Date>
            &lt;xsl:value-of select="'991231'">&lt;/xsl:value-of>
          &lt;/ns5:Date>
        &lt;/xsl:if>
        &lt;xsl:if test="string-length('0000')">
          &lt;ns5:Time>
            &lt;xsl:value-of select="'0000'">&lt;/xsl:value-of>
          &lt;/ns5:Time>
        &lt;/xsl:if>
        &lt;xsl:variable name="if1">
          &lt;xsl:choose>
            &lt;xsl:when test="($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Prty)=('HIGH')">
              &lt;xsl:value-of select="'U'">&lt;/xsl:value-of>
            &lt;/xsl:when>
            &lt;xsl:otherwise>
              &lt;xsl:value-of select="'N'">&lt;/xsl:value-of>
            &lt;/xsl:otherwise>
          &lt;/xsl:choose>
        &lt;/xsl:variable>
        &lt;xsl:if test="string-length($if1)">
          &lt;ns5:MessagePriority>
            &lt;xsl:variable name="if2">
              &lt;xsl:choose>
                &lt;xsl:when test="($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Prty)=('HIGH')">
                  &lt;xsl:value-of select="'U'">&lt;/xsl:value-of>
                &lt;/xsl:when>
                &lt;xsl:otherwise>
                  &lt;xsl:value-of select="'N'">&lt;/xsl:value-of>
                &lt;/xsl:otherwise>
              &lt;/xsl:choose>
            &lt;/xsl:variable>
            &lt;xsl:value-of select="$if2">&lt;/xsl:value-of>
          &lt;/ns5:MessagePriority>
        &lt;/xsl:if>-->&lt;/ns5:Block2>
      &lt;ns5:Block3>
        &lt;xsl:if test="string-length('')">
          &lt;ns5:F103>
            &lt;xsl:value-of select="''">&lt;/xsl:value-of>
          &lt;/ns5:F103>
        &lt;/xsl:if>
        &lt;ns5:F113>&lt;xsl:value-of select="java:_setBooleanProperty($_TIF_MESSAGE_, 'isIncludeAdditionalDetails', '1')">&lt;/xsl:value-of>&lt;/ns5:F113>
        &lt;xsl:variable name="if3">
          &lt;xsl:choose>
            &lt;xsl:when test="starts-with($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl/ns3:Cd,'G00')">
              &lt;xsl:value-of select="substring($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl/ns3:Cd,'2','3')">&lt;/xsl:value-of>
            &lt;/xsl:when>
          &lt;/xsl:choose>
        &lt;/xsl:variable>
        &lt;xsl:if test="string-length($if3)">
          &lt;ns5:F111>
            &lt;xsl:variable name="if4">
              &lt;xsl:choose>
                &lt;xsl:when test="starts-with($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl/ns3:Cd,'G00')">
                  &lt;xsl:value-of select="substring($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl/ns3:Cd,'2','3')">&lt;/xsl:value-of>
                &lt;/xsl:when>
              &lt;/xsl:choose>
            &lt;/xsl:variable>
            &lt;xsl:value-of select="$if4">&lt;/xsl:value-of>
          &lt;/ns5:F111>
        &lt;/xsl:if>
        &lt;xsl:if test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId/ns3:UETR)">
          &lt;ns5:F121>
            &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId/ns3:UETR">&lt;/xsl:value-of>
            &lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'UETR_ID', $document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId/ns3:UETR)">&lt;/xsl:value-of>
            &lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', '')">&lt;/xsl:value-of>
          &lt;/ns5:F121>
        &lt;/xsl:if>
      &lt;/ns5:Block3>
      &lt;ns5:Block4>
        &lt;ns6:Document>
          &lt;ns6:MT103>
            &lt;ns6:F20a>
              &lt;xsl:if test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId/ns3:InstrId)">
                &lt;ns6:F20>
                  &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId/ns3:InstrId">&lt;/xsl:value-of>
                &lt;/ns6:F20>
              &lt;/xsl:if>
            &lt;/ns6:F20a>&lt;xsl:variable name="MT13C">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:SttlmTmIndctn">&#xd;
	  &lt;xsl:if test="string-length(./ns3:DbtDtTm)">&#xd;
        &lt;xsl:value-of select="'SNDTIME'">&lt;/xsl:value-of>&#xd;
		&lt;xsl:value-of select="./ns3:DbtDtTm">&lt;/xsl:value-of>&#xd;
	    &lt;xsl:value-of select="$LineSeparator"/>&#xd;
      &lt;/xsl:if>&#xd;
	  &lt;xsl:if test="string-length(./ns3:CdtDtTm)">&#xd;
        &lt;xsl:value-of select="'RNCTIME'">&lt;/xsl:value-of>&#xd;
		&lt;xsl:value-of select="./ns3:CdtDtTm">&lt;/xsl:value-of>&#xd;
	    &lt;xsl:value-of select="$LineSeparator"/>&#xd;
      &lt;/xsl:if>&#xd;
	&lt;/xsl:for-each>&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:SttlmTmReq">&#xd;
	  &lt;xsl:if test="string-length(./ns3:CLSTm)">&#xd;
        &lt;xsl:value-of select="'CLSTIME'">&lt;/xsl:value-of>&#xd;
		&lt;xsl:value-of select="./ns3:CLSTm">&lt;/xsl:value-of>&#xd;
	    &lt;xsl:value-of select="$LineSeparator"/>&#xd;
      &lt;/xsl:if>&#xd;
	  &lt;xsl:if test="string-length(./ns3:TillTm)">&#xd;
        &lt;xsl:value-of select="'TILTIME'">&lt;/xsl:value-of>&#xd;
		&lt;xsl:value-of select="./ns3:TillTm">&lt;/xsl:value-of>&#xd;
	    &lt;xsl:value-of select="$LineSeparator"/>&#xd;
      &lt;/xsl:if>&#xd;
	  &lt;xsl:if test="string-length(./ns3:FrTm)">&#xd;
        &lt;xsl:value-of select="'FROTIME'">&lt;/xsl:value-of>&#xd;
		&lt;xsl:value-of select="./ns3:FrTm">&lt;/xsl:value-of>&#xd;
	    &lt;xsl:value-of select="$LineSeparator"/>&#xd;
      &lt;/xsl:if>&#xd;
	  &lt;xsl:if test="string-length(./ns3:RjctTm)">&#xd;
        &lt;xsl:value-of select="'REJTIME'">&lt;/xsl:value-of>&#xd;
		&lt;xsl:value-of select="./ns3:RjctTm">&lt;/xsl:value-of>&#xd;
      &lt;/xsl:if>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&#xd;
&lt;xsl:call-template name="tokenizeF13C">&#xd;
	&lt;xsl:with-param name="text" select="$MT13C"/>&#xd;
	&lt;xsl:with-param name="separator" select="$LineSeparator"/>&#xd;
&lt;/xsl:call-template>
            &lt;ns6:F13a>&lt;!-- User code starts here -->&lt;/ns6:F13a>
            &lt;ns6:F23a_1>
              &lt;xsl:if test="string-length('CRED')">
                &lt;ns6:F23B>
                  &lt;xsl:value-of select="'CRED'">&lt;/xsl:value-of>
                &lt;/ns6:F23B>
              &lt;/xsl:if>
            &lt;/ns6:F23a_1>
            &lt;ns6:F23a_2>
              &lt;ns6:F23E>
                &lt;ns6:InstructionCode>
                  &lt;xsl:variable name="if5">
                    &lt;xsl:choose>
                      &lt;xsl:when test="('SDVA')=($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl/ns3:Cd)">
                        &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl/ns3:Cd">&lt;/xsl:value-of>
                      &lt;/xsl:when>
                    &lt;/xsl:choose>
                  &lt;/xsl:variable>
                  &lt;xsl:value-of select="$if5">&lt;/xsl:value-of>
                &lt;/ns6:InstructionCode>
              &lt;/ns6:F23E>
            &lt;/ns6:F23a_2>&lt;xsl:if test="($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Prtry)=('INTC CORT')">&#xd;
  &lt;ns2:F23a_2>&#xd;
    &lt;ns2:F23E>&#xd;
      &lt;ns2:InstructionCode>&#xd;
	    &lt;xsl:value-of select="'INTC'">&lt;/xsl:value-of>&#xd;
	  &lt;/ns2:InstructionCode>&#xd;
    &lt;/ns2:F23E>&#xd;
  &lt;/ns2:F23a_2>&#xd;
  &lt;ns2:F23a_2>&#xd;
    &lt;ns2:F23E>&#xd;
      &lt;ns2:InstructionCode>&#xd;
	    &lt;xsl:value-of select="'CORT'">&lt;/xsl:value-of>&#xd;
	  &lt;/ns2:InstructionCode>&#xd;
    &lt;/ns2:F23E>&#xd;
  &lt;/ns2:F23a_2>&#xd;
&lt;/xsl:if>&#xd;
&#xd;
   &lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForCdtrAgt">&#xd;
  &lt;xsl:if test="string-length(./ns3:Cd)">&#xd;
&lt;ns2:F23a_2>&#xd;
    &lt;ns2:F23E>&#xd;
      &lt;ns2:InstructionCode>&#xd;
	    &lt;xsl:value-of select="./ns3:Cd">&lt;/xsl:value-of>&#xd;
	  &lt;/ns2:InstructionCode>&#xd;
	      &lt;ns2:AdditionalInformation>&#xd;
	    &lt;xsl:value-of select="./ns3:InstrInf">&lt;/xsl:value-of>&#xd;
	    &lt;/ns2:AdditionalInformation>&#xd;
    &lt;/ns2:F23E>&#xd;
  &lt;/ns2:F23a_2>&#xd;
   &lt;/xsl:if>&#xd;
&lt;/xsl:for-each>
            &lt;ns6:F23a_2>
              &lt;ns6:F23E>
                &lt;ns6:InstructionCode>
                  &lt;xsl:variable name="if6">
                    &lt;xsl:choose>
                      &lt;xsl:when test="(('INTC')=($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Cd) or ('CORT')=($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Cd))">
                        &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Cd">&lt;/xsl:value-of>
                      &lt;/xsl:when>
                    &lt;/xsl:choose>
                  &lt;/xsl:variable>
                  &lt;xsl:value-of select="$if6">&lt;/xsl:value-of>
                &lt;/ns6:InstructionCode>
              &lt;/ns6:F23E>
            &lt;/ns6:F23a_2>&lt;xsl:variable name="F23EFull">&#xd;
	&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT23E(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForCdtrAgt[1]/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForCdtrAgt[1]/ns3:InstrInf),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForCdtrAgt[2]/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForCdtrAgt[2]/ns3:InstrInf))">&lt;/xsl:value-of>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:call-template name="tokenizeF23E">&#xd;
	&lt;xsl:with-param name="text" select="$F23EFull"/>&#xd;
&lt;/xsl:call-template>
            &lt;ns6:F32a>
              &lt;ns6:F32A>
                &lt;ns6:Date>
                  &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTDate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrBkSttlmDt))">&lt;/xsl:value-of>
                &lt;/ns6:Date>
                &lt;ns6:Currency>
                  &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrBkSttlmAmt/@Ccy">&lt;/xsl:value-of>
                &lt;/ns6:Currency>
                &lt;ns6:Amount>
                  &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTCurrencyAmount(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrBkSttlmAmt))">&lt;/xsl:value-of>
                &lt;/ns6:Amount>
              &lt;/ns6:F32A>
            &lt;/ns6:F32a>&lt;xsl:if test="(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstdAmt)) and MX2MT:com.fiorano.funclet.MXtoMT.isEUCountry(string(substring($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI,'5','2'))) and MX2MT:com.fiorano.funclet.MXtoMT.isEUCountry(string(substring($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:To/ns4:FIId/ns4:FinInstnId/ns4:BICFI,'5','2'))))">&#xd;
  &lt;ns2:F33a>&#xd;
  &lt;ns2:F33B>&#xd;
    &lt;ns2:Currency>&#xd;
      &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrBkSttlmAmt/@Ccy">&lt;/xsl:value-of>&#xd;
    &lt;/ns2:Currency>&#xd;
    &lt;ns2:Amount>&#xd;
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTCurrencyAmount(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrBkSttlmAmt))">&lt;/xsl:value-of>&#xd;
    &lt;/ns2:Amount>&#xd;
  &lt;/ns2:F33B>&#xd;
  &lt;/ns2:F33a>&#xd;
&lt;/xsl:if>
            &lt;ns6:F33a>
              &lt;ns6:F33B>
                &lt;ns6:Currency>
                  &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstdAmt/@Ccy">&lt;/xsl:value-of>
                &lt;/ns6:Currency>
                &lt;ns6:Amount>
                  &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTCurrencyAmount(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstdAmt))">&lt;/xsl:value-of>
                &lt;/ns6:Amount>
              &lt;/ns6:F33B>
            &lt;/ns6:F33a>
            &lt;ns6:F36a>
              &lt;xsl:if test="string-length(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_Rate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:XchgRate)))">
                &lt;ns6:F36>
                  &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_Rate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:XchgRate))">&lt;/xsl:value-of>
                &lt;/ns6:F36>
              &lt;/xsl:if>
            &lt;/ns6:F36a>
            &lt;ns6:F50a>
              &lt;ns6:F50A>
                &lt;ns6:Account>&lt;xsl:variable name="if21">&#xd;
                    &lt;xsl:choose>&#xd;
                      &lt;xsl:when test="(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC) and string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr))">&#xd;
                        &lt;xsl:variable name="if22">&#xd;
                          &lt;xsl:choose>&#xd;
                            &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)">&#xd;
                              &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>&#xd;
                            &lt;/xsl:when>&#xd;
                          &lt;/xsl:choose>&#xd;
                        &lt;/xsl:variable>&#xd;
                       &lt;xsl:value-of select="normalize-space(substring-before($if22,'ENDOFOUTPUT'))"/>&#xd;
&lt;xsl:variable name="TruncTemp">&#xd;
  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F50A_Account_ENDOFFIELDTAG',substring-after($if22,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/> &#xd;
                      &lt;/xsl:when>&#xd;
                    &lt;/xsl:choose>&#xd;
                  &lt;/xsl:variable>&#xd;
                  &lt;xsl:value-of select="$if21">&lt;/xsl:value-of>&lt;/ns6:Account>
                &lt;ns6:IdentifierCode>
                  &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC">&lt;/xsl:value-of>
                &lt;/ns6:IdentifierCode>
              &lt;/ns6:F50A>
              &lt;ns6:F50F>
                &lt;ns6:PartyIdentifier>
                  &lt;ns6:Account>&lt;xsl:variable name="LineSeparator">
&lt;xsl:value-of select="'ENDOFFLINE'"/>
&lt;/xsl:variable>

&lt;xsl:variable name="VariableSeparator">
  &lt;xsl:value-of select="'ENDOFFVAR'"/>
&lt;/xsl:variable>

&lt;xsl:variable name="AppendedPostalAddress">
&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine">
&lt;xsl:value-of select="." />
 &lt;xsl:value-of select="$LineSeparator"/> 
&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name="OrgIdentifierTable">
&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr">
    &lt;xsl:value-of select="./ns3:Id"/>
    &lt;xsl:value-of select="$VariableSeparator"/>
    &lt;xsl:value-of select="./ns3:SchmeNm/ns3:Cd"/>
    &lt;xsl:value-of select="$VariableSeparator"/>
    &lt;xsl:value-of select="./ns3:Issr"/>
    &lt;xsl:value-of select="$VariableSeparator"/>
    &lt;xsl:value-of select="$LineSeparator"/>
  &lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name="PrivateOrgIdentifierTable">
&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr">
    &lt;xsl:value-of select="./ns3:Id"/>
    &lt;xsl:value-of select="$VariableSeparator"/>
    &lt;xsl:value-of select="./ns3:SchmeNm/ns3:Cd"/>
    &lt;xsl:value-of select="$VariableSeparator"/>
    &lt;xsl:value-of select="./ns3:Issr"/>
    &lt;xsl:value-of select="$VariableSeparator"/>
    &lt;xsl:value-of select="$LineSeparator"/>
  &lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name="ResultantMTAddressTable">
&lt;xsl:choose>
 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))">
                          &lt;xsl:value-of select="'NOTPROVIDEDENDOFOUTPUT'">&lt;/xsl:value-of>
                        &lt;/xsl:when>
            
             &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))">
             &lt;xsl:value-of select="'NOTPROVIDEDENDOFOUTPUT'">&lt;/xsl:value-of>
                        &lt;/xsl:when>
            
             &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))">
             &lt;xsl:value-of select="'NOTPROVIDEDENDOFOUTPUT'">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        
         &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))">
                           &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
            
             &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))">
             &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
            
             &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))">
             &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
            
               &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))">
                           &lt;xsl:value-of select="concat(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTAccountVal(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes)),'ENDOFOUTPUT')"/>
                        &lt;/xsl:when>
            
             &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))">
            &lt;xsl:value-of select="concat(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTAccountVal(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)),'ENDOFOUTPUT')"/>
                        &lt;/xsl:when>
            
             &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes)))">
            &lt;xsl:value-of select="concat(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTAccountVal(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes)),'ENDOFOUTPUT')"/>
                        &lt;/xsl:when>
                
      
&lt;/xsl:choose>
&lt;/xsl:variable>
&lt;xsl:value-of select="normalize-space(substring-before($ResultantMTAddressTable,'ENDOFOUTPUT'))"/>
&lt;xsl:variable name="TruncTemp">
  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>
&lt;/xsl:variable>

&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F50F_Account_ENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Account>
                  &lt;ns6:Code>&lt;xsl:variable name="LineSeparator">&#xd;
&lt;xsl:value-of select="'ENDOFFLINE'"/>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="VariableSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFFVAR'"/>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="AppendedPostalAddress">&#xd;
&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine">&#xd;
&lt;xsl:value-of select="." />&#xd;
 &lt;xsl:value-of select="$LineSeparator" /> &#xd;
&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="OrgIdentifierTable">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr">&#xd;
		&lt;xsl:value-of select="./ns3:Id"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:SchmeNm/ns3:Cd"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:Issr"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="PrivateOrgIdentifierTable">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr">&#xd;
		&lt;xsl:value-of select="./ns3:Id"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:SchmeNm/ns3:Cd"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:Issr"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&#xd;
&lt;xsl:choose>&#xd;
 &#xd;
												&#xd;
				 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))">&#xd;
                           &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTSchemeCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))"/>&#xd;
                        &lt;/xsl:when>&#xd;
						&#xd;
						 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))">&#xd;
						&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTSchemeCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))"/>&#xd;
                        &lt;/xsl:when>&#xd;
						&#xd;
						 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))">&#xd;
						&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTSchemeCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))"/>&#xd;
                        &lt;/xsl:when>&#xd;
						&#xd;
&lt;/xsl:choose>&lt;/ns6:Code>
                  &lt;ns6:CountryCode>&lt;xsl:variable name="LineSeparator">&#xd;
&lt;xsl:value-of select="'ENDOFFLINE'"/>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="VariableSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFFVAR'"/>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="AppendedPostalAddress">&#xd;
&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine">&#xd;
&lt;xsl:value-of select="." />&#xd;
 &lt;xsl:value-of select="$LineSeparator" /> &#xd;
&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="OrgIdentifierTable">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr">&#xd;
		&lt;xsl:value-of select="./ns3:Id"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:SchmeNm/ns3:Cd"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:Issr"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="PrivateOrgIdentifierTable">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr">&#xd;
		&lt;xsl:value-of select="./ns3:Id"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:SchmeNm/ns3:Cd"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:Issr"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&#xd;
&lt;xsl:choose>&#xd;
 &#xd;
												&#xd;
				 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))">&#xd;
                           &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTCountryCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))"/>&#xd;
                        &lt;/xsl:when>&#xd;
						&#xd;
						 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))">&#xd;
						&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTCountryCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))"/>&#xd;
                        &lt;/xsl:when>&#xd;
						&#xd;
						 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))">&#xd;
						&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTCountryCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))"/>&#xd;
                        &lt;/xsl:when>&#xd;
						&#xd;
&lt;/xsl:choose>&lt;/ns6:CountryCode>
                  &lt;ns6:Identifier>&lt;xsl:variable name="LineSeparator">&#xd;
&lt;xsl:value-of select="'ENDOFFLINE'"/>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="VariableSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFFVAR'"/>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="AppendedPostalAddress">&#xd;
&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine">&#xd;
&lt;xsl:value-of select="." />&#xd;
 &lt;xsl:value-of select="$LineSeparator" /> &#xd;
&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="OrgIdentifierTable">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr">&#xd;
		&lt;xsl:value-of select="./ns3:Id"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:SchmeNm/ns3:Cd"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:Issr"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="PrivateOrgIdentifierTable">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr">&#xd;
		&lt;xsl:value-of select="./ns3:Id"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:SchmeNm/ns3:Cd"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:Issr"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&#xd;
&lt;xsl:choose>&#xd;
 &#xd;
												&#xd;
				 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))">&#xd;
                           &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTPartyIdentifier(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))"/>&#xd;
                        &lt;/xsl:when>&#xd;
						&#xd;
						 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))">&#xd;
						&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTPartyIdentifier(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))"/>&#xd;
                        &lt;/xsl:when>&#xd;
						&#xd;
						 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))">&#xd;
						&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTPartyIdentifier(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))"/>&#xd;
                        &lt;/xsl:when>&#xd;
						&#xd;
&lt;/xsl:choose>&lt;/ns6:Identifier>
                &lt;/ns6:PartyIdentifier>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name="LineSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFLINE'"/>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:variable name="VariableSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFVAR'"/>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:variable name="AppendedPostalAddress">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine">&#xd;
		&lt;xsl:value-of select="."/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:variable name="OrgIdentifierTable">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr">&#xd;
		&lt;xsl:value-of select="./ns3:Id"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:SchmeNm/ns3:Cd"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:Issr"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:variable name="PrivateOrgIdentifierTable">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr">&#xd;
		&lt;xsl:value-of select="./ns3:Id"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:SchmeNm/ns3:Cd"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:Issr"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="MTPartyIndentifier">&#xd;
	&lt;xsl:choose>&#xd;
 &#xd;
												&#xd;
				 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))">&#xd;
                           &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTSchemeCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))"/>&#xd;
                        &lt;/xsl:when>&#xd;
						&#xd;
						 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))">&#xd;
						&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTSchemeCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))"/>&#xd;
                        &lt;/xsl:when>&#xd;
						&#xd;
								&#xd;
			&#xd;
&lt;/xsl:choose>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="ResultantMTAddressTable">&#xd;
	&lt;xsl:choose>&#xd;
	&#xd;
		&lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))">&#xd;
			&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFNameAndAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:LEI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:BirthDt),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:CityOfBirth),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:CtryOfBirth),string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes),string($MTPartyIndentifier),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry))"/>&#xd;
		&lt;/xsl:when>&#xd;
&#xd;
		 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))">&#xd;
		 &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFNameAndAddress2withTruncate(string($AppendedPostalAddress),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:LEI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:BirthDt),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:CityOfBirth),string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes),string($MTPartyIndentifier),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))"/>&#xd;
		&lt;/xsl:when>&#xd;
		&lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))">&#xd;
			&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFNameAndAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:LEI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:BirthDt),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:CityOfBirth),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:CtryOfBirth),string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes),string($MTPartyIndentifier),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry))"/>&#xd;
		&lt;/xsl:when>&#xd;
		&#xd;
	&#xd;
	&lt;/xsl:choose>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&#xd;
&lt;xsl:variable name="ResultantMTAddressSplit">&#xd;
&lt;xsl:choose>&#xd;
&lt;xsl:when test="(string-length($ResultantMTAddressTable))">&#xd;
	&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.SplitAddresstoNumberDetailswithTruncate(string($ResultantMTAddressTable),string($LineSeparator),string($VariableSeparator))"/>&#xd;
&lt;/xsl:when>&#xd;
&lt;/xsl:choose>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:call-template name="tokenize3">&#xd;
	&lt;xsl:with-param name="text" select="substring-before($ResultantMTAddressSplit,'ENDOFOUTPUT')"/>&#xd;
&lt;/xsl:call-template>&#xd;
&lt;xsl:variable name="TruncTemp">&#xd;
  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>&#xd;
&lt;/xsl:variable>
                  &lt;ns6:Lines2to5>&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F50F_NameAndAddress_Lines2to5ENDOFFIELDTAG',substring-after($ResultantMTAddressSplit,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Lines2to5>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F50F>
              &lt;ns6:F50K>
                &lt;ns6:Account>&lt;xsl:variable name="LineSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFFLINE'"/>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:variable name="VariableSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFFVAR'"/>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:variable name="AppendedPostalAddress">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine">&#xd;
		&lt;xsl:value-of select="."/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="ResultantMTAddressTable">&#xd;
&lt;xsl:choose>&#xd;
&#xd;
		 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))">&#xd;
		 &lt;xsl:value-of select="'ENDOFOUTPUT'"/>&#xd;
		&lt;/xsl:when>&#xd;
		&lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))">&#xd;
			&lt;xsl:value-of select="'ENDOFOUTPUT'"/>&#xd;
		&lt;/xsl:when>&#xd;
		&#xd;
		&lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))">&#xd;
			&lt;xsl:value-of select="'ENDOFOUTPUT'"/>&#xd;
		&lt;/xsl:when>&#xd;
		&#xd;
		&lt;xsl:when test="((not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))))">&#xd;
			&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>&#xd;
                      &lt;/xsl:when>&#xd;
                    &lt;/xsl:choose>&#xd;
                    &lt;/xsl:variable>&#xd;
&lt;xsl:value-of select="normalize-space(substring-before($ResultantMTAddressTable,'ENDOFOUTPUT'))"/>&#xd;
&lt;xsl:variable name="TruncTemp">&#xd;
  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F50K_Account_ENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Account>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name="LineSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFLINE'"/>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:variable name="VariableSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFFVAR'"/>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:variable name="AppendedPostalAddress">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine">&#xd;
		&lt;xsl:value-of select="."/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="ResultantMTAddressTable">&#xd;
&lt;xsl:choose>&#xd;
&#xd;
		 &lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))">&#xd;
		 &lt;xsl:value-of select="'ENDOFOUTPUT'"/>&#xd;
		&lt;/xsl:when>&#xd;
		&lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))">&#xd;
			&lt;xsl:value-of select="'ENDOFOUTPUT'"/>&#xd;
		&lt;/xsl:when>&#xd;
		&#xd;
		&lt;xsl:when test="(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))">&#xd;
			&lt;xsl:value-of select="'ENDOFOUTPUT'"/>&#xd;
		&lt;/xsl:when>&#xd;
		&#xd;
		&lt;xsl:when test="((not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)))">&#xd;
			&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTPartyNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm))"/>&#xd;
		&lt;/xsl:when>&#xd;
		&#xd;
		&lt;xsl:when test="((not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC))) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr)))">&#xd;
			&lt;xsl:value-of select="'NOTPROVIDEDENDOFOUTPUT'"/>&#xd;
		&lt;/xsl:when>&#xd;
		&lt;/xsl:choose>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&#xd;
&lt;xsl:call-template name="tokenizeLine">&#xd;
	&lt;xsl:with-param name="text" select="substring-before($ResultantMTAddressTable,'ENDOFOUTPUT')"/>&#xd;
&lt;/xsl:call-template>&#xd;
 &lt;xsl:variable name="TruncTemp">&#xd;
  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>&#xd;
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F50K_NameAndAddress_LineENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F50K>
            &lt;/ns6:F50a>
            &lt;ns6:F52a>&lt;xsl:if test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:BICFI)">
              &lt;ns6:F52A>
                &lt;xsl:variable name="if7">
                  &lt;xsl:choose>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test="string-length($if7)">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name="if8">
                      &lt;xsl:choose>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select="$if8">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:IdentifierCode>
                  &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:BICFI">&lt;/xsl:value-of>
                &lt;/ns6:IdentifierCode>
              &lt;/ns6:F52A>&lt;/xsl:if>&lt;xsl:if test="not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:BICFI))">
              &lt;ns6:F52D>
                &lt;xsl:variable name="if9">
                  &lt;xsl:choose>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test="string-length($if9)">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name="if10">
                      &lt;xsl:choose>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select="$if10">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name="AppendedPostalAddress">
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine">
		&lt;xsl:value-of select="."/>
		&lt;xsl:value-of select="$LineSeparator"/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name="if4">
  &lt;xsl:choose>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:Nm))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndStructuredAddresswithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($LineSeparator))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:Nm)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:Nm))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:otherwise>
      &lt;xsl:value-of select="'NOTPROVIDEDENDOFOUTPUT'">&lt;/xsl:value-of>
    &lt;/xsl:otherwise>
  &lt;/xsl:choose>
&lt;/xsl:variable>
					
&lt;xsl:call-template name="tokenizeLine">
	&lt;xsl:with-param name="text" select="substring-before($if4,'ENDOFOUTPUT')"/>
	&lt;xsl:with-param name="separator" select="$LineSeparator"/>
&lt;/xsl:call-template>
&lt;xsl:variable name="TruncTemp">
  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F52D_NameAndAddress_LineENDOFFIELDTAG',substring-after($if4,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F52D>&lt;/xsl:if>&lt;/ns6:F52a>
            &lt;ns6:F53a>&lt;xsl:if test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI)">
              &lt;ns6:F53A>
                &lt;xsl:variable name="if11">
                  &lt;xsl:choose>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test="string-length($if11)">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name="if12">
                      &lt;xsl:choose>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select="$if12">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:IdentifierCode>
                  &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI">&lt;/xsl:value-of>
                &lt;/ns6:IdentifierCode>
              &lt;/ns6:F53A>&lt;/xsl:if>&lt;xsl:if test="(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmMtd) and (($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmMtd)=('INDA') or ($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmMtd)=('INGA')))">
              &lt;ns6:F53B>&lt;xsl:if test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmAcct)">
                &lt;xsl:if test="string-length(MX2MT:com.fiorano.funclet.MXtoMT.mx2MTSettlementAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmMtd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd)))">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTSettlementAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmMtd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>&lt;/xsl:if>&lt;/ns6:F53B>&lt;/xsl:if>&lt;xsl:if test="(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI)))">
              &lt;ns6:F53D>
                &lt;xsl:variable name="if13">
                  &lt;xsl:choose>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test="string-length($if13)">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name="if14">
                      &lt;xsl:choose>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select="$if14">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name="LineSeparator">
	&lt;xsl:value-of select="'ENDOFLINE'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="AppendedPostalAddress">
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine">
		&lt;xsl:value-of select="."/>
		&lt;xsl:value-of select="$LineSeparator"/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name="if4">
&lt;xsl:choose>
&lt;xsl:when test="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmMtd='INGA' or $document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmMtd='INDA'">
&lt;xsl:value-of select="'ENDOFOUTPUT'"/>
    &lt;/xsl:when>
	&lt;xsl:otherwise>
  &lt;xsl:choose>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndStructuredAddresswithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($LineSeparator))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:Nm)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:otherwise>
      &lt;xsl:value-of select="'NOTPROVIDEDENDOFOUTPUT'">&lt;/xsl:value-of>
    &lt;/xsl:otherwise>
  &lt;/xsl:choose>
  &lt;/xsl:otherwise>
  &lt;/xsl:choose>
&lt;/xsl:variable>
					
&lt;xsl:call-template name="tokenizeLine">
	&lt;xsl:with-param name="text" select="substring-before($if4,'ENDOFOUTPUT')"/>
	&lt;xsl:with-param name="separator" select="$LineSeparator"/>
&lt;/xsl:call-template>
&lt;xsl:variable name="TruncTemp">
  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F53D_NameandAddress_Line_ENDOFFIELDTAG',substring-after($if4,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F53D>&lt;/xsl:if>&lt;/ns6:F53a>
            &lt;ns6:F54a>&lt;xsl:if test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI)">
              &lt;ns6:F54A>
                &lt;xsl:variable name="if15">
                  &lt;xsl:choose>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test="string-length($if15)">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name="if16">
                      &lt;xsl:choose>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select="$if16">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:IdentifierCode>
                  &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI">&lt;/xsl:value-of>
                &lt;/ns6:IdentifierCode>
              &lt;/ns6:F54A>&lt;/xsl:if>&lt;xsl:if test="(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI)))">&#xd;
&lt;xsl:if test="(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId)) and boolean(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))&amp;lt;('34') and (($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm) = ($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[1]))and not(starts-with($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm,'NOTPROVIDED')))">
              &lt;ns6:F54B>
                &lt;xsl:if test="string-length(concat('//',$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:value-of select="concat('//',$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm)">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>&lt;xsl:if test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[2]) and not (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[3]))">
                &lt;ns6:Location>&lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[2]">&lt;/xsl:value-of>&lt;/ns6:Location>&lt;/xsl:if>&lt;/ns6:F54B>&lt;/xsl:if>&#xd;
&lt;/xsl:if>&lt;xsl:if test="(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI)))">
              &lt;ns6:F54D>
                &lt;xsl:variable name="if17">
                  &lt;xsl:choose>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test="string-length($if17)">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name="if18">
                      &lt;xsl:choose>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select="$if18">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name="LineSeparator">
	&lt;xsl:value-of select="'ENDOFLINE'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="AppendedPostalAddress">
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine">
		&lt;xsl:value-of select="."/>
		&lt;xsl:value-of select="$LineSeparator"/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name="if4">
&lt;xsl:choose>
&lt;xsl:when test="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmMtd='INGA' or $document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmMtd='INDA'">
&lt;xsl:value-of select="'ENDOFOUTPUT'"/>
    &lt;/xsl:when>
	&lt;xsl:otherwise>
  &lt;xsl:choose>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndStructuredAddresswithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($LineSeparator))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:otherwise>
      &lt;xsl:value-of select="'NOTPROVIDEDENDOFOUTPUT'">&lt;/xsl:value-of>
    &lt;/xsl:otherwise>
  &lt;/xsl:choose>
  &lt;/xsl:otherwise>
  &lt;/xsl:choose>
&lt;/xsl:variable>
					
&lt;xsl:call-template name="tokenizeLine">
	&lt;xsl:with-param name="text" select="substring-before($if4,'ENDOFOUTPUT')"/>
	&lt;xsl:with-param name="separator" select="$LineSeparator"/>
&lt;/xsl:call-template>
&lt;xsl:variable name="TruncTemp">
  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F54D_NameAndAddress_LineENDOFFIELDTAG',substring-after($if4,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F54D>&lt;/xsl:if>&lt;/ns6:F54a>
            &lt;ns6:F55a>&lt;xsl:if test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI)">
              &lt;ns6:F55A>
                &lt;xsl:variable name="if19">
                  &lt;xsl:choose>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test="string-length($if19)">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name="if20">
                      &lt;xsl:choose>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select="$if20">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:IdentifierCode>
                  &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI">&lt;/xsl:value-of>
                &lt;/ns6:IdentifierCode>
              &lt;/ns6:F55A>&lt;/xsl:if>&lt;xsl:if test="(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI)))">&#xd;
&lt;xsl:if test="(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId)) and boolean(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))&amp;lt;('34') and not(starts-with($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm,'NOTPROVIDED')) and &#xd;
(($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm) = ($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[1])))">
              &lt;ns6:F55B>
                &lt;xsl:if test="string-length(concat('//',$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:value-of select="concat('//',$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm)">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:Location>&lt;xsl:choose>&#xd;
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[2]) and not (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[3])) and&#xd;
	string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm) and&#xd;
(($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm) = ($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[1]))">&#xd;
    &#xd;
&#xd;
&lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[2]">&lt;/xsl:value-of>&#xd;
    &lt;/xsl:when>&#xd;
	&lt;/xsl:choose>&lt;/ns6:Location>
              &lt;/ns6:F55B>&lt;/xsl:if>&#xd;
&lt;/xsl:if>&lt;xsl:if test="(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI)))">
              &lt;ns6:F55D>
                &lt;xsl:variable name="if21">
                  &lt;xsl:choose>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test="string-length($if21)">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name="if22">
                      &lt;xsl:choose>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select="$if22">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name="LineSeparator">
	&lt;xsl:value-of select="'ENDOFLINE'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="AppendedPostalAddress">
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine">
		&lt;xsl:value-of select="."/>
		&lt;xsl:value-of select="$LineSeparator"/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name="if4">
  &lt;xsl:choose>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndStructuredAddresswithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($LineSeparator))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:otherwise>
      &lt;xsl:value-of select="'NOTPROVIDEDENDOFOUTPUT'">&lt;/xsl:value-of>
    &lt;/xsl:otherwise>
  &lt;/xsl:choose>
&lt;/xsl:variable>
					
&lt;xsl:call-template name="tokenizeLine">
  &lt;xsl:with-param name="text" select="substring-before($if4,'ENDOFOUTPUT')"/>
	&lt;xsl:with-param name="separator" select="$LineSeparator"/>
&lt;/xsl:call-template>
&lt;xsl:variable name="TruncTemp">
  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F55D_NameandAddress_Line_ENDOFFIELDTAG',substring-after($if4,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F55D>&lt;/xsl:if>&lt;/ns6:F55a>
            &lt;ns6:F56a>&lt;xsl:if test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:BICFI)">
              &lt;ns6:F56A>
                &lt;xsl:variable name="if23">
                  &lt;xsl:choose>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:otherwise>
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifierChoice(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:ClrChanl),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                    &lt;/xsl:otherwise>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test="string-length($if23)">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name="if24">
                      &lt;xsl:choose>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:otherwise>
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifierChoice(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:ClrChanl),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                        &lt;/xsl:otherwise>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select="$if24">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:IdentifierCode>
                  &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:BICFI">&lt;/xsl:value-of>
                &lt;/ns6:IdentifierCode>
              &lt;/ns6:F56A>&lt;/xsl:if>&lt;xsl:if test="(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:BICFI)))">&#xd;
&lt;xsl:if test="not(starts-with($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:ClrChanl,'RTGS'))">&#xd;
&lt;xsl:if test="(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId)) and boolean(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm)) and ($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm)=($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm))&amp;lt;('34') and not(starts-with($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm,'NOTPROVIDED')))">
              &lt;xsl:if test="string-length(concat('//',$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm))">
                &lt;ns6:F56C>
                  &lt;xsl:value-of select="concat('//',$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm)">&lt;/xsl:value-of>
                &lt;/ns6:F56C>
              &lt;/xsl:if>&lt;/xsl:if>&#xd;
&lt;/xsl:if>&#xd;
&lt;/xsl:if>&lt;xsl:if test="(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:BICFI)))">
              &lt;ns6:F56D>
                &lt;xsl:variable name="if25">
                  &lt;xsl:choose>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifierChoice(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:ClrChanl),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:otherwise>
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifierChoice(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:ClrChanl),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                    &lt;/xsl:otherwise>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test="string-length($if25)">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name="if26">
                      &lt;xsl:choose>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifierChoice(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:ClrChanl),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:otherwise>
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifierChoice(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:ClrChanl),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                        &lt;/xsl:otherwise>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select="$if26">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name="AppendedPostalAddress">
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine">
		&lt;xsl:value-of select="."/>
		&lt;xsl:value-of select="$LineSeparator"/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name="if4">
  &lt;xsl:choose>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndStructuredAddresswithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($LineSeparator))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:otherwise>
      &lt;xsl:value-of select="'NOTPROVIDEDENDOFOUTPUT'">&lt;/xsl:value-of>
    &lt;/xsl:otherwise>
  &lt;/xsl:choose>
&lt;/xsl:variable>
					
&lt;xsl:call-template name="tokenizeLine">
	&lt;xsl:with-param name="text" select="substring-before($if4,'ENDOFOUTPUT')"/>
	&lt;xsl:with-param name="separator" select="$LineSeparator"/>
&lt;/xsl:call-template>
&lt;xsl:variable name="TruncTemp">
  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F56D_NameAndAddress_LineENDOFFIELDTAG',substring-after($if4,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F56D>&lt;/xsl:if>&lt;/ns6:F56a>
            &lt;ns6:F57a>&lt;xsl:if test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI)">
              &lt;ns6:F57A>
                &lt;xsl:variable name="if27">
                  &lt;xsl:choose>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:otherwise>
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifierChoice(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:ClrChanl),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                    &lt;/xsl:otherwise>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test="string-length($if27)">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name="if28">
                      &lt;xsl:choose>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:otherwise>
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifierChoice(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:ClrChanl),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                        &lt;/xsl:otherwise>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select="$if28">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:IdentifierCode>
                  &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI">&lt;/xsl:value-of>
                &lt;/ns6:IdentifierCode>
              &lt;/ns6:F57A>&lt;/xsl:if>&lt;xsl:if test="not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI))">&#xd;
&lt;xsl:if test="(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId)) and boolean(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm)) and ($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm)=($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm))&amp;lt;('34') and not(starts-with($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm,'NOTPROVIDED')))">&#xd;
&lt;xsl:choose>&#xd;
  &lt;xsl:when test="not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[2]))">&#xd;
    &lt;ns2:F57C>&#xd;
      &lt;xsl:value-of select="concat('//',$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm)">&lt;/xsl:value-of>&#xd;
	&lt;/ns2:F57C>&#xd;
  &lt;/xsl:when>&#xd;
  &lt;xsl:when test="not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[3]))">
              &lt;ns6:F57B>
                &lt;xsl:if test="string-length(concat('//',$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm))">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:value-of select="concat('//',$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm)">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:Location>&lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[2]">&lt;/xsl:value-of>&lt;/ns6:Location>
              &lt;/ns6:F57B>&lt;/xsl:when>&#xd;
&lt;/xsl:choose>&#xd;
&lt;/xsl:if>
              &lt;ns6:F57D>
                &lt;xsl:variable name="if29">
                  &lt;xsl:choose>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifierChoice(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:ClrChanl),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct)">
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:otherwise>
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifierChoice(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:ClrChanl),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                    &lt;/xsl:otherwise>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test="string-length($if29)">
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name="if30">
                      &lt;xsl:choose>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifierChoice(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:ClrChanl),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:when test="boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct)">
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))">&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:otherwise>
                          &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifierChoice(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:ClrChanl),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI))">&lt;/xsl:value-of>
                        &lt;/xsl:otherwise>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select="$if30">&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name="AppendedPostalAddress">
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine">
		&lt;xsl:value-of select="."/>
		&lt;xsl:value-of select="$LineSeparator"/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name="if4">
  &lt;xsl:choose>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndStructuredAddresswithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($LineSeparator))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test="string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm)">
      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm))">&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:otherwise>
      &lt;xsl:value-of select="'NOTPROVIDEDENDOFOUTPUT'">&lt;/xsl:value-of>
    &lt;/xsl:otherwise>
  &lt;/xsl:choose>
&lt;/xsl:variable>
					
&lt;xsl:call-template name="tokenizeLine">
	&lt;xsl:with-param name="text" select="substring-before($if4,'ENDOFOUTPUT')"/>
	&lt;xsl:with-param name="separator" select="$LineSeparator"/>
&lt;/xsl:call-template>
&lt;xsl:variable name="TruncTemp">
  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F57D_NameAndAddress_LineENDOFFIELDTAG',substring-after($if4,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F57D>&lt;/xsl:if>&lt;/ns6:F57a>
            &lt;ns6:F59a>&lt;xsl:variable name="LineSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFLINE'"/>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:variable name="VariableSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFVAR'"/>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:variable name="AppendedPostalAddress">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:AdrLine">&#xd;
		&lt;xsl:value-of select="."/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:variable name="F59aFlag">&#xd;
	&lt;xsl:choose>&#xd;
		&lt;xsl:when test="(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Id/ns3:OrgId/ns3:AnyBIC))))">&#xd;
			&lt;xsl:value-of select="'59ABIC'"/>&#xd;
			&lt;xsl:choose>&#xd;
				&lt;xsl:when test="(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct))))">&#xd;
					&lt;xsl:value-of select="'59AAccount'"/>&#xd;
				&lt;/xsl:when>&#xd;
			&lt;/xsl:choose>&#xd;
		&lt;/xsl:when>&#xd;
		&lt;xsl:when test="(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:Ctry))))">&#xd;
			&lt;xsl:value-of select="'59FPartyNameAndAddressLEI1'"/>&#xd;
			&lt;xsl:choose>&#xd;
				&lt;xsl:when test="(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct))))">&#xd;
					&lt;xsl:value-of select="'59FAccount'"/>&#xd;
				&lt;/xsl:when>&#xd;
			&lt;/xsl:choose>&#xd;
		&lt;/xsl:when>&#xd;
		&lt;xsl:when test="(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:AdrLine))))">&#xd;
			&lt;xsl:choose>&#xd;
				&lt;xsl:when test="(('true')=(MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator))))">&#xd;
					&lt;xsl:value-of select="'59FPartyNameAndAddressLEI2'"/>&#xd;
					&lt;xsl:choose>&#xd;
						&lt;xsl:when test="(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct))))">&#xd;
							&lt;xsl:value-of select="'59FAccount'"/>&#xd;
						&lt;/xsl:when>&#xd;
					&lt;/xsl:choose>&#xd;
				&lt;/xsl:when>&#xd;
				&lt;xsl:otherwise>&#xd;
					&lt;xsl:value-of select="'59PartyNameAndUnstructuredAddress'"/>&#xd;
					&lt;xsl:choose>&#xd;
						&lt;xsl:when test="(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct))))">&#xd;
							&lt;xsl:value-of select="'59Account'"/>&#xd;
						&lt;/xsl:when>&#xd;
					&lt;/xsl:choose>&#xd;
				&lt;/xsl:otherwise>&#xd;
			&lt;/xsl:choose>&#xd;
		&lt;/xsl:when>&#xd;
		&lt;xsl:when test="not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Nm)))">&#xd;
			&lt;xsl:value-of select="'59PartyNameAndUnstructuredAddress'"/>&#xd;
			&lt;xsl:choose>&#xd;
				&lt;xsl:when test="(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct))))">&#xd;
					&lt;xsl:value-of select="'59Account'"/>&#xd;
				&lt;/xsl:when>&#xd;
			&lt;/xsl:choose>&#xd;
		&lt;/xsl:when>&#xd;
		&lt;xsl:when test="not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr)))">&#xd;
			&lt;xsl:value-of select="'59PartyNameAndNOTPROVIDEDAddress'"/>&#xd;
			&lt;xsl:choose>&#xd;
				&lt;xsl:when test="(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct))))">&#xd;
					&lt;xsl:value-of select="'59Account'"/>&#xd;
				&lt;/xsl:when>&#xd;
			&lt;/xsl:choose>&#xd;
		&lt;/xsl:when>&#xd;
		&lt;xsl:otherwise>&#xd;
			&lt;xsl:value-of select="'false'"/>&#xd;
		&lt;/xsl:otherwise>&#xd;
	&lt;/xsl:choose>&#xd;
&lt;/xsl:variable>
              &lt;ns6:F59>
                &lt;ns6:Account>&lt;xsl:variable name="ResultantMTAddressTable">&#xd;
			&lt;xsl:choose>&#xd;
				&lt;xsl:when test="contains($F59aFlag,'59Account')">&#xd;
					&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))"/>&#xd;
				&lt;/xsl:when>&#xd;
			&lt;/xsl:choose>&#xd;
		&lt;/xsl:variable>&#xd;
		&lt;xsl:value-of select="normalize-space(substring-before($ResultantMTAddressTable,'ENDOFOUTPUT'))"/>&#xd;
		&lt;xsl:variable name="TruncTemp">&#xd;
			&lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>&#xd;
		&lt;/xsl:variable>&#xd;
		&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F59Account_ENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Account>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name="ResultantMTAddressTable">&#xd;
			&lt;xsl:choose>&#xd;
				&lt;xsl:when test="contains($F59aFlag,'59PartyNameAndUnstructuredAddress')">&#xd;
					&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTPartyNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Nm))"/>&#xd;
				&lt;/xsl:when>&#xd;
			&lt;/xsl:choose>&#xd;
			&lt;xsl:choose>&#xd;
				&lt;xsl:when test="contains($F59aFlag,'59PartyNameAndNOTPROVIDEDAddress')">&#xd;
					&lt;xsl:value-of select="'NOTPROVIDEDENDOFOUTPUT'"/>&#xd;
				&lt;/xsl:when>&#xd;
			&lt;/xsl:choose>&#xd;
		&lt;/xsl:variable>&#xd;
		&lt;xsl:call-template name="tokenizeLine">&#xd;
			&lt;xsl:with-param name="text" select="substring-before($ResultantMTAddressTable,'ENDOFOUTPUT')"/>&#xd;
		&lt;/xsl:call-template>&#xd;
		&lt;xsl:variable name="TruncTemp">&#xd;
			&lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>&#xd;
		&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F59_NameAndAddress_LineENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F59>
              &lt;ns6:F59A>
                &lt;ns6:Account>&lt;xsl:variable name="ResultantMTAddressTable">&#xd;
			&lt;xsl:choose>&#xd;
				&lt;xsl:when test="contains($F59aFlag,'59AAccount')">&#xd;
					&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))"/>&#xd;
				&lt;/xsl:when>&#xd;
			&lt;/xsl:choose>&#xd;
		&lt;/xsl:variable>&#xd;
		&lt;xsl:value-of select="normalize-space(substring-before($ResultantMTAddressTable,'ENDOFOUTPUT'))"/>&#xd;
		&lt;xsl:variable name="TruncTemp">&#xd;
			&lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>&#xd;
		&lt;/xsl:variable>&#xd;
		&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F59A_Account_ENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Account>
                &lt;ns6:IdentifierCode>&lt;xsl:choose>&#xd;
			&lt;xsl:when test="contains($F59aFlag,'59ABIC')">&#xd;
				&lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Id/ns3:OrgId/ns3:AnyBIC"/>&#xd;
			&lt;/xsl:when>&#xd;
		&lt;/xsl:choose>&lt;/ns6:IdentifierCode>
              &lt;/ns6:F59A>
              &lt;ns6:F59F>
                &lt;ns6:Account>&lt;xsl:variable name="ResultantMTAddressTable">&#xd;
			&lt;xsl:choose>&#xd;
				&lt;xsl:when test="contains($F59aFlag,'59FAccount')">&#xd;
					&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))"/>&#xd;
				&lt;/xsl:when>&#xd;
			&lt;/xsl:choose>&#xd;
		&lt;/xsl:variable>&#xd;
		&lt;xsl:value-of select="normalize-space(substring-before($ResultantMTAddressTable,'ENDOFOUTPUT'))"/>&#xd;
		&lt;xsl:variable name="TruncTemp">&#xd;
			&lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>&#xd;
		&lt;/xsl:variable>&#xd;
		&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F59F_Account_ENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Account>&lt;xsl:variable name="ResultantMTAddressTable">&#xd;
		&lt;xsl:choose>&#xd;
			&lt;xsl:when test="contains($F59aFlag,'59FPartyNameAndAddressLEI1')">&#xd;
				&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.SplitAddresstoNumberDetailswithTruncate(string(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTPartyNameAndAddressLEI1withTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Id/ns3:OrgId/ns3:LEI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:Ctry),string($LineSeparator))),string($LineSeparator),string($VariableSeparator))"/>&#xd;
			&lt;/xsl:when>&#xd;
			&lt;xsl:when test="contains($F59aFlag,'59FPartyNameAndAddressLEI2')">&#xd;
				&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.SplitAddresstoNumberDetailswithTruncate(string(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTPartyNameAndAddressLEI2withTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Id/ns3:OrgId/ns3:LEI))),string($LineSeparator),string($VariableSeparator))"/>&#xd;
			&lt;/xsl:when>&#xd;
		&lt;/xsl:choose>&#xd;
	&lt;/xsl:variable>&#xd;
	&lt;xsl:call-template name="tokenize4">&#xd;
		&lt;xsl:with-param name="text" select="substring-before($ResultantMTAddressTable,'ENDOFOUTPUT')"/>&#xd;
	&lt;/xsl:call-template>
                &lt;ns6:NumberNameAndAddressDetails>&lt;xsl:variable name="TruncTemp">&#xd;
	&lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>&#xd;
&lt;/xsl:variable>&#xd;
&lt;ns2:Number>&#xd;
	&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F59F_NumberNameAndAddressDetailsENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&#xd;
&lt;/ns2:Number>&lt;/ns6:NumberNameAndAddressDetails>
              &lt;/ns6:F59F>
            &lt;/ns6:F59a>
            &lt;ns6:F70a>
              &lt;ns6:F70>
                &lt;ns6:Narrative>&lt;xsl:variable name="F70">
	&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTRemittanceInformationwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RmtInf),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RltdRmtInf),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtCdtr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtDbtr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Purp),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Purp/ns3:Prtry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId/ns3:EndToEndId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RmtInf/ns3:Ustrd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RltdRmtInf/ns3:RmtId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RmtInf/ns3:Strd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtCdtr/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtCdtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtCdtr/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtCdtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtCdtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtDbtr/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtDbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtDbtr/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtDbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtDbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))">&lt;/xsl:value-of>
&lt;/xsl:variable>

&lt;xsl:call-template name="tokenizeLine">
	&lt;xsl:with-param name="text" select="substring-before($F70,'ENDOFOUTPUT')"/>
	&lt;xsl:with-param name="separator" select="$LineSeparator"/>
&lt;/xsl:call-template>

&lt;xsl:variable name="TruncTemp">
	&lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')">&lt;/xsl:value-of>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F70_Narative_LineENDOFFIELDTAG',substring-after($F70,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))">&lt;/xsl:value-of>&lt;/ns6:Line>
                &lt;/ns6:Narrative>
              &lt;/ns6:F70>
            &lt;/ns6:F70a>
            &lt;ns6:F71a_1>
              &lt;xsl:variable name="if31">
                &lt;xsl:choose>
                  &lt;xsl:when test="($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('CRED')">
                    &lt;xsl:value-of select="'BEN'">&lt;/xsl:value-of>
                  &lt;/xsl:when>
                  &lt;xsl:when test="($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('DEBT')">
                    &lt;xsl:value-of select="'OUR'">&lt;/xsl:value-of>
                  &lt;/xsl:when>
                  &lt;xsl:when test="($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('SHAR')">
                    &lt;xsl:value-of select="'SHA'">&lt;/xsl:value-of>
                  &lt;/xsl:when>
                &lt;/xsl:choose>
              &lt;/xsl:variable>
              &lt;xsl:if test="string-length($if31)">
                &lt;ns6:F71A>
                  &lt;xsl:variable name="if32">
                    &lt;xsl:choose>
                      &lt;xsl:when test="($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('CRED')">
                        &lt;xsl:value-of select="'BEN'">&lt;/xsl:value-of>
                      &lt;/xsl:when>
                      &lt;xsl:when test="($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('DEBT')">
                        &lt;xsl:value-of select="'OUR'">&lt;/xsl:value-of>
                      &lt;/xsl:when>
                      &lt;xsl:when test="($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('SHAR')">
                        &lt;xsl:value-of select="'SHA'">&lt;/xsl:value-of>
                      &lt;/xsl:when>
                    &lt;/xsl:choose>
                  &lt;/xsl:variable>
                  &lt;xsl:value-of select="$if32">&lt;/xsl:value-of>
                &lt;/ns6:F71A>
              &lt;/xsl:if>
            &lt;/ns6:F71a_1>&lt;xsl:variable name="LineSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFLINE'"/>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="VariableSeparator">&#xd;
	&lt;xsl:value-of select="'ENDOFVAR'"/>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="AppendedAmount">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgsInf">&#xd;
		&lt;xsl:value-of select="./ns3:Amt"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:Amt/@Ccy"/>&#xd;
		&lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="Result">&#xd;
&lt;xsl:choose>&#xd;
&lt;xsl:when test="(($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('CRED') or&#xd;
($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('SHAR'))">&#xd;
&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAmountTable71F_pac4to103(string($AppendedAmount),string($LineSeparator),string($VariableSeparator))">&lt;/xsl:value-of>&#xd;
&lt;/xsl:when>&#xd;
&lt;/xsl:choose>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&#xd;
&lt;xsl:call-template name="tokenize7">&#xd;
	&lt;xsl:with-param name="text" select="$Result"/>&#xd;
&lt;/xsl:call-template>
            &lt;ns6:F71a_2>&lt;!-- User code starts here -->&lt;/ns6:F71a_2>
            &lt;ns6:F71a_3>
              &lt;ns6:F71G>&lt;xsl:if test="(($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('DEBT') and string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgsInf/ns3:Amt))">&#xd;
&#xd;
&lt;xsl:variable name="MT71G">&#xd;
    &lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgsInf">&#xd;
        &lt;xsl:value-of select="./ns3:Amt/@Ccy">&lt;/xsl:value-of>&#xd;
	    &lt;xsl:value-of select="$VariableSeparator"/>&#xd;
		&lt;xsl:value-of select="./ns3:Amt">&lt;/xsl:value-of>&#xd;
	    &lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="MT71GAmount">&#xd;
&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_TR018pacs008(string($MT71G))">&lt;/xsl:value-of>&#xd;
&lt;/xsl:variable>
                &lt;ns6:Currency>
                  &lt;xsl:value-of select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgsInf/ns3:Amt/@Ccy">&lt;/xsl:value-of>
                &lt;/ns6:Currency>&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_Pacs008_71G(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgsInf/ns3:Amt/@Ccy),$MT71GAmount)">&#xd;
&lt;/xsl:value-of>&#xd;
&#xd;
&lt;/xsl:if>&lt;/ns6:F71G>
            &lt;/ns6:F71a_3>
            &lt;ns6:F72a>
              &lt;ns6:F72>&lt;xsl:variable name="ServiceLevelPropArr">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl">&#xd;
		&lt;xsl:value-of select="./ns3:Prtry"/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="ServiceLevelCodeArr">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl">&#xd;
		&lt;xsl:value-of select="./ns3:Cd"/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="InstrForCdtrAgtCodeArr">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForCdtrAgt">&#xd;
		&lt;xsl:value-of select="./ns3:Cd"/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="InstrForCdtrAgtInstructionArr">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForCdtrAgt">&#xd;
		&lt;xsl:value-of select="./ns3:InstrInf"/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>&#xd;
&#xd;
&lt;xsl:variable name="InstrForNxtAgtInstructionArr">&#xd;
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForNxtAgt">&#xd;
		&lt;xsl:value-of select="./ns3:InstrInf"/>&#xd;
		&lt;xsl:value-of select="$LineSeparator"/>&#xd;
	&lt;/xsl:for-each>&#xd;
&lt;/xsl:variable>
                &lt;ns6:NarrativeStructuredFormat>
                  &lt;ns6:Line1>
                    &lt;ns6:Code>
                      &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT72FullField1Line1Code(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($ServiceLevelPropArr),string($ServiceLevelCodeArr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:LclInstrm/ns3:Prtry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:LclInstrm/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Prtry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:BrnchId/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($InstrForCdtrAgtCodeArr),string($InstrForCdtrAgtInstructionArr),string($InstrForNxtAgtInstructionArr),string($LineSeparator),string($VariableSeparator))">&lt;/xsl:value-of>
                    &lt;/ns6:Code>
                    &lt;ns6:Narrative>&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT72FullField1Line1Narrative(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($ServiceLevelPropArr),string($ServiceLevelCodeArr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:LclInstrm/ns3:Prtry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:LclInstrm/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Prtry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:BrnchId/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($InstrForCdtrAgtCodeArr),string($InstrForCdtrAgtInstructionArr),string($InstrForNxtAgtInstructionArr),string($LineSeparator),string($VariableSeparator))">&lt;/xsl:value-of>&lt;/ns6:Narrative>
                  &lt;/ns6:Line1>&lt;xsl:variable name="Result">
&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT72FullField1Lines2to6withTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($ServiceLevelPropArr),string($ServiceLevelCodeArr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:LclInstrm/ns3:Prtry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:LclInstrm/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Prtry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:BrnchId/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($InstrForCdtrAgtCodeArr),string($InstrForCdtrAgtInstructionArr),string($InstrForNxtAgtInstructionArr),string($LineSeparator),string($VariableSeparator))">&lt;/xsl:value-of>
&lt;/xsl:variable>
&lt;xsl:call-template name="tokenize6">
    &lt;xsl:with-param name="text" select="substring-before($Result,'ENDOFOUTPUT')"/>
&lt;/xsl:call-template>
 &lt;xsl:variable name="TruncTemp">
  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>
&lt;/xsl:variable>
                  &lt;ns6:Lines2to6>&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F72_Lines2to6ENDOFFIELDTAG',substring-after($Result,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Lines2to6>
                &lt;/ns6:NarrativeStructuredFormat>
              &lt;/ns6:F72>
            &lt;/ns6:F72a>
            &lt;ns6:F77a>
              &lt;ns6:F77B>
                &lt;ns6:Narrative>&lt;xsl:variable name="MXRegulatoryReporting">
	&lt;xsl:for-each select="$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RgltryRptg">
		&lt;xsl:for-each select="./ns3:Dtls">
			&lt;xsl:for-each select="./ns3:Inf">
				&lt;xsl:value-of select="."/>
				&lt;xsl:value-of select="'ENDOFINFO'"/>
			&lt;/xsl:for-each>
			&lt;xsl:value-of select="'ENDOFDETAIL'"/>
		&lt;/xsl:for-each>
		&lt;xsl:value-of select="$LineSeparator"/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>
		
&lt;xsl:variable name="F77B">	
	&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTRegulatoryReportingwithTruncate(string($MXRegulatoryReporting),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:CtryOfRes))">&lt;/xsl:value-of>
&lt;/xsl:variable>

&lt;xsl:call-template name="tokenizeLine">
	&lt;xsl:with-param name="text" select="substring-before($F77B,'ENDOFOUTPUT')"/>
	&lt;xsl:with-param name="separator" select="$LineSeparator"/>
&lt;/xsl:call-template>
&lt;xsl:variable name="TruncTemp">
  &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')"/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F77B_Narrative_LineENDOFFIELDTAG',substring-after($F77B,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))"/>&lt;/ns6:Line>
                &lt;/ns6:Narrative>
              &lt;/ns6:F77B>
            &lt;/ns6:F77a>
          &lt;/ns6:MT103>
        &lt;/ns6:Document>
      &lt;/ns5:Block4>
      &lt;ns5:Block5>
        &lt;ns5:PAC>&lt;xsl:if test="java:_getBooleanProperty($_TIF_MESSAGE_, 'isIncludeAdditionalDetails')">
&lt;xsl:variable name="settedString">
&lt;xsl:value-of select="''"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString1">
&lt;xsl:value-of select="'//InstrId//EndToEndId//UETR//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString2">
&lt;xsl:value-of select="'//ClrChanl//Cd//LclInstrm//CtgyPurp//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString3">
&lt;xsl:value-of select="'//Amt//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString4">
&lt;xsl:value-of select="'//AnyBIC//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString5">
&lt;xsl:value-of select="'//Prtry//LEI//PstlAdr//Othr//BrnchId//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString6">
&lt;xsl:value-of select="'//Prtry//LEI//PstlAdr//Othr//BrnchId//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString7">
&lt;xsl:value-of select="'//BICFI//ClrSysMmbId//MmbId//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString8">
&lt;xsl:value-of select="'//IBAN//Id//Cd//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString9">
&lt;xsl:value-of select="'//BICFI//ClrSysMmbId//MmbId//Nm//TwnNm//Ctry//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString10">
&lt;xsl:value-of select="'//Tp//Ccy//Nm//Prxy//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString11">
&lt;xsl:value-of select="'//LEI//AdrTp//Othr//BrnchId//Prtry//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString12">
&lt;xsl:value-of select="'//InstrInf//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString13">
&lt;xsl:value-of select="'//Inf//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString14">
&lt;xsl:value-of select="'//RmtId//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString15">
&lt;xsl:value-of select="'//BICFI//ClrSysMmbId//MmbId//Nm//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString16">
&lt;xsl:value-of select="'//BICFI//ClrSysMmbId//MmbId//Nm//Dept//SubDept//StrtNm//BldgNb//BldgNm//Flr//PstBx//Room//PstCd//TwnNm//TwnLctnNm//DstrctNm//CtrySubDvsn//Ctry//AdrLine//Id//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString17">
&lt;xsl:value-of select="'//Nm//Dept//SubDept//StrtNm//BldgNb//BldgNm//Flr//PstBx//Room//PstCd//TwnNm//TwnLctnNm//DstrctNm//CtrySubDvsn//Ctry//AdrLine//AnyBIC//LEI//CtryOfRes//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString18">
&lt;xsl:value-of select="'//Nm//TwnNm//Ctry//Id//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString19">
&lt;xsl:value-of select="'//Ustrd//'"/>
&lt;/xsl:variable>
&lt;xsl:variable name="settedString20">
&lt;xsl:value-of select="'//PmtId//PmtTpInf//IntrBkSttlmAmt//IntrBkSttlmDt//SttlmTmIndctn//SttlmTmReq//InstdAmt//XchgRate//ChrgBr//ChrgsInf//PrvsInstgAgt1//PrvsInstgAgt2//PrvsInstgAgt3//IntrmyAgt1//IntrmyAgt1Acct//IntrmyAgt2//IntrmyAgt3//Dbtr//DbtrAgt//DbtrAgtAcct//Cdtr//CdtrAgt//CdtrAgtAcct//'"/>
&lt;/xsl:variable>
&lt;xsl:call-template name="dynamicAdditionalData"> 
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf" />
&lt;xsl:with-param name = "splitups" select = "$settedString20" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData"> 
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId" />
&lt;xsl:with-param name = "splitups" select = "$settedString1" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf" />
&lt;xsl:with-param name = "splitups" select = "$settedString2" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgsInf" />
&lt;xsl:with-param name = "splitups" select = "$settedString3" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1" />
&lt;xsl:with-param name = "splitups" select = "$settedString15" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1Acct" />
&lt;xsl:with-param name = "splitups" select = "$settedString" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2" />
&lt;xsl:with-param name = "splitups" select = "$settedString15" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2Acct" />
&lt;xsl:with-param name = "splitups" select = "$settedString" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3" />
&lt;xsl:with-param name = "splitups" select = "$settedString15" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3Acct" />
&lt;xsl:with-param name = "splitups" select = "$settedString" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstgAgt" />
&lt;xsl:with-param name = "splitups" select = "$settedString" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstdAgt" />
&lt;xsl:with-param name = "splitups" select = "$settedString" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1" />
&lt;xsl:with-param name = "splitups" select = "$settedString15" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct" />
&lt;xsl:with-param name = "splitups" select = "$settedString8" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2" />
&lt;xsl:with-param name = "splitups" select = "$settedString9" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2Acct" />
&lt;xsl:with-param name = "splitups" select = "$settedString" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3" />
&lt;xsl:with-param name = "splitups" select = "$settedString9" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3Acct" />
&lt;xsl:with-param name = "splitups" select = "$settedString" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InitgPty" />
&lt;xsl:with-param name = "splitups" select = "$settedString" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr" />
&lt;xsl:with-param name = "splitups" select = "$settedString4" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct" />
&lt;xsl:with-param name = "splitups" select = "$settedString" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt" />
&lt;xsl:with-param name = "splitups" select = "$settedString7" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct" />
&lt;xsl:with-param name = "splitups" select = "$settedString8" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt" />
&lt;xsl:with-param name = "splitups" select = "$settedString16" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct" />
&lt;xsl:with-param name = "splitups" select = "$settedString8" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr" />
&lt;xsl:with-param name = "splitups" select = "$settedString17" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct" />
&lt;xsl:with-param name = "splitups" select = "$settedString8" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtCdtr" />
&lt;xsl:with-param name = "splitups" select = "$settedString18" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForNxtAgt" />
&lt;xsl:with-param name = "splitups" select = "$settedString12" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RgltryRptg" />
&lt;xsl:with-param name = "splitups" select = "$settedString13" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RltdRmtInf" />
&lt;xsl:with-param name = "splitups" select = "$settedString14" />
&lt;/xsl:call-template>
&lt;xsl:call-template name="dynamicAdditionalData">
&lt;xsl:with-param name="roottag" select = "$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RmtInf" />
&lt;xsl:with-param name = "splitups" select = "$settedString19" />
&lt;/xsl:call-template>
&lt;/xsl:if>&lt;/ns5:PAC>
        &lt;ns5:SYS>
          &lt;ns5:MIR>
            &lt;ns5:LTIdentifier>&lt;xsl:variable name="TruncatedWithLimitter">&#xd;
&lt;xsl:value-of select="(concat(java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields'),'ENDOFTRUNK'))">&lt;/xsl:value-of>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:variable name="Truncated_Additional">&#xd;
&lt;xsl:value-of select="(concat($TruncatedWithLimitter,java:_getStringProperty($_TIF_MESSAGE_, 'Additional_Fields')))">&lt;/xsl:value-of>&#xd;
&lt;/xsl:variable>&#xd;
&lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'File_Truncated', java:com.fiorano.xslt.functions.base64.Base64.getEncodedString(MX2MT:com.fiorano.funclet.MXtoMT.generateReadableData(string(concat($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId/ns3:UETR,'ENDOFUETR',$Truncated_Additional)))))">&lt;/xsl:value-of>&lt;/ns5:LTIdentifier>
          &lt;/ns5:MIR>
        &lt;/ns5:SYS>
        &lt;ns5:MRF>
          &lt;ns5:MIR>
            &lt;ns5:ISN>
              &lt;xsl:variable name="if33">
                &lt;xsl:choose>
                  &lt;xsl:when test="QueryGenerator:isBlank(string(''))">
                    &lt;xsl:value-of select="''">&lt;/xsl:value-of>
                  &lt;/xsl:when>
                  &lt;xsl:otherwise>
                    &lt;xsl:value-of select="''">&lt;/xsl:value-of>
                  &lt;/xsl:otherwise>
                &lt;/xsl:choose>
              &lt;/xsl:variable>
              &lt;xsl:value-of select="$if33">&lt;/xsl:value-of>
            &lt;/ns5:ISN>
          &lt;/ns5:MIR>
        &lt;/ns5:MRF>
      &lt;/ns5:Block5>
    &lt;/ns5:FinMessage>
  &lt;/xsl:template>&lt;xsl:template name="tokenizeLine">
 &lt;xsl:param name="text" select="."/>
 &lt;xsl:param name="separator" select="'ENDOFLINE'"/>
        &lt;xsl:choose>
            &lt;xsl:when test="not(contains($text, $separator))">
                &lt;ns6:Line>
                    &lt;xsl:value-of select="normalize-space($text)"/>
                &lt;/ns6:Line>
            &lt;/xsl:when>
            &lt;xsl:otherwise>
               &lt;ns6:Line>
                    &lt;xsl:value-of select="normalize-space(substring-before($text, $separator))"/>
               &lt;/ns6:Line>
                &lt;xsl:call-template name="tokenizeLine">
                    &lt;xsl:with-param name="text" select="substring-after($text, $separator)"/>
                &lt;/xsl:call-template>
            &lt;/xsl:otherwise>
        &lt;/xsl:choose>
&lt;/xsl:template>
&lt;xsl:template name="tokenizeF13C">
 &lt;xsl:param name="text" select="."/>
 &lt;xsl:param name="separator" select="'ENDOFLINE'"/>
        &lt;xsl:choose>
            &lt;xsl:when test="not(contains($text, $separator))">
			  &lt;xsl:if test="string-length($text)">  
                &lt;xsl:call-template name="MXDateTimeOffsetF13C">
					&lt;xsl:with-param name="text" select="normalize-space($text)"/>
				&lt;/xsl:call-template>
			  &lt;/xsl:if>
            &lt;/xsl:when>
            &lt;xsl:otherwise>
                &lt;xsl:call-template name="MXDateTimeOffsetF13C">
					&lt;xsl:with-param name="text" select="normalize-space(substring-before($text, $separator))"/>
				&lt;/xsl:call-template>
                &lt;xsl:call-template name="tokenizeF13C">
                    &lt;xsl:with-param name="text" select="substring-after($text, $separator)"/>
                &lt;/xsl:call-template>
            &lt;/xsl:otherwise>
        &lt;/xsl:choose>
&lt;/xsl:template>



&lt;xsl:template name="MXDateTimeOffsetF13C">
  &lt;xsl:param name="text" select="."/>
  &lt;ns6:F13a>
      &lt;ns6:F13C>
        &lt;ns6:Code>
		  &lt;xsl:value-of select="substring($text,1,7)">&lt;/xsl:value-of>
        &lt;/ns6:Code>
		  &lt;xsl:choose>
            &lt;xsl:when test="starts-with($text,'SNDTIME') or starts-with($text,'RNCTIME')">
			  &lt;ns6:TimeIndication>
				&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTDateTimeOffset_Time(string(substring($text,8)))">&lt;/xsl:value-of>
			  &lt;/ns6:TimeIndication>
			  &lt;ns6:Sign>
				&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTDateTimeOffset_Sign(string(substring($text,8)))">&lt;/xsl:value-of>
			  &lt;/ns6:Sign>
			  &lt;ns6:TimeOffset>
				&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTDateTimeOffset_Offset(string(substring($text,8)))">&lt;/xsl:value-of>
			  &lt;/ns6:TimeOffset>
			&lt;/xsl:when>  
			&lt;xsl:otherwise>
			  &lt;ns6:TimeIndication>
				&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTTime_Time(string(substring($text,8)))">&lt;/xsl:value-of>
			  &lt;/ns6:TimeIndication>
			  &lt;ns6:Sign>
				&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTTime_Sign(string(substring($text,8)))">&lt;/xsl:value-of>
			  &lt;/ns6:Sign>
			  &lt;ns6:TimeOffset>
				&lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTTime_Offset(string(substring($text,8)))">&lt;/xsl:value-of>
			  &lt;/ns6:TimeOffset>
			&lt;/xsl:otherwise>
		  &lt;/xsl:choose>
	  &lt;/ns6:F13C>
  &lt;/ns6:F13a>
&lt;/xsl:template>

&lt;xsl:template name="tokenize3">
	&lt;xsl:param name="text" select="."/>
	&lt;xsl:param name="LineSeparator" select="'ENDOFLINE'"/>
	&lt;xsl:param name="VarSeparator" select="'ENDOFVAR'"/>
	&lt;xsl:choose>
		&lt;xsl:when test="not(string-length($text))">
		&lt;/xsl:when>
		&lt;xsl:when test="not(contains($text, $LineSeparator))">
			&lt;ns6:Lines2to5>
				&lt;ns6:Number>
					&lt;xsl:value-of select="normalize-space(substring-before($text, $VarSeparator))"/>
				&lt;/ns6:Number>

				&lt;xsl:variable name="Cdval">
					&lt;xsl:value-of select="substring-after($text, $VarSeparator)"/>
				&lt;/xsl:variable>

				&lt;ns6:Details>
					&lt;xsl:value-of select="normalize-space(substring-before($Cdval, $VarSeparator))"/>
				&lt;/ns6:Details>

			&lt;/ns6:Lines2to5>
		&lt;/xsl:when>
		&lt;xsl:when test="((contains($text, $LineSeparator))) ">

			&lt;ns6:Lines2to5>
				&lt;ns6:Number>
					&lt;xsl:value-of select="normalize-space(substring-before($text, $VarSeparator))"/>
				&lt;/ns6:Number>

				&lt;xsl:variable name="Cdval1">
					&lt;xsl:value-of select="substring-after($text, $VarSeparator)"/>
				&lt;/xsl:variable>

				&lt;ns6:Details>
					&lt;xsl:value-of select="normalize-space(substring-before($Cdval1, $VarSeparator))"/>
				&lt;/ns6:Details>

			&lt;/ns6:Lines2to5>
			&lt;xsl:call-template name="tokenize3">
				&lt;xsl:with-param name="text" select="substring-after($text, $LineSeparator)"/>
			&lt;/xsl:call-template>
		&lt;/xsl:when>
	&lt;/xsl:choose>
&lt;/xsl:template>

&lt;xsl:template name="tokenizeF23E">
	&lt;xsl:param name="text" select="."/>
	&lt;xsl:param name="LineSeparator" select="'ENDOFLINE'"/>
	&lt;xsl:param name="VarSeparator" select="'ENDOFVAR'"/>
	&lt;xsl:choose>
		&lt;xsl:when test="not(string-length($text))">
		&lt;/xsl:when>
		&lt;xsl:when test="not(contains($text, $LineSeparator))">
			&lt;ns6:F23a_2>
			&lt;ns6:F23E>
				&lt;ns6:InstructionCode>
					&lt;xsl:value-of select="normalize-space(substring-before($text, $VarSeparator))"/>
				&lt;/ns6:InstructionCode>

				&lt;xsl:variable name="Cdval">
					&lt;xsl:value-of select="substring-after($text, $VarSeparator)"/>
				&lt;/xsl:variable>

				&lt;ns6:AdditionalInformation>
					&lt;xsl:value-of select="normalize-space(substring-before($Cdval, $VarSeparator))"/>
				&lt;/ns6:AdditionalInformation>

			&lt;/ns6:F23E>
			&lt;/ns6:F23a_2>
		&lt;/xsl:when>
		&lt;xsl:when test="((contains($text, $LineSeparator))) ">

			&lt;ns6:F23a_2>
			&lt;ns6:F23E>
				&lt;ns6:InstructionCode>
					&lt;xsl:value-of select="normalize-space(substring-before($text, $VarSeparator))"/>
				&lt;/ns6:InstructionCode>

				&lt;xsl:variable name="Cdval1">
					&lt;xsl:value-of select="substring-after($text, $VarSeparator)"/>
				&lt;/xsl:variable>

				&lt;ns6:AdditionalInformation>
					&lt;xsl:value-of select="normalize-space(substring-before($Cdval1, $VarSeparator))"/>
				&lt;/ns6:AdditionalInformation>

			&lt;/ns6:F23E>
			&lt;/ns6:F23a_2>
			&lt;xsl:call-template name="tokenizeF23E">
				&lt;xsl:with-param name="text" select="substring-after($text, $LineSeparator)"/>
			&lt;/xsl:call-template>
		&lt;/xsl:when>
	&lt;/xsl:choose>
&lt;/xsl:template>

&lt;xsl:template name="tokenize4">
	&lt;xsl:param name="text" select="."/>
	&lt;xsl:param name="LineSeparator" select="'ENDOFLINE'"/>
	&lt;xsl:param name="VarSeparator" select="'ENDOFVAR'"/>
	&lt;xsl:choose>
		&lt;xsl:when test="not(string-length($text))">
		&lt;/xsl:when>
		&lt;xsl:when test="not(contains($text, $LineSeparator))">
			&lt;ns6:NumberNameAndAddressDetails>
				&lt;ns6:Number>
					&lt;xsl:value-of select="normalize-space(substring-before($text, $VarSeparator))"/>
				&lt;/ns6:Number>

				&lt;xsl:variable name="Cdval">
					&lt;xsl:value-of select="substring-after($text, $VarSeparator)"/>
				&lt;/xsl:variable>

				&lt;ns6:Details>
					&lt;xsl:value-of select="normalize-space(substring-before($Cdval, $VarSeparator))"/>
				&lt;/ns6:Details>

			&lt;/ns6:NumberNameAndAddressDetails>
		&lt;/xsl:when>
		&lt;xsl:when test="((contains($text, $LineSeparator))) ">

			&lt;ns6:NumberNameAndAddressDetails>
				&lt;ns6:Number>
					&lt;xsl:value-of select="normalize-space(substring-before($text, $VarSeparator))"/>
				&lt;/ns6:Number>

				&lt;xsl:variable name="Cdval1">
					&lt;xsl:value-of select="substring-after($text, $VarSeparator)"/>
				&lt;/xsl:variable>

				&lt;ns6:Details>
					&lt;xsl:value-of select="normalize-space(substring-before($Cdval1, $VarSeparator))"/>
				&lt;/ns6:Details>

			&lt;/ns6:NumberNameAndAddressDetails>
			&lt;xsl:call-template name="tokenize4">
				&lt;xsl:with-param name="text" select="substring-after($text, $LineSeparator)"/>
			&lt;/xsl:call-template>
		&lt;/xsl:when>
	&lt;/xsl:choose>
&lt;/xsl:template>

&lt;xsl:template name="tokenize6">
 &lt;xsl:param name="text" select="."/>
 &lt;xsl:param name="LineSeparator" select="'ENDOFLINE'"/>
 &lt;xsl:param name="VarSeparator" select="'ENDOFVAR'"/>
        &lt;xsl:choose>
        &lt;xsl:when test="not(string-length($text))">
        &lt;/xsl:when>
            &lt;xsl:when test="not(contains($text, $LineSeparator))">
            &lt;ns6:Lines2to6>
                &lt;ns6:Narrative1>
                &lt;xsl:value-of select="substring-before($text, $VarSeparator)"/>
                &lt;/ns6:Narrative1>

                &lt;xsl:variable name="Cdval22">
                &lt;xsl:value-of select="substring-after($text, $VarSeparator)"/>
                &lt;/xsl:variable>

                &lt;ns6:Code>
                &lt;xsl:value-of select="substring-before($Cdval22, $VarSeparator)"/>
                &lt;/ns6:Code>

                &lt;xsl:variable name="Cdval">
                &lt;xsl:value-of select="substring-after($Cdval22, $VarSeparator)"/>
                &lt;/xsl:variable>

                &lt;ns6:Narrative2>
                &lt;xsl:value-of select="substring-before($Cdval, $VarSeparator)"/>
                &lt;/ns6:Narrative2>

                &lt;/ns6:Lines2to6>
            &lt;/xsl:when>
           &lt;xsl:when test="((contains($text, $LineSeparator))) ">

              &lt;ns6:Lines2to6>
                &lt;ns6:Narrative1>
                &lt;xsl:value-of select="substring-before($text, $VarSeparator)"/>
                &lt;/ns6:Narrative1>

                &lt;xsl:variable name="Cdval111">
                &lt;xsl:value-of select="substring-after($text, $VarSeparator)"/>
                &lt;/xsl:variable>

                &lt;ns6:Code>
                &lt;xsl:value-of select="substring-before($Cdval111, $VarSeparator)"/>
                &lt;/ns6:Code>

                &lt;xsl:variable name="Cdval1">
                &lt;xsl:value-of select="substring-after($Cdval111, $VarSeparator)"/>
                &lt;/xsl:variable>

                &lt;ns6:Narrative2>
                &lt;xsl:value-of select="substring-before($Cdval1, $VarSeparator)"/>
                &lt;/ns6:Narrative2>

                &lt;/ns6:Lines2to6>
                &lt;xsl:call-template name="tokenize6">
                    &lt;xsl:with-param name="text" select="substring-after($text, $LineSeparator)"/>
                &lt;/xsl:call-template>
            &lt;/xsl:when>
        &lt;/xsl:choose>
&lt;/xsl:template>

 &lt;xsl:template name="tokenize7">
 &lt;xsl:param name="text" select="."/>
 &lt;xsl:param name="LineSeparator" select="'ENDOFLINE'"/>
 &lt;xsl:param name="VarSeparator" select="'ENDOFVAR'"/>
        &lt;xsl:choose>
		&lt;xsl:when test="not(string-length($text))">
		&lt;/xsl:when>
            &lt;xsl:when test="not(contains($text, $LineSeparator))">
			&lt;ns6:F71a_2>
			&lt;ns6:F71F>
				&lt;ns6:Currency>
				&lt;xsl:value-of select="normalize-space(substring-before($text, $VarSeparator))"/>
				&lt;/ns6:Currency>
				
				&lt;xsl:variable name="Cdval">
				&lt;xsl:value-of select="substring-after($text, $VarSeparator)"/>
				&lt;/xsl:variable>
				
				&lt;ns6:Amount>
				&lt;xsl:value-of select="normalize-space(substring-before($Cdval, $VarSeparator))"/>
				&lt;/ns6:Amount>

                &lt;/ns6:F71F>
				&lt;/ns6:F71a_2>
            &lt;/xsl:when>
           &lt;xsl:when test="((contains($text, $LineSeparator))) ">
              &lt;ns6:F71a_2>
			  &lt;ns6:F71F>
				&lt;ns6:Currency>
				&lt;xsl:value-of select="normalize-space(substring-before($text, $VarSeparator))"/>
				&lt;/ns6:Currency>
				
				&lt;xsl:variable name="Cdval1">
				&lt;xsl:value-of select="substring-after($text, $VarSeparator)"/>
				&lt;/xsl:variable>
				
				&lt;ns6:Amount>
				&lt;xsl:value-of select="normalize-space(substring-before($Cdval1, $VarSeparator))"/>
				&lt;/ns6:Amount>

				&lt;/ns6:F71F>
				&lt;/ns6:F71a_2>
                &lt;xsl:call-template name="tokenize7">
                    &lt;xsl:with-param name="text" select="substring-after($text, $LineSeparator)"/>
                &lt;/xsl:call-template>
            &lt;/xsl:when>
        &lt;/xsl:choose>
&lt;/xsl:template>

&lt;xsl:param name="_TIF_MESSAGE_">&lt;/xsl:param>
&lt;!--The list of Extensions defined by user-->
&lt;xsl:template name="myFunction">
  &lt;xsl:param name = "splitups"/>
  &lt;xsl:for-each select="*">
  &lt;xsl:variable name="tag">
  &lt;xsl:value-of select="local-name()">&lt;/xsl:value-of>
  &lt;/xsl:variable>
&lt;xsl:variable name = "checker1" >
&lt;xsl:value-of select ="substring-after($splitups,$tag)"/>
&lt;/xsl:variable>

&lt;xsl:variable name = "checker2">
 &lt;xsl:value-of select ="string(substring-before($splitups,$tag))"/>
  
  &lt;/xsl:variable> 
  &lt;xsl:choose>
&lt;xsl:when test="starts-with(substring-after($splitups,$tag),'/') and  MX2MT:com.fiorano.funclet.MXtoMT.endsWith(substring-before($splitups,$tag),'/')='true' ">
    &lt;/xsl:when>
    &lt;xsl:otherwise>
&lt;xsl:value-of select="'&amp;#xd;&amp;#xa;'"/>
      &lt;xsl:variable name="tagFullForm">
  &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.fullFormGenerator(local-name())">&lt;/xsl:value-of>
&lt;/xsl:variable>&lt;xsl:if test="count(child::*)>0">-----------------Start of &lt;xsl:value-of select="$tagFullForm"/> Details-----------------&lt;/xsl:if>&lt;xsl:if test="count(child::*)=0">&lt;xsl:value-of select="'&amp;#xd;&amp;#xa;'"/>&lt;xsl:value-of select="$tagFullForm"/>:&lt;/xsl:if>&lt;xsl:call-template name="myFunction" >&lt;xsl:with-param name = "splitups" select="$splitups"/>&lt;/xsl:call-template>&lt;xsl:if test = "count(child::*)=0">&lt;xsl:value-of select="."/>
&lt;/xsl:if>
&lt;xsl:if test="count(child::*)>0">&lt;xsl:value-of select="'&amp;#xd;&amp;#xa;'"/>-----------------End of &lt;xsl:value-of select="$tagFullForm"/> Details-----------------&lt;xsl:value-of select="'&amp;#xd;&amp;#xa;'"/>&lt;/xsl:if>
    &lt;/xsl:otherwise>                
&lt;/xsl:choose> 
&lt;/xsl:for-each>
  &lt;/xsl:template>
   &lt;xsl:template name="dynamicAdditionalData">
  &lt;xsl:param name="roottag"/>
  &lt;xsl:param name="splitups"/>
  &lt;xsl:variable name="AdditionalData">
    &lt;xsl:for-each select="$roottag">
      &lt;xsl:variable name="tagFullForm">
        &lt;xsl:value-of select="MX2MT:com.fiorano.funclet.MXtoMT.fullFormGenerator(local-name())">&lt;/xsl:value-of>
      &lt;/xsl:variable>
-----------------Start of &lt;xsl:value-of select="$tagFullForm"/> Details-----------------&lt;xsl:call-template name="myFunction">
        &lt;xsl:with-param name="splitups" select="$splitups"/>
      &lt;/xsl:call-template>
-----------------End of &lt;xsl:value-of select="$tagFullForm"/> Details-----------------&lt;/xsl:for-each>
&lt;xsl:value-of select="'&amp;#xd;&amp;#xa;'"/>
&lt;xsl:value-of select="'&amp;#xd;&amp;#xa;'"/>

  &lt;/xsl:variable>
  &lt;xsl:variable name="settedString">
        &lt;xsl:value-of select="java:_getStringProperty($_TIF_MESSAGE_, 'Additional_Fields')"/>
      &lt;/xsl:variable>
  &lt;xsl:variable name="AdditionalDataWithLimitter">
    &lt;xsl:choose>
      &lt;xsl:when test="$settedString !=null or not(normalize-space($settedString)='')">
        &lt;xsl:value-of select="(concat($settedString,$AdditionalData))"/>
      &lt;/xsl:when>
      &lt;xsl:otherwise>
        &lt;xsl:value-of select="$AdditionalData"/>
      &lt;/xsl:otherwise>
    &lt;/xsl:choose>
  &lt;/xsl:variable>
  &lt;xsl:value-of select="java:_setStringProperty($_TIF_MESSAGE_, 'Additional_Fields',$AdditionalDataWithLimitter)"/>
&lt;/xsl:template>
&lt;!--The list of parameters defined by user-->
  &lt;xsl:param name="_TIF_MESSAGE_">&lt;/xsl:param>
&lt;!--The list of Extensions defined by user-->
  &lt;lxslt:component prefix="QueryGenerator" functions="isBlank">
    &lt;lxslt:script lang="javascript">&lt;![CDATA[function isBlank(str) {
    return (!str || /^\s*$/.test(str));
}

// JMS-Message can be accessed using 'document' variable
function generateQuery(strinput) {
var output = "INSERT INTO finastra.truncatedcontent ( uetr, field, keypair, valuepair ) VALUES ";
var flagempty = true;
var mainpairs = strinput.split('ENDOFUETR');
var UETR = mainpairs[0];
if(mainpairs[1]) {
	var rest = mainpairs[1];
	var truncpairs = rest.split('ENDOFTRUNCATEDFIELD');
	var arrayLength = truncpairs.length;
	for (var i = 0; i &lt; arrayLength; i++) {
		var trunckeyvalue = truncpairs[i].split('ENDOFFIELDTAG');
		if(trunckeyvalue.length > 1 &amp;&amp; !isBlank(trunckeyvalue[1])){
			if(trunckeyvalue[1]) {
				var keyvaluepairs = trunckeyvalue[1].split('ENDOFPAIR');
				var arrayLength1 = keyvaluepairs.length;
				for (var j = 0; j &lt; arrayLength1; j++) {
					var keyvaluepair = keyvaluepairs[j].split('CONCATPAIR');
					if(keyvaluepair[1]){
						output = output.concat("('" , UETR , "','" , trunckeyvalue[0] , "','" , keyvaluepair[0] , "','" , keyvaluepair[1] , "'),");
						flagempty = false;
					}
		
				}
			}
		}
	}
}	
if(flagempty) {
	output = "";
}else {
	output = output.replace(/.$/,";");
}
return output;
}


function generateReadableData(strinput) {
var output = "MessageID	 : ";
var flagempty = true;
var mainpairs = strinput.split('ENDOFUETR');
var UETR = mainpairs[0];
output = output.concat(UETR, "\nList of Truncated content:\n");
if(mainpairs[1]) {
	var rest = mainpairs[1];
	var truncpairs = rest.split('ENDOFTRUNCATEDFIELD');
	var arrayLength = truncpairs.length;
	for (var i = 0; i &lt; arrayLength; i++) {
		var trunckeyvalue = truncpairs[i].split('ENDOFFIELDTAG');
		if(trunckeyvalue.length > 1 &amp;&amp; !isBlank(trunckeyvalue[1])){
			output = output.concat("\n"+trunckeyvalue[0]+"\n");
			if(trunckeyvalue[1]) {
				var keyvaluepairs = trunckeyvalue[1].split('ENDOFPAIR');
				var arrayLength1 = keyvaluepairs.length;
				for (var j = 0; j &lt; arrayLength1; j++) {
					var keyvaluepair = keyvaluepairs[j].split('CONCATPAIR');
					if(keyvaluepair[1]){
						output = output.concat("Value in MT message : ", keyvaluepair[0], "+", "\nValue in MX message : ", keyvaluepair[0], keyvaluepair[1] , "\n");
						flagempty = false;
					}
		
				}
			}
		}
	}
}	
if(flagempty) {
	output = "";
}else {
	output = output.replace(/.$/,";");
}
return output;
}]]&gt;&lt;/lxslt:script>
  &lt;/lxslt:component>
&lt;/xsl:stylesheet></resource-property><resource-property name="Transformation Class Name"></resource-property><resource-property name="XSLT Engine">Xalan</resource-property></resource-properties><deployment nodes="fes" /><execution><debug enabled="false" port="5005" suspend="false" /><launchOrder-Sequence sequence="-1" /><stopOrder-Sequence sequence="-1" /></execution><inputport-instances><inputport-instance name="IN_PORT"><description>Transforms input XML based on Mappings defined and generates an output XML.</description><schema root="{urn:swift:xsd:envelope}Envelope"><file>SwiftTranslator.IN_PORT.xsd</file><schemarefs><schemaref uri="urn:iso:std:iso:20022:tech:xsd:head.001.001.02"><file>SwiftTranslator.IN_PORT.1.xsd</file></schemaref><schemaref uri="urn:iso:std:iso:20022:tech:xsd:pacs.008.001.08"><file>SwiftTranslator.IN_PORT.2.xsd</file></schemaref></schemarefs></schema><selectors /><sbwmask /><jms><destination custom="true" name="PACS008_To_MT103" /><subscriber><transaction enabled="false" /><subscription durable="false" /></subscriber></jms><workflow type="0" datatype="2" enablecallout="false" /></inputport-instance></inputport-instances><outputport-instances><outputport-instance name="OUT_PORT"><description>Transforms input XML based on Mappings defined and generates an output XML.</description><schema root="{urn:swift:xsd:mtmsg.2020}FinMessage"><file>SwiftTranslator.OUT_PORT.xsd</file><schemarefs><schemaref uri="urn:swift:xsd:fin.103.2020"><file>SwiftTranslator.OUT_PORT.3.xsd</file></schemaref></schemarefs></schema><selectors /><sbwmask /><jms><destination /><publisher><messages persistent="true" /></publisher></jms><workflow type="0" datatype="2" enablecallout="false" /></outputport-instance><outputport-instance name="ON_EXCEPTION"><description>Used as an Exception Port</description><schema root="{http://www.fiorano.com/fesb/activity/fault}Error"><file>SwiftTranslator.ON_EXCEPTION.xsd</file></schema><selectors /><sbwmask /><jms><destination /><publisher><messages persistent="true" /></publisher></jms><workflow type="1" datatype="2" enablecallout="false" /></outputport-instance></outputport-instances><logmanager logger="java.util.logging.FileHandler"><Param name="java.util.logging.FileHandler.limit">1000000</Param><Param name="java.util.logging.FileHandler.dir">logs</Param><Param name="fiorano.jms.log2.def.DefaultFormatter.dateformat">MM/dd/yyyy HH:mm:ss</Param><Param name="java.util.logging.FileHandler.count">4</Param><Param name="fiorano.jms.log2.def.DefaultFormatter.includetimestamp">true</Param></logmanager><logmodules><logmodule name="ERR_HANDLER" level="WARNING" uniqueNameRequired="true" /><logmodule name="OUT_HANDLER" level="INFO" uniqueNameRequired="true" /><logmodule name="com.fiorano.services.xslt.xslt" uniqueNameRequired="true" /></logmodules><runtime-arguments-config-name name="64m" /><servicerefs /></inst><inst name="XML2MT"><service guid="XML2MT" version="4.0" /><short-description>Component to convert XML messages to SWIFT MT messages.</short-description><config-file name="XML2MT.xml" /><named-configurations><named-configuration name="SwiftMTSchemaDirectory" configurationType="resource" configurationID="MessageSchema Directory Configuration" /></named-configurations><deployment nodes="fes" /><execution><debug enabled="false" port="5000" suspend="false" /><launchOrder-Sequence sequence="-1" /><stopOrder-Sequence sequence="-1" /><launch type="2"><groupprocess id="&lt;None>" /></launch></execution><inputport-instances><inputport-instance name="IN_PORT"><description>Receives XML messages.</description><schema root="{urn:swift:xsd:mtmsg.2020}FinMessage"><file>XML2MT.IN_PORT.xsd</file><schemarefs><schemaref uri="urn:swift:xsd:fin.103.2020"><file>XML2MT.IN_PORT.1.xsd</file></schemaref></schemarefs></schema><selectors /><sbwmask /><jms><destination /><subscriber><transaction enabled="false" /><subscription durable="false" /></subscriber></jms><workflow type="0" datatype="2" enablecallout="false" /></inputport-instance></inputport-instances><outputport-instances><outputport-instance name="OUT_PORT"><description>Sends transformed MT messages.</description><selectors /><sbwmask /><jms><destination name="PACS008_To_MT103Response" /><publisher><messages persistent="true" /></publisher></jms><workflow type="0" datatype="2" enablecallout="false" /></outputport-instance><outputport-instance name="ON_EXCEPTION"><description>Used as an Exception Port</description><schema root="{http://www.fiorano.com/fesb/activity/fault}Error"><file>XML2MT.ON_EXCEPTION.xsd</file></schema><selectors /><sbwmask /><jms><destination /><publisher><messages persistent="true" /></publisher></jms><workflow type="1" datatype="2" enablecallout="false" /></outputport-instance></outputport-instances><logmanager logger="java.util.logging.FileHandler"><Param name="java.util.logging.FileHandler.limit">1000000</Param><Param name="java.util.logging.FileHandler.dir">logs</Param><Param name="fiorano.jms.log2.def.DefaultFormatter.dateformat">MM/dd/yyyy HH:mm:ss</Param><Param name="java.util.logging.FileHandler.count">4</Param><Param name="fiorano.jms.log2.def.DefaultFormatter.includetimestamp">true</Param></logmanager><logmodules><logmodule name="ERR_HANDLER" level="WARNING" uniqueNameRequired="true" /><logmodule name="OUT_HANDLER" level="INFO" uniqueNameRequired="true" /><logmodule name="com.fiorano.services.xml2mt.XML2MTService" level="WARNING" uniqueNameRequired="true" /><logmodule name="com.fiorano.services.xml2mt.engine" level="WARNING" uniqueNameRequired="true" /><logmodule name="com.fiorano.services.xml2mt.transport.jms" level="WARNING" uniqueNameRequired="true" /></logmodules><runtime-arguments><runtime-argument name="JVM_PARAMS" mandatory="false"><value> -client -DLOG_TO_STREAM=true -Xrs -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m</value></runtime-argument><runtime-argument name="JAVA_HOME" mandatory="false" inmemory="false" /></runtime-arguments><servicerefs /></inst><inst name="PostProcessing"><service guid="Xslt" version="4.0" /><short-description>Transforms input XML based on Mappings defined and generates an output XML</short-description><long-description>Transforms input XML based on Mappings defined and generates an output XML</long-description><config-file name="PostProcessing.xml" /><resource-properties><resource-property name="XSL"></resource-property><resource-property name="Transformation Class Name"></resource-property><resource-property name="XSLT Engine">Xalan</resource-property></resource-properties><deployment nodes="fes" /><execution><debug enabled="false" port="5000" suspend="false" /><launchOrder-Sequence sequence="-1" /><stopOrder-Sequence sequence="-1" /></execution><inputport-instances><inputport-instance name="IN_PORT"><description>Transforms input XML based on Mappings defined and generates an output XML.</description><schema root="{urn:swift:xsd:mtmsg.2020}FinMessage"><file>PostProcessing.IN_PORT.xsd</file><schemarefs><schemaref uri="urn:swift:xsd:fin.103.2020"><file>PostProcessing.IN_PORT.1.xsd</file></schemaref></schemarefs></schema><selectors /><sbwmask /><jms><destination /><subscriber><transaction enabled="false" /><subscription durable="false" /></subscriber></jms><workflow type="0" datatype="2" enablecallout="false" /></inputport-instance></inputport-instances><outputport-instances><outputport-instance name="OUT_PORT"><description>Transforms input XML based on Mappings defined and generates an output XML.</description><schema root="{urn:swift:xsd:mtmsg.2020}FinMessage"><file>PostProcessing.IN_PORT.xsd</file><schemarefs><schemaref uri="urn:swift:xsd:fin.103.2020"><file>PostProcessing.IN_PORT.1.xsd</file></schemaref></schemarefs></schema><selectors /><sbwmask /><jms><destination /><publisher><messages persistent="true" /></publisher></jms><workflow type="0" datatype="2" enablecallout="false" /></outputport-instance><outputport-instance name="ON_EXCEPTION"><description>Used as an Exception Port</description><schema root="{http://www.fiorano.com/fesb/activity/fault}Error"><file>PostProcessing.ON_EXCEPTION.xsd</file></schema><selectors /><sbwmask /><jms><destination /><publisher><messages persistent="true" /></publisher></jms><workflow type="1" datatype="2" enablecallout="false" /></outputport-instance></outputport-instances><logmanager logger="java.util.logging.FileHandler"><Param name="java.util.logging.FileHandler.limit">1000000</Param><Param name="java.util.logging.FileHandler.dir">logs</Param><Param name="fiorano.jms.log2.def.DefaultFormatter.dateformat">MM/dd/yyyy HH:mm:ss</Param><Param name="java.util.logging.FileHandler.count">4</Param><Param name="fiorano.jms.log2.def.DefaultFormatter.includetimestamp">true</Param></logmanager><logmodules><logmodule name="ERR_HANDLER" level="WARNING" uniqueNameRequired="true" /><logmodule name="OUT_HANDLER" level="INFO" uniqueNameRequired="true" /><logmodule name="com.fiorano.services.xslt.xslt" uniqueNameRequired="true" /></logmodules><runtime-arguments-config-name name="64m" /><servicerefs /></inst><inst name="ConvertToSTP"><service guid="JavaScript" version="4.0" /><short-description>The Scripting Business Service used to modify any incoming document using JavaScript</short-description><long-description>The Scripting Business Service used to modify any incoming document using JavaScript</long-description><config-file name="ConvertToSTP.xml" /><deployment nodes="fes" /><execution><debug enabled="false" port="5000" suspend="false" /><launchOrder-Sequence sequence="-1" /><stopOrder-Sequence sequence="-1" /><launch type="2"><groupprocess id="&lt;None>" /></launch></execution><inputport-instances><inputport-instance name="IN_PORT"><description>Takes the input message which has to be executed on a JavaScript</description><selectors /><sbwmask /><jms><destination /><subscriber><transaction enabled="false" /><subscription durable="false" /></subscriber></jms><workflow type="0" datatype="2" enablecallout="false" /></inputport-instance></inputport-instances><outputport-instances><outputport-instance name="OUT_PORT"><description>Sends the output of the Script</description><selectors /><sbwmask /><jms><destination custom="true" name="PACS008_To_MT103Response" /><publisher><messages persistent="true" /></publisher></jms><workflow type="0" datatype="2" enablecallout="false" /></outputport-instance><outputport-instance name="ON_EXCEPTION"><description>Used as an Exception Port</description><schema root="{http://www.fiorano.com/fesb/activity/fault}Error"><file>ConvertToSTP.ON_EXCEPTION.xsd</file></schema><selectors /><sbwmask /><jms><destination /><publisher><messages persistent="true" /></publisher></jms><workflow type="1" datatype="2" enablecallout="false" /></outputport-instance></outputport-instances><logmanager logger="java.util.logging.FileHandler"><Param name="java.util.logging.FileHandler.limit">1000000</Param><Param name="java.util.logging.FileHandler.dir">logs</Param><Param name="fiorano.jms.log2.def.DefaultFormatter.dateformat">MM/dd/yyyy HH:mm:ss</Param><Param name="java.util.logging.FileHandler.count">4</Param><Param name="fiorano.jms.log2.def.DefaultFormatter.includetimestamp">true</Param></logmanager><logmodules><logmodule name="com.fiorano.bc.trgateway" uniqueNameRequired="true" /><logmodule name="com.fiorano.adapter.jca.script.cci.ScriptInteraction" uniqueNameRequired="true" /><logmodule name="com.fiorano.adapter.jca.script.spi.outbound.ScriptManagedConnectionFactory" uniqueNameRequired="true" /><logmodule name="fiorano.esb.adapter.jca.dii.javascript.monitor" uniqueNameRequired="true" /><logmodule name="OUT_HANDLER" level="INFO" uniqueNameRequired="true" /><logmodule name="ERR_HANDLER" uniqueNameRequired="true" /></logmodules><runtime-arguments><runtime-argument name="JVM_PARAMS" mandatory="false" inmemory="false"><value> -client -DLOG_TO_STREAM=true -Xrs -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=256m</value></runtime-argument><runtime-argument name="javax.resource.cci.InteractionSpec"><value>com.fiorano.adapter.jca.script.cci.JavaScriptInteractionSpec</value></runtime-argument><runtime-argument name="JAVA_HOME" mandatory="false" inmemory="false" /></runtime-arguments><servicerefs /></inst></service-instances><routes><route name="route3"><source inst="SwiftTranslator" port="OUT_PORT" /><target inst="PostProcessing" port="IN_PORT" /><messages durabilitySource="Application" /><logmodules /></route><route name="route5"><source inst="PostProcessing" port="OUT_PORT" /><target inst="XML2MT" port="IN_PORT" /><messages durabilitySource="Application" /><logmodules /></route><route name="route1"><source inst="XML2MT" port="OUT_PORT" /><target inst="ConvertToSTP" port="IN_PORT" /><messages durabilitySource="Application" /><logmodules /></route></routes></application>