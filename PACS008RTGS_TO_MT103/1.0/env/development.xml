<?xml version="1.0" encoding="UTF-8"?>
<target:target xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:target="http://fiorano.com/environment/1.0" xsi:schemaLocation="http://fiorano.com/environment/1.0 env.xsd">
  <target:instance name="XML2MT">
    <target:instance-properties>
      <target:deployment cache="true" nodes="fes"/>
    </target:instance-properties>
    <target:configuration-properties>
      <target:property configurationType="resource" encrypt="false" name="MessageSchema Directory Configuration" type="NamedObject">SwiftMTSchemaDirectory</target:property>
    </target:configuration-properties>
  </target:instance>
  <target:instance name="SwiftTranslator">
    <target:instance-properties>
      <target:deployment cache="true" nodes="fes"/>
    </target:instance-properties>
    <target:configuration-properties>
      <target:property encrypt="false" name="XSL" type="java.lang.String">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?>
&lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xalan=&quot;http://xml.apache.org/xslt&quot; xmlns:datetime=&quot;http://exslt.org/dates-and-times&quot; xmlns:math=&quot;http://exslt.org/math&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; xmlns:lxslt=&quot;http://xml.apache.org/xslt&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:java=&quot;http://xml.apache.org/xslt/java&quot; xmlns:set=&quot;http://exslt.org/sets&quot; exclude-result-prefixes=&quot;xalan java lxslt&quot; xmlns:ns4=&quot;urn:iso:std:iso:20022:tech:xsd:head.001.001.01&quot; xmlns:ns2=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:ns5=&quot;urn:swift:xsd:mtmsg.2020&quot; xmlns:ns6=&quot;urn:swift:xsd:fin.103.2020&quot; xmlns:ns1=&quot;urn:swift:xsd:envelope&quot; xmlns:ns3=&quot;urn:iso:std:iso:20022:tech:xsd:pacs.008.001.08&quot; xmlns:MX2MT=&quot;http://xml.apache.org/xslt/java&quot; xmlns:MXToMT=&quot;http://xml.apache.org/xslt/java&quot; xmlns:MXtoMT=&quot;http://xml.apache.org/xslt/java&quot; xmlns:QueryGenerator=&quot;QueryGenerator&quot; xmlns:dateConversion=&quot;dateConversion&quot; xmlns:myext=&quot;myext&quot; xmlns:strings=&quot;strings&quot; extension-element-prefixes=&quot;datetime set math MX2MT MXToMT MXtoMT QueryGenerator dateConversion myext strings&quot;>
  &lt;xsl:import href=&quot;GLOBAL_FUNCLET_PATH&quot;>&lt;/xsl:import>
  &lt;xsl:output method=&quot;xml&quot; indent=&quot;yes&quot; encoding=&quot;UTF-8&quot; xalan:indent-amount=&quot;2&quot; omit-xml-declaration=&quot;no&quot;>&lt;/xsl:output>
  &lt;xsl:variable name=&quot;document&quot; select=&quot;/&quot;>&lt;/xsl:variable>
  &lt;xsl:variable name=&quot;document_IN_PORT&quot; select=&quot;document('IN_PORT')&quot;>&lt;/xsl:variable>&lt;!--The list of parameters defined by user-->&#xD;
  &lt;xsl:param name=&quot;_TIF_MESSAGE_&quot;>&lt;/xsl:param>&#xD;
&lt;!--The list of Extensions defined by user-->&#xD;
&lt;xsl:variable name=&quot;LineSeparator&quot;>&#xD;
	&lt;xsl:value-of select=&quot;'ENDOFLINE'&quot;/>&#xD;
&lt;/xsl:variable>&#xD;
&lt;xsl:variable name=&quot;VariableSeparator&quot;>&#xD;
	&lt;xsl:value-of select=&quot;'ENDOFVAR'&quot;/>&#xD;
&lt;/xsl:variable>
  &lt;xsl:template match=&quot;/&quot;>
    &lt;ns5:FinMessage>
      &lt;ns5:Block1>&lt;ns5:ApplicationIdentifier>&#xD;
          &lt;xsl:value-of select=&quot;'F'&quot;>&lt;/xsl:value-of>&#xD;
        &lt;/ns5:ApplicationIdentifier>&#xD;
        &lt;ns5:ServiceIdentifier>&#xD;
          &lt;xsl:value-of select=&quot;'01'&quot;>&lt;/xsl:value-of>&#xD;
        &lt;/ns5:ServiceIdentifier>&#xD;
        &lt;ns5:LogicalTerminalAddress>&#xD;
          &lt;xsl:variable name=&quot;if0&quot;>&#xD;
            &lt;xsl:choose>&#xD;
              &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))&quot;>&#xD;
                &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:To/ns4:FIId/ns4:FinInstnId/ns4:BICFI&quot;>&lt;/xsl:value-of>&#xD;
              &lt;/xsl:when>&#xD;
              &lt;xsl:otherwise>&#xD;
                &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI&quot;>&lt;/xsl:value-of>&#xD;
              &lt;/xsl:otherwise>&#xD;
            &lt;/xsl:choose>&#xD;
          &lt;/xsl:variable>&#xD;
          &lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MT_BICFI_LogicalAddress(string($if0))&quot;>&lt;/xsl:value-of>&#xD;
        &lt;/ns5:LogicalTerminalAddress>&#xD;
 &lt;ns5:SessionNumber>&#xD;
	&lt;xsl:value-of select=&quot;substring(java:_getStringProperty($_TIF_MESSAGE_, 'SequenceNumber'),'1','4')&quot;/>&#xD;
&lt;/ns5:SessionNumber>&#xD;
&lt;ns5:SequenceNumber>&#xD;
	&lt;xsl:value-of select=&quot;substring(java:_getStringProperty($_TIF_MESSAGE_, 'SequenceNumber'),'5','6')&quot;/>&#xD;
&lt;/ns5:SequenceNumber>&#xD;
&#xD;
&lt;!--
        &lt;ns5:ApplicationIdentifier>
          &lt;xsl:value-of select=&quot;'F'&quot;>&lt;/xsl:value-of>
        &lt;/ns5:ApplicationIdentifier>
        &lt;ns5:ServiceIdentifier>
          &lt;xsl:value-of select=&quot;'01'&quot;>&lt;/xsl:value-of>
        &lt;/ns5:ServiceIdentifier>
        &lt;ns5:LogicalTerminalAddress>
          &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_BICFI_LogicalAddress(string($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:To/ns4:FIId/ns4:FinInstnId/ns4:BICFI))&quot;>&lt;/xsl:value-of>
        &lt;/ns5:LogicalTerminalAddress>
        &lt;ns5:SessionNumber>
          &lt;xsl:value-of select=&quot;'0000'&quot;>&lt;/xsl:value-of>
        &lt;/ns5:SessionNumber>
        &lt;ns5:SequenceNumber>
          &lt;xsl:value-of select=&quot;'000000'&quot;>&lt;/xsl:value-of>
        &lt;/ns5:SequenceNumber>-->&lt;/ns5:Block1>
      &lt;ns5:Block2>&lt;!-- User code ends here -->&#xD;
&#xD;
        &lt;ns5:InputIdentifier>&#xD;
          &lt;xsl:variable name=&quot;if1&quot;>&#xD;
            &lt;xsl:choose>&#xD;
              &lt;xsl:when test=&quot;(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))=('I')&quot;>&#xD;
                &lt;xsl:value-of select=&quot;'I'&quot;>&lt;/xsl:value-of>&#xD;
              &lt;/xsl:when>&#xD;
            &lt;/xsl:choose>&#xD;
          &lt;/xsl:variable>&#xD;
          &lt;xsl:value-of select=&quot;$if1&quot;>&lt;/xsl:value-of>&#xD;
        &lt;/ns5:InputIdentifier>&#xD;
        &lt;ns5:MessageType>&#xD;
          &lt;xsl:variable name=&quot;if2&quot;>&#xD;
            &lt;xsl:choose>&#xD;
              &lt;xsl:when test=&quot;(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))=('I')&quot;>&#xD;
                &lt;xsl:value-of select=&quot;'103'&quot;>&lt;/xsl:value-of>&#xD;
              &lt;/xsl:when>&#xD;
            &lt;/xsl:choose>&#xD;
          &lt;/xsl:variable>&#xD;
          &lt;xsl:value-of select=&quot;$if2&quot;>&lt;/xsl:value-of>&#xD;
        &lt;/ns5:MessageType>&#xD;
        &lt;ns5:DestinationAddress>&#xD;
          &lt;xsl:variable name=&quot;if3&quot;>&#xD;
            &lt;xsl:choose>&#xD;
              &lt;xsl:when test=&quot;(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))=('I')&quot;>&#xD;
                &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_BICFI_LogicalAddress(string($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:To/ns4:FIId/ns4:FinInstnId/ns4:BICFI))&quot;>&lt;/xsl:value-of>&#xD;
              &lt;/xsl:when>&#xD;
            &lt;/xsl:choose>&#xD;
          &lt;/xsl:variable>&#xD;
          &lt;xsl:value-of select=&quot;$if3&quot;>&lt;/xsl:value-of>&#xD;
        &lt;/ns5:DestinationAddress>&#xD;
        &lt;ns5:MessagePriority>&#xD;
          &lt;xsl:variable name=&quot;if4&quot;>&#xD;
            &lt;xsl:choose>&#xD;
              &lt;xsl:when test=&quot;(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))=('I')&quot;>&#xD;
                &lt;xsl:variable name=&quot;if5&quot;>&#xD;
                  &lt;xsl:choose>&#xD;
                    &lt;xsl:when test=&quot;($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Prty)=('HIGH')&quot;>&#xD;
                      &lt;xsl:value-of select=&quot;'U'&quot;>&lt;/xsl:value-of>&#xD;
                    &lt;/xsl:when>&#xD;
                    &lt;xsl:otherwise>&#xD;
                      &lt;xsl:value-of select=&quot;'N'&quot;>&lt;/xsl:value-of>&#xD;
                    &lt;/xsl:otherwise>&#xD;
                  &lt;/xsl:choose>&#xD;
                &lt;/xsl:variable>&#xD;
                &lt;xsl:value-of select=&quot;$if5&quot;>&lt;/xsl:value-of>&#xD;
              &lt;/xsl:when>&#xD;
            &lt;/xsl:choose>&#xD;
          &lt;/xsl:variable>&#xD;
          &lt;xsl:value-of select=&quot;$if4&quot;>&lt;/xsl:value-of>&#xD;
        &lt;/ns5:MessagePriority>&#xD;
        &lt;ns5:OutputIdentifier>&#xD;
          &lt;xsl:variable name=&quot;if6&quot;>&#xD;
            &lt;xsl:choose>&#xD;
              &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))&quot;>&#xD;
                &lt;xsl:value-of select=&quot;'O'&quot;>&lt;/xsl:value-of>&#xD;
              &lt;/xsl:when>&#xD;
            &lt;/xsl:choose>&#xD;
          &lt;/xsl:variable>&#xD;
          &lt;xsl:value-of select=&quot;$if6&quot;>&lt;/xsl:value-of>&#xD;
        &lt;/ns5:OutputIdentifier>&#xD;
        &lt;ns5:MessageType>&#xD;
          &lt;xsl:variable name=&quot;if7&quot;>&#xD;
            &lt;xsl:choose>&#xD;
              &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))&quot;>&#xD;
                &lt;xsl:value-of select=&quot;'103'&quot;>&lt;/xsl:value-of>&#xD;
              &lt;/xsl:when>&#xD;
            &lt;/xsl:choose>&#xD;
          &lt;/xsl:variable>&#xD;
          &lt;xsl:value-of select=&quot;$if7&quot;>&lt;/xsl:value-of>&#xD;
        &lt;/ns5:MessageType>&#xD;
        &lt;ns5:InputTime>&#xD;
          &lt;xsl:variable name=&quot;if8&quot;>&#xD;
             &lt;xsl:choose>&#xD;
                &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputTime'))&quot;>&#xD;
                  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'OutputTime')&quot;>&lt;/xsl:value-of>&#xD;
                &lt;/xsl:when>&#xD;
				&#xD;
				 &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and (not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputTime'))))&quot;>&#xD;
                   &lt;xsl:value-of select=&quot;'0000'&quot;>&lt;/xsl:value-of>&#xD;
                &lt;/xsl:when>&#xD;
              &lt;/xsl:choose>&#xD;
          &lt;/xsl:variable>&#xD;
          &lt;xsl:value-of select=&quot;$if8&quot;>&lt;/xsl:value-of>&#xD;
        &lt;/ns5:InputTime>&#xD;
        &lt;ns5:MessageInputReference>&#xD;
          &lt;ns5:Date>&#xD;
            &lt;xsl:variable name=&quot;if9&quot;>&#xD;
                &lt;xsl:choose>&#xD;
                &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputDate'))&quot;>&#xD;
                  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'OutputDate')&quot;>&lt;/xsl:value-of>&#xD;
                &lt;/xsl:when>&#xD;
				&#xD;
				 &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and (not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputDate'))))&quot;>&#xD;
                   &lt;xsl:value-of select=&quot;'991231'&quot;>&lt;/xsl:value-of>&#xD;
                &lt;/xsl:when>&#xD;
              &lt;/xsl:choose>&#xD;
            &lt;/xsl:variable>&#xD;
            &lt;xsl:value-of select=&quot;$if9&quot;>&lt;/xsl:value-of>&#xD;
          &lt;/ns5:Date>&#xD;
          &lt;ns5:LTIdentifier>&#xD;
            &lt;xsl:variable name=&quot;if10&quot;>&#xD;
              &lt;xsl:choose>&#xD;
                &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))&quot;>&#xD;
                  &lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MT_BICFI_LTIAddress(string($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI))&quot;>&lt;/xsl:value-of>&#xD;
                &lt;/xsl:when>&#xD;
              &lt;/xsl:choose>&#xD;
            &lt;/xsl:variable>&#xD;
            &lt;xsl:value-of select=&quot;$if10&quot;>&lt;/xsl:value-of>&#xD;
          &lt;/ns5:LTIdentifier>&#xD;
          &lt;ns5:BranchCode>&#xD;
            &lt;xsl:variable name=&quot;if11&quot;>&#xD;
              &lt;xsl:choose>&#xD;
                &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))&quot;>&#xD;
                  &lt;xsl:variable name=&quot;if12&quot;>&#xD;
                    &lt;xsl:choose>&#xD;
                      &lt;xsl:when test=&quot;(string-length($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI))&amp;gt;=('11')&quot;>&#xD;
                        &lt;xsl:value-of select=&quot;substring($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI,(string-length($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI))-('2'),string-length($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI))&quot;>&lt;/xsl:value-of>&#xD;
                      &lt;/xsl:when>&#xD;
                      &lt;xsl:otherwise>&#xD;
                        &lt;xsl:value-of select=&quot;'XXX'&quot;>&lt;/xsl:value-of>&#xD;
                      &lt;/xsl:otherwise>&#xD;
                    &lt;/xsl:choose>&#xD;
                  &lt;/xsl:variable>&#xD;
                  &lt;xsl:value-of select=&quot;$if12&quot;>&lt;/xsl:value-of>&#xD;
                &lt;/xsl:when>&#xD;
              &lt;/xsl:choose>&#xD;
            &lt;/xsl:variable>&#xD;
            &lt;xsl:value-of select=&quot;$if11&quot;>&lt;/xsl:value-of>&#xD;
          &lt;/ns5:BranchCode>&#xD;
          &lt;ns5:SessionNumber>&#xD;
            &lt;xsl:variable name=&quot;if13&quot;>&#xD;
              &lt;xsl:choose>&#xD;
                &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))&quot;>&#xD;
                  &lt;xsl:value-of select=&quot;substring(java:_getStringProperty($_TIF_MESSAGE_, 'SequenceNumber'),'1','4')&quot;/>&#xD;
                &lt;/xsl:when>&#xD;
              &lt;/xsl:choose>&#xD;
            &lt;/xsl:variable>&#xD;
            &lt;xsl:value-of select=&quot;$if13&quot;>&lt;/xsl:value-of>&#xD;
          &lt;/ns5:SessionNumber>&#xD;
          &lt;ns5:ISN>&#xD;
            &lt;xsl:variable name=&quot;if14&quot;>&#xD;
              &lt;xsl:choose>&#xD;
                &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))&quot;>&#xD;
                  &lt;xsl:value-of select=&quot;substring(java:_getStringProperty($_TIF_MESSAGE_, 'SequenceNumber'),'5','6')&quot;/>&#xD;
                &lt;/xsl:when>&#xD;
              &lt;/xsl:choose>&#xD;
            &lt;/xsl:variable>&#xD;
            &lt;xsl:value-of select=&quot;$if14&quot;>&lt;/xsl:value-of>&#xD;
          &lt;/ns5:ISN>&#xD;
        &lt;/ns5:MessageInputReference>&#xD;
        &lt;ns5:Date>&#xD;
          &lt;xsl:variable name=&quot;if15&quot;>&#xD;
              &lt;xsl:choose>&#xD;
                &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputDate'))&quot;>&#xD;
                  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'OutputDate')&quot;>&lt;/xsl:value-of>&#xD;
                &lt;/xsl:when>&#xD;
				&#xD;
				 &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and (not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputDate'))))&quot;>&#xD;
                   &lt;xsl:value-of select=&quot;'991231'&quot;>&lt;/xsl:value-of>&#xD;
                &lt;/xsl:when>&#xD;
              &lt;/xsl:choose>&#xD;
          &lt;/xsl:variable>&#xD;
          &lt;xsl:value-of select=&quot;$if15&quot;>&lt;/xsl:value-of>&#xD;
        &lt;/ns5:Date>&#xD;
        &lt;ns5:Time>&#xD;
          &lt;xsl:variable name=&quot;if16&quot;>&#xD;
           &lt;xsl:choose>&#xD;
                &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputTime'))&quot;>&#xD;
                  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'OutputTime')&quot;>&lt;/xsl:value-of>&#xD;
                &lt;/xsl:when>&#xD;
				&#xD;
				 &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode')))) and (not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'OutputTime'))))&quot;>&#xD;
                   &lt;xsl:value-of select=&quot;'0000'&quot;>&lt;/xsl:value-of>&#xD;
                &lt;/xsl:when>&#xD;
              &lt;/xsl:choose>&#xD;
          &lt;/xsl:variable>&#xD;
          &lt;xsl:value-of select=&quot;$if16&quot;>&lt;/xsl:value-of>&#xD;
        &lt;/ns5:Time>&#xD;
        &lt;ns5:MessagePriority>&#xD;
          &lt;xsl:variable name=&quot;if17&quot;>&#xD;
            &lt;xsl:choose>&#xD;
              &lt;xsl:when test=&quot;((java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))!=('I') or not(string-length(java:_getStringProperty($_TIF_MESSAGE_, 'ApplicationMode'))))&quot;>&#xD;
                &lt;xsl:variable name=&quot;if18&quot;>&#xD;
                  &lt;xsl:choose>&#xD;
                    &lt;xsl:when test=&quot;($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Prty)=('HIGH')&quot;>&#xD;
                      &lt;xsl:value-of select=&quot;'U'&quot;>&lt;/xsl:value-of>&#xD;
                    &lt;/xsl:when>&#xD;
                    &lt;xsl:otherwise>&#xD;
                      &lt;xsl:value-of select=&quot;'N'&quot;>&lt;/xsl:value-of>&#xD;
                    &lt;/xsl:otherwise>&#xD;
                  &lt;/xsl:choose>&#xD;
                &lt;/xsl:variable>&#xD;
                &lt;xsl:value-of select=&quot;$if18&quot;>&lt;/xsl:value-of>&#xD;
              &lt;/xsl:when>&#xD;
            &lt;/xsl:choose>&#xD;
          &lt;/xsl:variable>&#xD;
          &lt;xsl:value-of select=&quot;$if17&quot;>&lt;/xsl:value-of>&#xD;
        &lt;/ns5:MessagePriority>&#xD;
&lt;!--
        &lt;xsl:if test=&quot;string-length('O')&quot;>
          &lt;ns5:OutputIdentifier>
            &lt;xsl:value-of select=&quot;'O'&quot;>&lt;/xsl:value-of>
          &lt;/ns5:OutputIdentifier>
        &lt;/xsl:if>
        &lt;xsl:if test=&quot;string-length('103')&quot;>
          &lt;ns5:MessageType>
            &lt;xsl:value-of select=&quot;'103'&quot;>&lt;/xsl:value-of>
          &lt;/ns5:MessageType>
        &lt;/xsl:if>
        &lt;xsl:if test=&quot;string-length('0000')&quot;>
          &lt;ns5:InputTime>
            &lt;xsl:value-of select=&quot;'0000'&quot;>&lt;/xsl:value-of>
          &lt;/ns5:InputTime>
        &lt;/xsl:if>
        &lt;ns5:MessageInputReference>
          &lt;ns5:Date>
            &lt;xsl:value-of select=&quot;'991231'&quot;>&lt;/xsl:value-of>
          &lt;/ns5:Date>
          &lt;ns5:LTIdentifier>
            &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_BICFI_LTIAddress(string($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI))&quot;>&lt;/xsl:value-of>
          &lt;/ns5:LTIdentifier>
          &lt;ns5:BranchCode>
            &lt;xsl:variable name=&quot;if0&quot;>
              &lt;xsl:choose>
                &lt;xsl:when test=&quot;(string-length($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI))&amp;gt;=('11')&quot;>
                  &lt;xsl:value-of select=&quot;substring($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI,(string-length($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI))-('2'))&quot;>&lt;/xsl:value-of>
                &lt;/xsl:when>
                &lt;xsl:otherwise>
                  &lt;xsl:value-of select=&quot;'XXX'&quot;>&lt;/xsl:value-of>
                &lt;/xsl:otherwise>
              &lt;/xsl:choose>
            &lt;/xsl:variable>
            &lt;xsl:value-of select=&quot;$if0&quot;>&lt;/xsl:value-of>
          &lt;/ns5:BranchCode>
          &lt;ns5:SessionNumber>
            &lt;xsl:value-of select=&quot;'0000'&quot;>&lt;/xsl:value-of>
          &lt;/ns5:SessionNumber>
          &lt;ns5:ISN>
            &lt;xsl:value-of select=&quot;'000000'&quot;>&lt;/xsl:value-of>
          &lt;/ns5:ISN>
        &lt;/ns5:MessageInputReference>
        &lt;xsl:if test=&quot;string-length('991231')&quot;>
          &lt;ns5:Date>
            &lt;xsl:value-of select=&quot;'991231'&quot;>&lt;/xsl:value-of>
          &lt;/ns5:Date>
        &lt;/xsl:if>
        &lt;xsl:if test=&quot;string-length('0000')&quot;>
          &lt;ns5:Time>
            &lt;xsl:value-of select=&quot;'0000'&quot;>&lt;/xsl:value-of>
          &lt;/ns5:Time>
        &lt;/xsl:if>
        &lt;xsl:variable name=&quot;if1&quot;>
          &lt;xsl:choose>
            &lt;xsl:when test=&quot;($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Prty)=('HIGH')&quot;>
              &lt;xsl:value-of select=&quot;'U'&quot;>&lt;/xsl:value-of>
            &lt;/xsl:when>
            &lt;xsl:otherwise>
              &lt;xsl:value-of select=&quot;'N'&quot;>&lt;/xsl:value-of>
            &lt;/xsl:otherwise>
          &lt;/xsl:choose>
        &lt;/xsl:variable>
        &lt;xsl:if test=&quot;string-length($if1)&quot;>
          &lt;ns5:MessagePriority>
            &lt;xsl:variable name=&quot;if2&quot;>
              &lt;xsl:choose>
                &lt;xsl:when test=&quot;($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Prty)=('HIGH')&quot;>
                  &lt;xsl:value-of select=&quot;'U'&quot;>&lt;/xsl:value-of>
                &lt;/xsl:when>
                &lt;xsl:otherwise>
                  &lt;xsl:value-of select=&quot;'N'&quot;>&lt;/xsl:value-of>
                &lt;/xsl:otherwise>
              &lt;/xsl:choose>
            &lt;/xsl:variable>
            &lt;xsl:value-of select=&quot;$if2&quot;>&lt;/xsl:value-of>
          &lt;/ns5:MessagePriority>
        &lt;/xsl:if>-->&lt;/ns5:Block2>
      &lt;ns5:Block3>
        &lt;xsl:if test=&quot;string-length('')&quot;>
          &lt;ns5:F103>
            &lt;xsl:value-of select=&quot;''&quot;>&lt;/xsl:value-of>
          &lt;/ns5:F103>
        &lt;/xsl:if>
        &lt;ns5:F113>&lt;xsl:value-of select=&quot;java:_setBooleanProperty($_TIF_MESSAGE_, 'isIncludeAdditionalDetails', '1')&quot;>&lt;/xsl:value-of>&lt;/ns5:F113>
        &lt;xsl:variable name=&quot;if3&quot;>
          &lt;xsl:choose>
            &lt;xsl:when test=&quot;starts-with($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl/ns3:Cd,'G00')&quot;>
              &lt;xsl:value-of select=&quot;substring($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl/ns3:Cd,'2','3')&quot;>&lt;/xsl:value-of>
            &lt;/xsl:when>
          &lt;/xsl:choose>
        &lt;/xsl:variable>
        &lt;xsl:if test=&quot;string-length($if3)&quot;>
          &lt;ns5:F111>
            &lt;xsl:variable name=&quot;if4&quot;>
              &lt;xsl:choose>
                &lt;xsl:when test=&quot;starts-with($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl/ns3:Cd,'G00')&quot;>
                  &lt;xsl:value-of select=&quot;substring($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl/ns3:Cd,'2','3')&quot;>&lt;/xsl:value-of>
                &lt;/xsl:when>
              &lt;/xsl:choose>
            &lt;/xsl:variable>
            &lt;xsl:value-of select=&quot;$if4&quot;>&lt;/xsl:value-of>
          &lt;/ns5:F111>
        &lt;/xsl:if>
        &lt;xsl:if test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId/ns3:UETR)&quot;>
          &lt;ns5:F121>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId/ns3:UETR&quot;>&lt;/xsl:value-of>
            &lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'UETR_ID', $document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId/ns3:UETR)&quot;>&lt;/xsl:value-of>
            &lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', '')&quot;>&lt;/xsl:value-of>
          &lt;/ns5:F121>
        &lt;/xsl:if>
      &lt;/ns5:Block3>
      &lt;ns5:Block4>
        &lt;ns6:Document>
          &lt;ns6:MT103>
            &lt;ns6:F20a>
              &lt;xsl:if test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId/ns3:InstrId)&quot;>
                &lt;ns6:F20>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId/ns3:InstrId&quot;>&lt;/xsl:value-of>
                &lt;/ns6:F20>
              &lt;/xsl:if>
            &lt;/ns6:F20a>&lt;xsl:variable name=&quot;MT13C&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:SttlmTmIndctn&quot;>&#xD;
	  &lt;xsl:if test=&quot;string-length(./ns3:DbtDtTm)&quot;>&#xD;
        &lt;xsl:value-of select=&quot;'SNDTIME'&quot;>&lt;/xsl:value-of>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:DbtDtTm&quot;>&lt;/xsl:value-of>&#xD;
	    &lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
      &lt;/xsl:if>&#xD;
	  &lt;xsl:if test=&quot;string-length(./ns3:CdtDtTm)&quot;>&#xD;
        &lt;xsl:value-of select=&quot;'RNCTIME'&quot;>&lt;/xsl:value-of>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:CdtDtTm&quot;>&lt;/xsl:value-of>&#xD;
	    &lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
      &lt;/xsl:if>&#xD;
	&lt;/xsl:for-each>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:SttlmTmReq&quot;>&#xD;
	  &lt;xsl:if test=&quot;string-length(./ns3:CLSTm)&quot;>&#xD;
        &lt;xsl:value-of select=&quot;'CLSTIME'&quot;>&lt;/xsl:value-of>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:CLSTm&quot;>&lt;/xsl:value-of>&#xD;
	    &lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
      &lt;/xsl:if>&#xD;
	  &lt;xsl:if test=&quot;string-length(./ns3:TillTm)&quot;>&#xD;
        &lt;xsl:value-of select=&quot;'TILTIME'&quot;>&lt;/xsl:value-of>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:TillTm&quot;>&lt;/xsl:value-of>&#xD;
	    &lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
      &lt;/xsl:if>&#xD;
	  &lt;xsl:if test=&quot;string-length(./ns3:FrTm)&quot;>&#xD;
        &lt;xsl:value-of select=&quot;'FROTIME'&quot;>&lt;/xsl:value-of>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:FrTm&quot;>&lt;/xsl:value-of>&#xD;
	    &lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
      &lt;/xsl:if>&#xD;
	  &lt;xsl:if test=&quot;string-length(./ns3:RjctTm)&quot;>&#xD;
        &lt;xsl:value-of select=&quot;'REJTIME'&quot;>&lt;/xsl:value-of>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:RjctTm&quot;>&lt;/xsl:value-of>&#xD;
      &lt;/xsl:if>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&#xD;
&lt;xsl:call-template name=&quot;tokenizeF13C&quot;>&#xD;
	&lt;xsl:with-param name=&quot;text&quot; select=&quot;$MT13C&quot;/>&#xD;
	&lt;xsl:with-param name=&quot;separator&quot; select=&quot;$LineSeparator&quot;/>&#xD;
&lt;/xsl:call-template>
            &lt;ns6:F13a>&lt;!-- User code starts here -->&lt;/ns6:F13a>
            &lt;ns6:F23a_1>
              &lt;xsl:if test=&quot;string-length('CRED')&quot;>
                &lt;ns6:F23B>
                  &lt;xsl:value-of select=&quot;'CRED'&quot;>&lt;/xsl:value-of>
                &lt;/ns6:F23B>
              &lt;/xsl:if>
            &lt;/ns6:F23a_1>
            &lt;ns6:F23a_2>
              &lt;ns6:F23E>
                &lt;ns6:InstructionCode>
                  &lt;xsl:variable name=&quot;if5&quot;>
                    &lt;xsl:choose>
                      &lt;xsl:when test=&quot;('SDVA')=($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl/ns3:Cd)&quot;>
                        &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl/ns3:Cd&quot;>&lt;/xsl:value-of>
                      &lt;/xsl:when>
                    &lt;/xsl:choose>
                  &lt;/xsl:variable>
                  &lt;xsl:value-of select=&quot;$if5&quot;>&lt;/xsl:value-of>
                &lt;/ns6:InstructionCode>
              &lt;/ns6:F23E>
            &lt;/ns6:F23a_2>&lt;xsl:if test=&quot;($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Prtry)=('INTC CORT')&quot;>&#xD;
  &lt;ns2:F23a_2>&#xD;
    &lt;ns2:F23E>&#xD;
      &lt;ns2:InstructionCode>&#xD;
	    &lt;xsl:value-of select=&quot;'INTC'&quot;>&lt;/xsl:value-of>&#xD;
	  &lt;/ns2:InstructionCode>&#xD;
    &lt;/ns2:F23E>&#xD;
  &lt;/ns2:F23a_2>&#xD;
  &lt;ns2:F23a_2>&#xD;
    &lt;ns2:F23E>&#xD;
      &lt;ns2:InstructionCode>&#xD;
	    &lt;xsl:value-of select=&quot;'CORT'&quot;>&lt;/xsl:value-of>&#xD;
	  &lt;/ns2:InstructionCode>&#xD;
    &lt;/ns2:F23E>&#xD;
  &lt;/ns2:F23a_2>&#xD;
&lt;/xsl:if>&#xD;
&#xD;
   &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForCdtrAgt&quot;>&#xD;
  &lt;xsl:if test=&quot;string-length(./ns3:Cd)&quot;>&#xD;
&lt;ns2:F23a_2>&#xD;
    &lt;ns2:F23E>&#xD;
      &lt;ns2:InstructionCode>&#xD;
	    &lt;xsl:value-of select=&quot;./ns3:Cd&quot;>&lt;/xsl:value-of>&#xD;
	  &lt;/ns2:InstructionCode>&#xD;
	      &lt;ns2:AdditionalInformation>&#xD;
	    &lt;xsl:value-of select=&quot;./ns3:InstrInf&quot;>&lt;/xsl:value-of>&#xD;
	    &lt;/ns2:AdditionalInformation>&#xD;
    &lt;/ns2:F23E>&#xD;
  &lt;/ns2:F23a_2>&#xD;
   &lt;/xsl:if>&#xD;
&lt;/xsl:for-each>
            &lt;ns6:F23a_2>
              &lt;ns6:F23E>
                &lt;ns6:InstructionCode>
                  &lt;xsl:variable name=&quot;if6&quot;>
                    &lt;xsl:choose>
                      &lt;xsl:when test=&quot;(('INTC')=($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Cd) or ('CORT')=($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Cd))&quot;>
                        &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Cd&quot;>&lt;/xsl:value-of>
                      &lt;/xsl:when>
                    &lt;/xsl:choose>
                  &lt;/xsl:variable>
                  &lt;xsl:value-of select=&quot;$if6&quot;>&lt;/xsl:value-of>
                &lt;/ns6:InstructionCode>
              &lt;/ns6:F23E>
            &lt;/ns6:F23a_2>&lt;xsl:variable name=&quot;F23EFull&quot;>&#xD;
	&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT23E(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForCdtrAgt[1]/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForCdtrAgt[1]/ns3:InstrInf),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForCdtrAgt[2]/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForCdtrAgt[2]/ns3:InstrInf))&quot;>&lt;/xsl:value-of>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:call-template name=&quot;tokenizeF23E&quot;>&#xD;
	&lt;xsl:with-param name=&quot;text&quot; select=&quot;$F23EFull&quot;/>&#xD;
&lt;/xsl:call-template>
            &lt;ns6:F32a>
              &lt;ns6:F32A>
                &lt;ns6:Date>
                  &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTDate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrBkSttlmDt))&quot;>&lt;/xsl:value-of>
                &lt;/ns6:Date>
                &lt;ns6:Currency>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrBkSttlmAmt/@Ccy&quot;>&lt;/xsl:value-of>
                &lt;/ns6:Currency>
                &lt;ns6:Amount>
                  &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTCurrencyAmount(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrBkSttlmAmt))&quot;>&lt;/xsl:value-of>
                &lt;/ns6:Amount>
              &lt;/ns6:F32A>
            &lt;/ns6:F32a>&lt;xsl:if test=&quot;(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstdAmt)) and MX2MT:com.fiorano.funclet.MXtoMT.isEUCountry(string(substring($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:Fr/ns4:FIId/ns4:FinInstnId/ns4:BICFI,'5','2'))) and MX2MT:com.fiorano.funclet.MXtoMT.isEUCountry(string(substring($document_IN_PORT/ns1:Envelope/ns4:AppHdr/ns4:To/ns4:FIId/ns4:FinInstnId/ns4:BICFI,'5','2'))))&quot;>&#xD;
  &lt;ns2:F33a>&#xD;
  &lt;ns2:F33B>&#xD;
    &lt;ns2:Currency>&#xD;
      &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrBkSttlmAmt/@Ccy&quot;>&lt;/xsl:value-of>&#xD;
    &lt;/ns2:Currency>&#xD;
    &lt;ns2:Amount>&#xD;
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTCurrencyAmount(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrBkSttlmAmt))&quot;>&lt;/xsl:value-of>&#xD;
    &lt;/ns2:Amount>&#xD;
  &lt;/ns2:F33B>&#xD;
  &lt;/ns2:F33a>&#xD;
&lt;/xsl:if>
            &lt;ns6:F33a>
              &lt;ns6:F33B>
                &lt;ns6:Currency>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstdAmt/@Ccy&quot;>&lt;/xsl:value-of>
                &lt;/ns6:Currency>
                &lt;ns6:Amount>
                  &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTCurrencyAmount(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstdAmt))&quot;>&lt;/xsl:value-of>
                &lt;/ns6:Amount>
              &lt;/ns6:F33B>
            &lt;/ns6:F33a>
            &lt;ns6:F36a>
              &lt;xsl:if test=&quot;string-length(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_Rate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:XchgRate)))&quot;>
                &lt;ns6:F36>
                  &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_Rate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:XchgRate))&quot;>&lt;/xsl:value-of>
                &lt;/ns6:F36>
              &lt;/xsl:if>
            &lt;/ns6:F36a>
            &lt;ns6:F50a>
              &lt;ns6:F50A>
                &lt;ns6:Account>&lt;xsl:variable name=&quot;if21&quot;>
                    &lt;xsl:choose>
                      &lt;xsl:when test=&quot;(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC) and string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr))&quot;>
                        &lt;xsl:variable name=&quot;if22&quot;>
                          &lt;xsl:choose>
                            &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)&quot;>
                              &lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                            &lt;/xsl:when>
                          &lt;/xsl:choose>
                        &lt;/xsl:variable>
                       &lt;xsl:value-of select=&quot;normalize-space(substring-before($if22,'ENDOFOUTPUT'))&quot;/>
&lt;xsl:variable name=&quot;TruncTemp&quot;>
  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>
&lt;/xsl:variable>

&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F50A_Account_ENDOFFIELDTAG',substring-after($if22,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/> 
                      &lt;/xsl:when>
                    &lt;/xsl:choose>
                  &lt;/xsl:variable>
                  &lt;xsl:value-of select=&quot;$if21&quot;>&lt;/xsl:value-of>&lt;/ns6:Account>
                &lt;ns6:IdentifierCode>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC&quot;>&lt;/xsl:value-of>
                &lt;/ns6:IdentifierCode>
              &lt;/ns6:F50A>
              &lt;ns6:F50F>
                &lt;ns6:PartyIdentifier>
                  &lt;ns6:Account>&lt;xsl:variable name=&quot;LineSeparator&quot;>
&lt;xsl:value-of select=&quot;'ENDOFFLINE'&quot;/>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;VariableSeparator&quot;>
  &lt;xsl:value-of select=&quot;'ENDOFFVAR'&quot;/>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;AppendedPostalAddress&quot;>
&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine&quot;>
&lt;xsl:value-of select=&quot;.&quot; />
 &lt;xsl:value-of select=&quot;$LineSeparator&quot;/> 
&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;OrgIdentifierTable&quot;>
&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr&quot;>
    &lt;xsl:value-of select=&quot;./ns3:Id&quot;/>
    &lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>
    &lt;xsl:value-of select=&quot;./ns3:SchmeNm/ns3:Cd&quot;/>
    &lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>
    &lt;xsl:value-of select=&quot;./ns3:Issr&quot;/>
    &lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>
    &lt;xsl:value-of select=&quot;$LineSeparator&quot;/>
  &lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;PrivateOrgIdentifierTable&quot;>
&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr&quot;>
    &lt;xsl:value-of select=&quot;./ns3:Id&quot;/>
    &lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>
    &lt;xsl:value-of select=&quot;./ns3:SchmeNm/ns3:Cd&quot;/>
    &lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>
    &lt;xsl:value-of select=&quot;./ns3:Issr&quot;/>
    &lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>
    &lt;xsl:value-of select=&quot;$LineSeparator&quot;/>
  &lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;ResultantMTAddressTable&quot;>
&lt;xsl:choose>
 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))&quot;>
                          &lt;xsl:value-of select=&quot;'NOTPROVIDEDENDOFOUTPUT'&quot;>&lt;/xsl:value-of>
                        &lt;/xsl:when>
            
             &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))&quot;>
             &lt;xsl:value-of select=&quot;'NOTPROVIDEDENDOFOUTPUT'&quot;>&lt;/xsl:value-of>
                        &lt;/xsl:when>
            
             &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id)) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))&quot;>
             &lt;xsl:value-of select=&quot;'NOTPROVIDEDENDOFOUTPUT'&quot;>&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        
         &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))&quot;>
                           &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                        &lt;/xsl:when>
            
             &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))&quot;>
             &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                        &lt;/xsl:when>
            
             &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))&quot;>
             &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                        &lt;/xsl:when>
            
               &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))&quot;>
                           &lt;xsl:value-of select=&quot;concat(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTAccountVal(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes)),'ENDOFOUTPUT')&quot;/>
                        &lt;/xsl:when>
            
             &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))&quot;>
            &lt;xsl:value-of select=&quot;concat(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTAccountVal(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)),'ENDOFOUTPUT')&quot;/>
                        &lt;/xsl:when>
            
             &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes)))&quot;>
            &lt;xsl:value-of select=&quot;concat(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTAccountVal(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes)),'ENDOFOUTPUT')&quot;/>
                        &lt;/xsl:when>
                
      
&lt;/xsl:choose>
&lt;/xsl:variable>
&lt;xsl:value-of select=&quot;normalize-space(substring-before($ResultantMTAddressTable,'ENDOFOUTPUT'))&quot;/>
&lt;xsl:variable name=&quot;TruncTemp&quot;>
  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>
&lt;/xsl:variable>

&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F50F_Account_ENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Account>
                  &lt;ns6:Code>&lt;xsl:variable name=&quot;LineSeparator&quot;>&#xD;
&lt;xsl:value-of select=&quot;'ENDOFFLINE'&quot;/>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;VariableSeparator&quot;>&#xD;
	&lt;xsl:value-of select=&quot;'ENDOFFVAR'&quot;/>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;AppendedPostalAddress&quot;>&#xD;
&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine&quot;>&#xD;
&lt;xsl:value-of select=&quot;.&quot; />&#xD;
 &lt;xsl:value-of select=&quot;$LineSeparator&quot; /> &#xD;
&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;OrgIdentifierTable&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr&quot;>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Id&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:SchmeNm/ns3:Cd&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Issr&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;PrivateOrgIdentifierTable&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr&quot;>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Id&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:SchmeNm/ns3:Cd&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Issr&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&#xD;
&lt;xsl:choose>&#xD;
 &#xD;
												&#xD;
				 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))&quot;>&#xD;
                           &lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTSchemeCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))&quot;/>&#xD;
                        &lt;/xsl:when>&#xD;
						&#xD;
						 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))&quot;>&#xD;
						&lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTSchemeCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))&quot;/>&#xD;
                        &lt;/xsl:when>&#xD;
						&#xD;
						 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))&quot;>&#xD;
						&lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTSchemeCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))&quot;/>&#xD;
                        &lt;/xsl:when>&#xD;
						&#xD;
&lt;/xsl:choose>&lt;/ns6:Code>
                  &lt;ns6:CountryCode>&lt;xsl:variable name=&quot;LineSeparator&quot;>&#xD;
&lt;xsl:value-of select=&quot;'ENDOFFLINE'&quot;/>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;VariableSeparator&quot;>&#xD;
	&lt;xsl:value-of select=&quot;'ENDOFFVAR'&quot;/>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;AppendedPostalAddress&quot;>&#xD;
&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine&quot;>&#xD;
&lt;xsl:value-of select=&quot;.&quot; />&#xD;
 &lt;xsl:value-of select=&quot;$LineSeparator&quot; /> &#xD;
&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;OrgIdentifierTable&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr&quot;>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Id&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:SchmeNm/ns3:Cd&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Issr&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;PrivateOrgIdentifierTable&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr&quot;>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Id&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:SchmeNm/ns3:Cd&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Issr&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&#xD;
&lt;xsl:choose>&#xD;
 &#xD;
												&#xD;
				 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))&quot;>&#xD;
                           &lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTCountryCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))&quot;/>&#xD;
                        &lt;/xsl:when>&#xD;
						&#xD;
						 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))&quot;>&#xD;
						&lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTCountryCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))&quot;/>&#xD;
                        &lt;/xsl:when>&#xD;
						&#xD;
						 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))&quot;>&#xD;
						&lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTCountryCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))&quot;/>&#xD;
                        &lt;/xsl:when>&#xD;
						&#xD;
&lt;/xsl:choose>&lt;/ns6:CountryCode>
                  &lt;ns6:Identifier>&lt;xsl:variable name=&quot;LineSeparator&quot;>&#xD;
&lt;xsl:value-of select=&quot;'ENDOFFLINE'&quot;/>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;VariableSeparator&quot;>&#xD;
	&lt;xsl:value-of select=&quot;'ENDOFFVAR'&quot;/>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;AppendedPostalAddress&quot;>&#xD;
&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine&quot;>&#xD;
&lt;xsl:value-of select=&quot;.&quot; />&#xD;
 &lt;xsl:value-of select=&quot;$LineSeparator&quot; /> &#xD;
&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;OrgIdentifierTable&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr&quot;>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Id&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:SchmeNm/ns3:Cd&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Issr&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;PrivateOrgIdentifierTable&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr&quot;>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Id&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:SchmeNm/ns3:Cd&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Issr&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&#xD;
&lt;xsl:choose>&#xD;
 &#xD;
												&#xD;
				 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))&quot;>&#xD;
                           &lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTPartyIdentifier(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))&quot;/>&#xD;
                        &lt;/xsl:when>&#xD;
						&#xD;
						 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))&quot;>&#xD;
						&lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTPartyIdentifier(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))&quot;/>&#xD;
                        &lt;/xsl:when>&#xD;
						&#xD;
						 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))&quot;>&#xD;
						&lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTPartyIdentifier(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))&quot;/>&#xD;
                        &lt;/xsl:when>&#xD;
						&#xD;
&lt;/xsl:choose>&lt;/ns6:Identifier>
                &lt;/ns6:PartyIdentifier>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name=&quot;LineSeparator&quot;>
	&lt;xsl:value-of select=&quot;'ENDOFLINE'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;VariableSeparator&quot;>
	&lt;xsl:value-of select=&quot;'ENDOFVAR'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;AppendedPostalAddress&quot;>
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine&quot;>
		&lt;xsl:value-of select=&quot;.&quot;/>
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;OrgIdentifierTable&quot;>
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr&quot;>
		&lt;xsl:value-of select=&quot;./ns3:Id&quot;/>
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>
		&lt;xsl:value-of select=&quot;./ns3:SchmeNm/ns3:Cd&quot;/>
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>
		&lt;xsl:value-of select=&quot;./ns3:Issr&quot;/>
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;PrivateOrgIdentifierTable&quot;>
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr&quot;>
		&lt;xsl:value-of select=&quot;./ns3:Id&quot;/>
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>
		&lt;xsl:value-of select=&quot;./ns3:SchmeNm/ns3:Cd&quot;/>
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>
		&lt;xsl:value-of select=&quot;./ns3:Issr&quot;/>
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;MTPartyIndentifier&quot;>
	&lt;xsl:choose>
 
												
				 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))&quot;>
                           &lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTSchemeCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))&quot;/>
                        &lt;/xsl:when>
						
						 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))&quot;>
						&lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFIdentification_MTSchemeCode(string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes))&quot;/>
                        &lt;/xsl:when>
						
								
			
&lt;/xsl:choose>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;ResultantMTAddressTable&quot;>
	&lt;xsl:choose>
	
		&lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))&quot;>
			&lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFNameAndAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:LEI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:BirthDt),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:CityOfBirth),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:CtryOfBirth),string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes),string($MTPartyIndentifier),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry))&quot;/>
		&lt;/xsl:when>

		 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))&quot;>
		 &lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFNameAndAddress2withTruncate(string($AppendedPostalAddress),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:LEI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:BirthDt),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:CityOfBirth),string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes),string($MTPartyIndentifier),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id))&quot;/>
		&lt;/xsl:when>
		&lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))&quot;>
			&lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTFATFNameAndAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($VariableSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:LEI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:BirthDt),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:CityOfBirth),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:PrvtId/ns3:DtAndPlcOfBirth/ns3:CtryOfBirth),string($OrgIdentifierTable),string($PrivateOrgIdentifierTable),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes),string($MTPartyIndentifier),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry))&quot;/>
		&lt;/xsl:when>
		
	
	&lt;/xsl:choose>
&lt;/xsl:variable>


&lt;xsl:variable name=&quot;ResultantMTAddressSplit&quot;>
&lt;xsl:choose>
&lt;xsl:when test=&quot;(string-length($ResultantMTAddressTable))&quot;>
	&lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.SplitAddresstoNumberDetailswithTruncate(string($ResultantMTAddressTable),string($LineSeparator),string($VariableSeparator))&quot;/>
&lt;/xsl:when>
&lt;/xsl:choose>
&lt;/xsl:variable>
&lt;xsl:call-template name=&quot;tokenize3&quot;>
	&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-before($ResultantMTAddressSplit,'ENDOFOUTPUT')&quot;/>
&lt;/xsl:call-template>
&lt;xsl:variable name=&quot;TruncTemp&quot;>
  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>
&lt;/xsl:variable>
                  &lt;ns6:Lines2to5>&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F50F_NameAndAddress_Lines2to5ENDOFFIELDTAG',substring-after($ResultantMTAddressSplit,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Lines2to5>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F50F>
              &lt;ns6:F50K>
                &lt;ns6:Account>&lt;xsl:variable name=&quot;LineSeparator&quot;>
	&lt;xsl:value-of select=&quot;'ENDOFFLINE'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;VariableSeparator&quot;>
	&lt;xsl:value-of select=&quot;'ENDOFFVAR'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;AppendedPostalAddress&quot;>
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine&quot;>
		&lt;xsl:value-of select=&quot;.&quot;/>
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;ResultantMTAddressTable&quot;>
&lt;xsl:choose>

		 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))&quot;>
		 &lt;xsl:value-of select=&quot;'ENDOFOUTPUT'&quot;/>
		&lt;/xsl:when>
		&lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))&quot;>
			&lt;xsl:value-of select=&quot;'ENDOFOUTPUT'&quot;/>
		&lt;/xsl:when>
		
		&lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))&quot;>
			&lt;xsl:value-of select=&quot;'ENDOFOUTPUT'&quot;/>
		&lt;/xsl:when>
		
		&lt;xsl:when test=&quot;((not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC))) and ((string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id)) or (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN))))&quot;>
			&lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                      &lt;/xsl:when>
                    &lt;/xsl:choose>
                    &lt;/xsl:variable>
&lt;xsl:value-of select=&quot;normalize-space(substring-before($ResultantMTAddressTable,'ENDOFOUTPUT'))&quot;/>
&lt;xsl:variable name=&quot;TruncTemp&quot;>
  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>
&lt;/xsl:variable>

&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F50K_Account_ENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Account>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name=&quot;LineSeparator&quot;>
	&lt;xsl:value-of select=&quot;'ENDOFLINE'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;VariableSeparator&quot;>
	&lt;xsl:value-of select=&quot;'ENDOFFVAR'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;AppendedPostalAddress&quot;>
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine&quot;>
		&lt;xsl:value-of select=&quot;.&quot;/>
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;ResultantMTAddressTable&quot;>
&lt;xsl:choose>

		 &lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (('true')=(MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator)))))&quot;>
		 &lt;xsl:value-of select=&quot;'ENDOFOUTPUT'&quot;/>
		&lt;/xsl:when>
		&lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm)) and (not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine))))&quot;>
			&lt;xsl:value-of select=&quot;'ENDOFOUTPUT'&quot;/>
		&lt;/xsl:when>
		
		&lt;xsl:when test=&quot;(not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:Ctry)))&quot;>
			&lt;xsl:value-of select=&quot;'ENDOFOUTPUT'&quot;/>
		&lt;/xsl:when>
		
		&lt;xsl:when test=&quot;((not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC))) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)))&quot;>
			&lt;xsl:value-of select=&quot;MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTPartyNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Nm))&quot;/>
		&lt;/xsl:when>
		
		&lt;xsl:when test=&quot;((not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:Id/ns3:OrgId/ns3:AnyBIC))) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:PstlAdr/ns3:AdrLine)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr)))&quot;>
			&lt;xsl:value-of select=&quot;'NOTPROVIDEDENDOFOUTPUT'&quot;/>
		&lt;/xsl:when>
		&lt;/xsl:choose>
&lt;/xsl:variable>


&lt;xsl:call-template name=&quot;tokenizeLine&quot;>
	&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-before($ResultantMTAddressTable,'ENDOFOUTPUT')&quot;/>
&lt;/xsl:call-template>
 &lt;xsl:variable name=&quot;TruncTemp&quot;>
  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F50K_NameAndAddress_LineENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F50K>
            &lt;/ns6:F50a>
            &lt;ns6:F52a>&lt;xsl:if test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:BICFI)&quot;>
              &lt;ns6:F52A>
                &lt;xsl:variable name=&quot;if7&quot;>
                  &lt;xsl:choose>
                    &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct)&quot;>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId)&quot;>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:BICFI))&quot;>&lt;/xsl:value-of>
                    &lt;/xsl:when>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test=&quot;string-length($if7)&quot;>
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name=&quot;if8&quot;>
                      &lt;xsl:choose>
                        &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct)&quot;>
                          &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId)&quot;>
                          &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:BICFI))&quot;>&lt;/xsl:value-of>
                        &lt;/xsl:when>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select=&quot;$if8&quot;>&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:IdentifierCode>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:BICFI&quot;>&lt;/xsl:value-of>
                &lt;/ns6:IdentifierCode>
              &lt;/ns6:F52A>&lt;/xsl:if>&lt;xsl:if test=&quot;not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:BICFI))&quot;>
              &lt;ns6:F52D>
                &lt;xsl:variable name=&quot;if9&quot;>
                  &lt;xsl:choose>
                    &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId)&quot;>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:BICFI))&quot;>&lt;/xsl:value-of>
                    &lt;/xsl:when>
                    &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct)&quot;>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                    &lt;/xsl:when>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test=&quot;string-length($if9)&quot;>
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name=&quot;if10&quot;>
                      &lt;xsl:choose>
                        &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId)&quot;>
                          &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTClearingIdentifier(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:BICFI))&quot;>&lt;/xsl:value-of>
                        &lt;/xsl:when>
                        &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct)&quot;>
                          &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                        &lt;/xsl:when>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select=&quot;$if10&quot;>&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name=&quot;AppendedPostalAddress&quot;>
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine&quot;>
		&lt;xsl:value-of select=&quot;.&quot;/>
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;if4&quot;>
  &lt;xsl:choose>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:Nm))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndStructuredAddresswithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($LineSeparator))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:Nm)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt/ns3:FinInstnId/ns3:Nm))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:otherwise>
      &lt;xsl:value-of select=&quot;'NOTPROVIDEDENDOFOUTPUT'&quot;>&lt;/xsl:value-of>
    &lt;/xsl:otherwise>
  &lt;/xsl:choose>
&lt;/xsl:variable>
					
&lt;xsl:call-template name=&quot;tokenizeLine&quot;>
	&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-before($if4,'ENDOFOUTPUT')&quot;/>
	&lt;xsl:with-param name=&quot;separator&quot; select=&quot;$LineSeparator&quot;/>
&lt;/xsl:call-template>
&lt;xsl:variable name=&quot;TruncTemp&quot;>
  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F52D_NameAndAddress_LineENDOFFIELDTAG',substring-after($if4,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F52D>&lt;/xsl:if>&lt;/ns6:F52a>
            &lt;ns6:F53a>&lt;xsl:if test=&quot;(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI)))&quot;>
              &lt;ns6:F53D>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name=&quot;LineSeparator&quot;>
	&lt;xsl:value-of select=&quot;'ENDOFLINE'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;AppendedPostalAddress&quot;>
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine&quot;>
		&lt;xsl:value-of select=&quot;.&quot;/>
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;if4&quot;>
&lt;xsl:choose>
&lt;xsl:when test=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmMtd='INGA' or $document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmMtd='INDA'&quot;>
&lt;xsl:value-of select=&quot;'ENDOFOUTPUT'&quot;/>
    &lt;/xsl:when>
	&lt;xsl:otherwise>
  &lt;xsl:choose>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndStructuredAddresswithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($LineSeparator))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:Nm)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstgRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:otherwise>
      &lt;xsl:value-of select=&quot;'NOTPROVIDEDENDOFOUTPUT'&quot;>&lt;/xsl:value-of>
    &lt;/xsl:otherwise>
  &lt;/xsl:choose>
  &lt;/xsl:otherwise>
  &lt;/xsl:choose>
&lt;/xsl:variable>
					
&lt;xsl:call-template name=&quot;tokenizeLine&quot;>
	&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-before($if4,'ENDOFOUTPUT')&quot;/>
	&lt;xsl:with-param name=&quot;separator&quot; select=&quot;$LineSeparator&quot;/>
&lt;/xsl:call-template>
&lt;xsl:variable name=&quot;TruncTemp&quot;>
  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F53D_NameandAddress_Line_ENDOFFIELDTAG',substring-after($if4,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F53D>&lt;/xsl:if>&lt;/ns6:F53a>
            &lt;ns6:F54a>&lt;xsl:if test=&quot;(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI)))&quot;>&#xD;
&lt;xsl:if test=&quot;(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId)) and boolean(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))&amp;lt;('34') and (($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm) = ($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[1]))and not(starts-with($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm,'NOTPROVIDED')))&quot;>
              &lt;ns6:F54B>
                &lt;ns6:PartyIdentifier>&lt;/ns6:PartyIdentifier>&lt;xsl:if test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[2]) and not (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[3]))&quot;>
                &lt;ns6:Location>&lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[2]&quot;>&lt;/xsl:value-of>&lt;/ns6:Location>&lt;/xsl:if>&lt;/ns6:F54B>&lt;/xsl:if>&#xD;
&lt;/xsl:if>&lt;xsl:if test=&quot;(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI)))&quot;>
              &lt;ns6:F54D>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name=&quot;LineSeparator&quot;>
	&lt;xsl:value-of select=&quot;'ENDOFLINE'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;AppendedPostalAddress&quot;>
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine&quot;>
		&lt;xsl:value-of select=&quot;.&quot;/>
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;if4&quot;>
&lt;xsl:choose>
&lt;xsl:when test=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmMtd='INGA' or $document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:SttlmMtd='INDA'&quot;>
&lt;xsl:value-of select=&quot;'ENDOFOUTPUT'&quot;/>
    &lt;/xsl:when>
	&lt;xsl:otherwise>
  &lt;xsl:choose>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndStructuredAddresswithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($LineSeparator))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:InstdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:otherwise>
      &lt;xsl:value-of select=&quot;'NOTPROVIDEDENDOFOUTPUT'&quot;>&lt;/xsl:value-of>
    &lt;/xsl:otherwise>
  &lt;/xsl:choose>
  &lt;/xsl:otherwise>
  &lt;/xsl:choose>
&lt;/xsl:variable>
					
&lt;xsl:call-template name=&quot;tokenizeLine&quot;>
	&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-before($if4,'ENDOFOUTPUT')&quot;/>
	&lt;xsl:with-param name=&quot;separator&quot; select=&quot;$LineSeparator&quot;/>
&lt;/xsl:call-template>
&lt;xsl:variable name=&quot;TruncTemp&quot;>
  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F54D_NameAndAddress_LineENDOFFIELDTAG',substring-after($if4,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F54D>&lt;/xsl:if>&lt;/ns6:F54a>
            &lt;ns6:F55a>&lt;xsl:if test=&quot;(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI)))&quot;>&#xD;
&lt;xsl:if test=&quot;(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:ClrSysMmbId)) and boolean(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm)) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))&amp;lt;('34') and not(starts-with($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm,'NOTPROVIDED')) and &#xD;
(($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm) = ($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[1])))&quot;>
              &lt;ns6:F55B>
                &lt;ns6:PartyIdentifier>&lt;/ns6:PartyIdentifier>
                &lt;ns6:Location>&lt;xsl:choose>&#xD;
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[2]) and not (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[3])) and&#xD;
	string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm) and&#xD;
(($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm) = ($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[1]))&quot;>&#xD;
    &#xD;
&#xD;
&lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[2]&quot;>&lt;/xsl:value-of>&#xD;
    &lt;/xsl:when>&#xD;
	&lt;/xsl:choose>&lt;/ns6:Location>
              &lt;/ns6:F55B>&lt;/xsl:if>&#xD;
&lt;/xsl:if>&lt;xsl:if test=&quot;(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:BICFI)))&quot;>
              &lt;ns6:F55D>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name=&quot;LineSeparator&quot;>
	&lt;xsl:value-of select=&quot;'ENDOFLINE'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;AppendedPostalAddress&quot;>
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine&quot;>
		&lt;xsl:value-of select=&quot;.&quot;/>
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;if4&quot;>
  &lt;xsl:choose>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndStructuredAddresswithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($LineSeparator))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:GrpHdr/ns3:SttlmInf/ns3:ThrdRmbrsmntAgt/ns3:FinInstnId/ns3:Nm))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:otherwise>
      &lt;xsl:value-of select=&quot;'NOTPROVIDEDENDOFOUTPUT'&quot;>&lt;/xsl:value-of>
    &lt;/xsl:otherwise>
  &lt;/xsl:choose>
&lt;/xsl:variable>
					
&lt;xsl:call-template name=&quot;tokenizeLine&quot;>
  &lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-before($if4,'ENDOFOUTPUT')&quot;/>
	&lt;xsl:with-param name=&quot;separator&quot; select=&quot;$LineSeparator&quot;/>
&lt;/xsl:call-template>
&lt;xsl:variable name=&quot;TruncTemp&quot;>
  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F55D_NameandAddress_Line_ENDOFFIELDTAG',substring-after($if4,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F55D>&lt;/xsl:if>&lt;/ns6:F55a>
            &lt;ns6:F56a>&lt;xsl:if test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:BICFI)&quot;>
              &lt;ns6:F56A>
                &lt;xsl:variable name=&quot;if11&quot;>
                  &lt;xsl:choose>
                    &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct)&quot;>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                    &lt;/xsl:when>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test=&quot;string-length($if11)&quot;>
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name=&quot;if12&quot;>
                      &lt;xsl:choose>
                        &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct)&quot;>
                          &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                        &lt;/xsl:when>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select=&quot;$if12&quot;>&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:IdentifierCode>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:BICFI&quot;>&lt;/xsl:value-of>
                &lt;/ns6:IdentifierCode>
              &lt;/ns6:F56A>&lt;/xsl:if>&lt;xsl:if test=&quot;(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:BICFI)))&quot;>&#xD;
&lt;xsl:if test=&quot;not(starts-with($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:ClrChanl,'RTGS'))&quot;>&#xD;
&lt;xsl:if test=&quot;(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:ClrSysMmbId)) and boolean(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm)) and ($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm)=($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm))&amp;lt;('34') and not(starts-with($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm,'NOTPROVIDED')))&quot;>
              &lt;xsl:if test=&quot;string-length(concat('//',$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm))&quot;>
                &lt;ns6:F56C>
                  &lt;xsl:value-of select=&quot;concat('//',$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm)&quot;>&lt;/xsl:value-of>
                &lt;/ns6:F56C>
              &lt;/xsl:if>&lt;/xsl:if>&#xD;
&lt;/xsl:if>&#xD;
&lt;/xsl:if>&lt;xsl:if test=&quot;(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1) and not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:BICFI)))&quot;>
              &lt;ns6:F56D>
                &lt;xsl:variable name=&quot;if13&quot;>
                  &lt;xsl:choose>
                    &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct)&quot;>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                    &lt;/xsl:when>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test=&quot;string-length($if13)&quot;>
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name=&quot;if14&quot;>
                      &lt;xsl:choose>
                        &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct)&quot;>
                          &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                        &lt;/xsl:when>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select=&quot;$if14&quot;>&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name=&quot;AppendedPostalAddress&quot;>
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine&quot;>
		&lt;xsl:value-of select=&quot;.&quot;/>
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;if4&quot;>
  &lt;xsl:choose>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndStructuredAddresswithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($LineSeparator))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1/ns3:FinInstnId/ns3:Nm))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:otherwise>
      &lt;xsl:value-of select=&quot;'NOTPROVIDEDENDOFOUTPUT'&quot;>&lt;/xsl:value-of>
    &lt;/xsl:otherwise>
  &lt;/xsl:choose>
&lt;/xsl:variable>
					
&lt;xsl:call-template name=&quot;tokenizeLine&quot;>
	&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-before($if4,'ENDOFOUTPUT')&quot;/>
	&lt;xsl:with-param name=&quot;separator&quot; select=&quot;$LineSeparator&quot;/>
&lt;/xsl:call-template>
&lt;xsl:variable name=&quot;TruncTemp&quot;>
  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F56D_NameAndAddress_LineENDOFFIELDTAG',substring-after($if4,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F56D>&lt;/xsl:if>&lt;/ns6:F56a>
            &lt;ns6:F57a>&lt;xsl:if test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI)&quot;>
              &lt;ns6:F57A>
                &lt;xsl:variable name=&quot;if15&quot;>
                  &lt;xsl:choose>
                    &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct)&quot;>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                    &lt;/xsl:when>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test=&quot;string-length($if15)&quot;>
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name=&quot;if16&quot;>
                      &lt;xsl:choose>
                        &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct)&quot;>
                          &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                        &lt;/xsl:when>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select=&quot;$if16&quot;>&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:IdentifierCode>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI&quot;>&lt;/xsl:value-of>
                &lt;/ns6:IdentifierCode>
              &lt;/ns6:F57A>&lt;/xsl:if>&lt;xsl:if test=&quot;not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI))&quot;>&#xD;
&lt;xsl:if test=&quot;(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:ClrSysMmbId)) and boolean(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm)) and ($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm)=($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine) and (string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm))&amp;lt;('34') and not(starts-with($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm,'NOTPROVIDED')))&quot;>&#xD;
&lt;xsl:choose>&#xD;
  &lt;xsl:when test=&quot;not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[2]))&quot;>&#xD;
    &lt;ns2:F57C>&#xD;
      &lt;xsl:value-of select=&quot;concat('//',$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm)&quot;>&lt;/xsl:value-of>&#xD;
	&lt;/ns2:F57C>&#xD;
  &lt;/xsl:when>&#xD;
  &lt;xsl:when test=&quot;not(string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[3]))&quot;>
              &lt;ns6:F57B>
                &lt;xsl:if test=&quot;string-length(concat('//',$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm))&quot;>
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:value-of select=&quot;concat('//',$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm)&quot;>&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:Location>&lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine[2]&quot;>&lt;/xsl:value-of>&lt;/ns6:Location>
              &lt;/ns6:F57B>&lt;/xsl:when>&#xD;
&lt;/xsl:choose>&#xD;
&lt;/xsl:if>
              &lt;ns6:F57D>
                &lt;xsl:variable name=&quot;if17&quot;>
                  &lt;xsl:choose>
                    &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct)&quot;>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                    &lt;/xsl:when>
                  &lt;/xsl:choose>
                &lt;/xsl:variable>
                &lt;xsl:if test=&quot;string-length($if17)&quot;>
                  &lt;ns6:PartyIdentifier>
                    &lt;xsl:variable name=&quot;if18&quot;>
                      &lt;xsl:choose>
                        &lt;xsl:when test=&quot;boolean($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct)&quot;>
                          &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountWithPrefix(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;>&lt;/xsl:value-of>
                        &lt;/xsl:when>
                      &lt;/xsl:choose>
                    &lt;/xsl:variable>
                    &lt;xsl:value-of select=&quot;$if18&quot;>&lt;/xsl:value-of>
                  &lt;/ns6:PartyIdentifier>
                &lt;/xsl:if>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name=&quot;AppendedPostalAddress&quot;>
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine&quot;>
		&lt;xsl:value-of select=&quot;.&quot;/>
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>

&lt;xsl:variable name=&quot;if4&quot;>
  &lt;xsl:choose>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:AdrLine)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndStructuredAddresswithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($LineSeparator))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm)&quot;>
      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTFinancialInstitutionNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:Nm))&quot;>&lt;/xsl:value-of>
    &lt;/xsl:when>
    &lt;xsl:otherwise>
      &lt;xsl:value-of select=&quot;'NOTPROVIDEDENDOFOUTPUT'&quot;>&lt;/xsl:value-of>
    &lt;/xsl:otherwise>
  &lt;/xsl:choose>
&lt;/xsl:variable>
					
&lt;xsl:call-template name=&quot;tokenizeLine&quot;>
	&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-before($if4,'ENDOFOUTPUT')&quot;/>
	&lt;xsl:with-param name=&quot;separator&quot; select=&quot;$LineSeparator&quot;/>
&lt;/xsl:call-template>
&lt;xsl:variable name=&quot;TruncTemp&quot;>
  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F57D_NameAndAddress_LineENDOFFIELDTAG',substring-after($if4,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F57D>&lt;/xsl:if>&lt;/ns6:F57a>
            &lt;ns6:F59a>&lt;xsl:variable name=&quot;LineSeparator&quot;>&#xD;
	&lt;xsl:value-of select=&quot;'ENDOFLINE'&quot;/>&#xD;
&lt;/xsl:variable>&#xD;
&lt;xsl:variable name=&quot;VariableSeparator&quot;>&#xD;
	&lt;xsl:value-of select=&quot;'ENDOFVAR'&quot;/>&#xD;
&lt;/xsl:variable>&#xD;
&lt;xsl:variable name=&quot;AppendedPostalAddress&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:AdrLine&quot;>&#xD;
		&lt;xsl:value-of select=&quot;.&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&lt;xsl:variable name=&quot;F59aFlag&quot;>&#xD;
	&lt;xsl:choose>&#xD;
		&lt;xsl:when test=&quot;(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Id/ns3:OrgId/ns3:AnyBIC))))&quot;>&#xD;
			&lt;xsl:value-of select=&quot;'59ABIC'&quot;/>&#xD;
			&lt;xsl:choose>&#xD;
				&lt;xsl:when test=&quot;(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct))))&quot;>&#xD;
					&lt;xsl:value-of select=&quot;'59AAccount'&quot;/>&#xD;
				&lt;/xsl:when>&#xD;
			&lt;/xsl:choose>&#xD;
		&lt;/xsl:when>&#xD;
		&lt;xsl:when test=&quot;(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:Ctry))))&quot;>&#xD;
			&lt;xsl:value-of select=&quot;'59FPartyNameAndAddressLEI1'&quot;/>&#xD;
			&lt;xsl:choose>&#xD;
				&lt;xsl:when test=&quot;(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct))))&quot;>&#xD;
					&lt;xsl:value-of select=&quot;'59FAccount'&quot;/>&#xD;
				&lt;/xsl:when>&#xD;
			&lt;/xsl:choose>&#xD;
		&lt;/xsl:when>&#xD;
		&lt;xsl:when test=&quot;(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:AdrLine))))&quot;>&#xD;
			&lt;xsl:choose>&#xD;
				&lt;xsl:when test=&quot;(('true')=(MXToMT:com.fiorano.funclet.MXtoMT.MX_To_MTAddressLineType(string($AppendedPostalAddress),string($LineSeparator))))&quot;>&#xD;
					&lt;xsl:value-of select=&quot;'59FPartyNameAndAddressLEI2'&quot;/>&#xD;
					&lt;xsl:choose>&#xD;
						&lt;xsl:when test=&quot;(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct))))&quot;>&#xD;
							&lt;xsl:value-of select=&quot;'59FAccount'&quot;/>&#xD;
						&lt;/xsl:when>&#xD;
					&lt;/xsl:choose>&#xD;
				&lt;/xsl:when>&#xD;
				&lt;xsl:otherwise>&#xD;
					&lt;xsl:value-of select=&quot;'59PartyNameAndUnstructuredAddress'&quot;/>&#xD;
					&lt;xsl:choose>&#xD;
						&lt;xsl:when test=&quot;(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct))))&quot;>&#xD;
							&lt;xsl:value-of select=&quot;'59Account'&quot;/>&#xD;
						&lt;/xsl:when>&#xD;
					&lt;/xsl:choose>&#xD;
				&lt;/xsl:otherwise>&#xD;
			&lt;/xsl:choose>&#xD;
		&lt;/xsl:when>&#xD;
		&lt;xsl:when test=&quot;not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Nm)))&quot;>&#xD;
			&lt;xsl:value-of select=&quot;'59PartyNameAndUnstructuredAddress'&quot;/>&#xD;
			&lt;xsl:choose>&#xD;
				&lt;xsl:when test=&quot;(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct))))&quot;>&#xD;
					&lt;xsl:value-of select=&quot;'59Account'&quot;/>&#xD;
				&lt;/xsl:when>&#xD;
			&lt;/xsl:choose>&#xD;
		&lt;/xsl:when>&#xD;
		&lt;xsl:when test=&quot;not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr)))&quot;>&#xD;
			&lt;xsl:value-of select=&quot;'59PartyNameAndNOTPROVIDEDAddress'&quot;/>&#xD;
			&lt;xsl:choose>&#xD;
				&lt;xsl:when test=&quot;(not(MX2MT:com.fiorano.funclet.MXtoMT.isInputNullorBlank(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct))))&quot;>&#xD;
					&lt;xsl:value-of select=&quot;'59Account'&quot;/>&#xD;
				&lt;/xsl:when>&#xD;
			&lt;/xsl:choose>&#xD;
		&lt;/xsl:when>&#xD;
		&lt;xsl:otherwise>&#xD;
			&lt;xsl:value-of select=&quot;'false'&quot;/>&#xD;
		&lt;/xsl:otherwise>&#xD;
	&lt;/xsl:choose>&#xD;
&lt;/xsl:variable>
              &lt;ns6:F59>
                &lt;ns6:Account>&lt;xsl:variable name=&quot;ResultantMTAddressTable&quot;>&#xD;
			&lt;xsl:choose>&#xD;
				&lt;xsl:when test=&quot;contains($F59aFlag,'59Account')&quot;>&#xD;
					&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;/>&#xD;
				&lt;/xsl:when>&#xD;
			&lt;/xsl:choose>&#xD;
		&lt;/xsl:variable>&#xD;
		&lt;xsl:value-of select=&quot;normalize-space(substring-before($ResultantMTAddressTable,'ENDOFOUTPUT'))&quot;/>&#xD;
		&lt;xsl:variable name=&quot;TruncTemp&quot;>&#xD;
			&lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>&#xD;
		&lt;/xsl:variable>&#xD;
		&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F59Account_ENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Account>
                &lt;ns6:NameAndAddress>&lt;xsl:variable name=&quot;ResultantMTAddressTable&quot;>&#xD;
			&lt;xsl:choose>&#xD;
				&lt;xsl:when test=&quot;contains($F59aFlag,'59PartyNameAndUnstructuredAddress')&quot;>&#xD;
					&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTPartyNameAndUnstructuredAddresswithTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Nm))&quot;/>&#xD;
				&lt;/xsl:when>&#xD;
			&lt;/xsl:choose>&#xD;
			&lt;xsl:choose>&#xD;
				&lt;xsl:when test=&quot;contains($F59aFlag,'59PartyNameAndNOTPROVIDEDAddress')&quot;>&#xD;
					&lt;xsl:value-of select=&quot;'NOTPROVIDEDENDOFOUTPUT'&quot;/>&#xD;
				&lt;/xsl:when>&#xD;
			&lt;/xsl:choose>&#xD;
		&lt;/xsl:variable>&#xD;
		&lt;xsl:call-template name=&quot;tokenizeLine&quot;>&#xD;
			&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-before($ResultantMTAddressTable,'ENDOFOUTPUT')&quot;/>&#xD;
		&lt;/xsl:call-template>&#xD;
		&lt;xsl:variable name=&quot;TruncTemp&quot;>&#xD;
			&lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>&#xD;
		&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F59_NameAndAddress_LineENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Line>
                &lt;/ns6:NameAndAddress>
              &lt;/ns6:F59>
              &lt;ns6:F59A>
                &lt;ns6:Account>&lt;xsl:variable name=&quot;ResultantMTAddressTable&quot;>&#xD;
			&lt;xsl:choose>&#xD;
				&lt;xsl:when test=&quot;contains($F59aFlag,'59AAccount')&quot;>&#xD;
					&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;/>&#xD;
				&lt;/xsl:when>&#xD;
			&lt;/xsl:choose>&#xD;
		&lt;/xsl:variable>&#xD;
		&lt;xsl:value-of select=&quot;normalize-space(substring-before($ResultantMTAddressTable,'ENDOFOUTPUT'))&quot;/>&#xD;
		&lt;xsl:variable name=&quot;TruncTemp&quot;>&#xD;
			&lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>&#xD;
		&lt;/xsl:variable>&#xD;
		&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F59A_Account_ENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Account>
                &lt;ns6:IdentifierCode>&lt;xsl:choose>&#xD;
			&lt;xsl:when test=&quot;contains($F59aFlag,'59ABIC')&quot;>&#xD;
				&lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Id/ns3:OrgId/ns3:AnyBIC&quot;/>&#xD;
			&lt;/xsl:when>&#xD;
		&lt;/xsl:choose>&lt;/ns6:IdentifierCode>
              &lt;/ns6:F59A>
              &lt;ns6:F59F>
                &lt;ns6:Account>&lt;xsl:variable name=&quot;ResultantMTAddressTable&quot;>&#xD;
			&lt;xsl:choose>&#xD;
				&lt;xsl:when test=&quot;contains($F59aFlag,'59FAccount')&quot;>&#xD;
					&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.mx2MTAccountwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:IBAN),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct/ns3:Id/ns3:Othr/ns3:SchmeNm/ns3:Cd))&quot;/>&#xD;
				&lt;/xsl:when>&#xD;
			&lt;/xsl:choose>&#xD;
		&lt;/xsl:variable>&#xD;
		&lt;xsl:value-of select=&quot;normalize-space(substring-before($ResultantMTAddressTable,'ENDOFOUTPUT'))&quot;/>&#xD;
		&lt;xsl:variable name=&quot;TruncTemp&quot;>&#xD;
			&lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>&#xD;
		&lt;/xsl:variable>&#xD;
		&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F59F_Account_ENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Account>&lt;xsl:variable name=&quot;ResultantMTAddressTable&quot;>&#xD;
		&lt;xsl:choose>&#xD;
			&lt;xsl:when test=&quot;contains($F59aFlag,'59FPartyNameAndAddressLEI1')&quot;>&#xD;
				&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.SplitAddresstoNumberDetailswithTruncate(string(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTPartyNameAndAddressLEI1withTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Id/ns3:OrgId/ns3:LEI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:Dept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:SubDept),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:StrtNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:BldgNb),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:BldgNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:PstBx),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:Flr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:Room),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:PstCd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:TwnLctnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:DstrctNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:CtrySubDvsn),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:PstlAdr/ns3:Ctry),string($LineSeparator))),string($LineSeparator),string($VariableSeparator))&quot;/>&#xD;
			&lt;/xsl:when>&#xD;
			&lt;xsl:when test=&quot;contains($F59aFlag,'59FPartyNameAndAddressLEI2')&quot;>&#xD;
				&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.SplitAddresstoNumberDetailswithTruncate(string(MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTPartyNameAndAddressLEI2withTruncate(string($AppendedPostalAddress),string($LineSeparator),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:Id/ns3:OrgId/ns3:LEI))),string($LineSeparator),string($VariableSeparator))&quot;/>&#xD;
			&lt;/xsl:when>&#xD;
		&lt;/xsl:choose>&#xD;
	&lt;/xsl:variable>&#xD;
	&lt;xsl:call-template name=&quot;tokenize4&quot;>&#xD;
		&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-before($ResultantMTAddressTable,'ENDOFOUTPUT')&quot;/>&#xD;
	&lt;/xsl:call-template>
                &lt;ns6:NumberNameAndAddressDetails>&lt;xsl:variable name=&quot;TruncTemp&quot;>&#xD;
			&lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>&#xD;
		&lt;/xsl:variable>&#xD;
		&lt;ns2:Number>&#xD;
			&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F59F_NumberNameAndAddressDetailsENDOFFIELDTAG',substring-after($ResultantMTAddressTable,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&#xD;
		&lt;/ns2:Number>&lt;/ns6:NumberNameAndAddressDetails>
              &lt;/ns6:F59F>
            &lt;/ns6:F59a>
            &lt;ns6:F70a>
              &lt;ns6:F70>
                &lt;ns6:Narrative>&lt;xsl:variable name=&quot;F70&quot;>
	&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTRemittanceInformationwithTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RmtInf),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RltdRmtInf),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtCdtr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtDbtr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Purp),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Purp/ns3:Prtry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId/ns3:EndToEndId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RmtInf/ns3:Ustrd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RltdRmtInf/ns3:RmtId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RmtInf/ns3:Strd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtCdtr/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtCdtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtCdtr/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtCdtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtCdtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtDbtr/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtDbtr/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtDbtr/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtDbtr/ns3:Id/ns3:OrgId/ns3:Othr/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtDbtr/ns3:Id/ns3:PrvtId/ns3:Othr/ns3:Id))&quot;>&lt;/xsl:value-of>
&lt;/xsl:variable>

&lt;xsl:call-template name=&quot;tokenizeLine&quot;>
	&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-before($F70,'ENDOFOUTPUT')&quot;/>
	&lt;xsl:with-param name=&quot;separator&quot; select=&quot;$LineSeparator&quot;/>
&lt;/xsl:call-template>
                  &lt;ns6:Line>&lt;xsl:variable name=&quot;TruncTemp&quot;>
	&lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;>&lt;/xsl:value-of>
&lt;/xsl:variable>
&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F70_LineENDOFFIELDTAG',substring-after($F70,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Line>
                &lt;/ns6:Narrative>
              &lt;/ns6:F70>
            &lt;/ns6:F70a>
            &lt;ns6:F71a_1>
              &lt;xsl:variable name=&quot;if19&quot;>
                &lt;xsl:choose>
                  &lt;xsl:when test=&quot;($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('CRED')&quot;>
                    &lt;xsl:value-of select=&quot;'BEN'&quot;>&lt;/xsl:value-of>
                  &lt;/xsl:when>
                  &lt;xsl:when test=&quot;($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('DEBT')&quot;>
                    &lt;xsl:value-of select=&quot;'OUR'&quot;>&lt;/xsl:value-of>
                  &lt;/xsl:when>
                  &lt;xsl:when test=&quot;($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('SHAR')&quot;>
                    &lt;xsl:value-of select=&quot;'SHA'&quot;>&lt;/xsl:value-of>
                  &lt;/xsl:when>
                &lt;/xsl:choose>
              &lt;/xsl:variable>
              &lt;xsl:if test=&quot;string-length($if19)&quot;>
                &lt;ns6:F71A>
                  &lt;xsl:variable name=&quot;if20&quot;>
                    &lt;xsl:choose>
                      &lt;xsl:when test=&quot;($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('CRED')&quot;>
                        &lt;xsl:value-of select=&quot;'BEN'&quot;>&lt;/xsl:value-of>
                      &lt;/xsl:when>
                      &lt;xsl:when test=&quot;($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('DEBT')&quot;>
                        &lt;xsl:value-of select=&quot;'OUR'&quot;>&lt;/xsl:value-of>
                      &lt;/xsl:when>
                      &lt;xsl:when test=&quot;($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('SHAR')&quot;>
                        &lt;xsl:value-of select=&quot;'SHA'&quot;>&lt;/xsl:value-of>
                      &lt;/xsl:when>
                    &lt;/xsl:choose>
                  &lt;/xsl:variable>
                  &lt;xsl:value-of select=&quot;$if20&quot;>&lt;/xsl:value-of>
                &lt;/ns6:F71A>
              &lt;/xsl:if>
            &lt;/ns6:F71a_1>&lt;xsl:variable name=&quot;LineSeparator&quot;>&#xD;
	&lt;xsl:value-of select=&quot;'ENDOFLINE'&quot;/>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;VariableSeparator&quot;>&#xD;
	&lt;xsl:value-of select=&quot;'ENDOFVAR'&quot;/>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;AppendedAmount&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgsInf&quot;>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Amt&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Amt/@Ccy&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;Result&quot;>&#xD;
&lt;xsl:choose>&#xD;
&lt;xsl:when test=&quot;(($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('CRED') or&#xD;
($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('SHAR'))&quot;>&#xD;
&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTAmountTable71F_pac4to103(string($AppendedAmount),string($LineSeparator),string($VariableSeparator))&quot;>&lt;/xsl:value-of>&#xD;
&lt;/xsl:when>&#xD;
&lt;/xsl:choose>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&#xD;
&lt;xsl:call-template name=&quot;tokenize7&quot;>&#xD;
	&lt;xsl:with-param name=&quot;text&quot; select=&quot;$Result&quot;/>&#xD;
&lt;/xsl:call-template>
            &lt;ns6:F71a_2>&lt;!-- User code starts here -->&lt;/ns6:F71a_2>
            &lt;ns6:F71a_3>
              &lt;ns6:F71G>&lt;xsl:if test=&quot;(($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgBr)=('DEBT') and string-length($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgsInf/ns3:Amt))&quot;>&#xD;
&#xD;
&lt;xsl:variable name=&quot;MT71G&quot;>&#xD;
    &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgsInf&quot;>&#xD;
        &lt;xsl:value-of select=&quot;./ns3:Amt/@Ccy&quot;>&lt;/xsl:value-of>&#xD;
	    &lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Amt&quot;>&lt;/xsl:value-of>&#xD;
	    &lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;MT71GAmount&quot;>&#xD;
&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_TR018pacs008(string($MT71G))&quot;>&lt;/xsl:value-of>&#xD;
&lt;/xsl:variable>
                &lt;ns6:Currency>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgsInf/ns3:Amt/@Ccy&quot;>&lt;/xsl:value-of>
                &lt;/ns6:Currency>&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT_Pacs008_71G(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgsInf/ns3:Amt/@Ccy),$MT71GAmount)&quot;>&#xD;
&lt;/xsl:value-of>&#xD;
&#xD;
&lt;/xsl:if>&lt;/ns6:F71G>
            &lt;/ns6:F71a_3>
            &lt;ns6:F72a>
              &lt;ns6:F72>&lt;xsl:variable name=&quot;ServiceLevelPropArr&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl&quot;>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Prtry&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;ServiceLevelCodeArr&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:SvcLvl&quot;>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Cd&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;InstrForCdtrAgtCodeArr&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForCdtrAgt&quot;>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:Cd&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;InstrForCdtrAgtInstructionArr&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForCdtrAgt&quot;>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:InstrInf&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;InstrForNxtAgtInstructionArr&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForNxtAgt&quot;>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:InstrInf&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>
                &lt;ns6:NarrativeStructuredFormat>
                  &lt;ns6:Line1>
                    &lt;ns6:Code>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT72FullField1Line1Code(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($ServiceLevelPropArr),string($ServiceLevelCodeArr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:LclInstrm/ns3:Prtry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:LclInstrm/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Prtry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:BrnchId/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($InstrForCdtrAgtCodeArr),string($InstrForCdtrAgtInstructionArr),string($InstrForNxtAgtInstructionArr),string($LineSeparator),string($VariableSeparator))&quot;>&lt;/xsl:value-of>
                    &lt;/ns6:Code>
                    &lt;ns6:Narrative>&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT72FullField1Line1Narrative(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($ServiceLevelPropArr),string($ServiceLevelCodeArr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:LclInstrm/ns3:Prtry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:LclInstrm/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Prtry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:BrnchId/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($InstrForCdtrAgtCodeArr),string($InstrForCdtrAgtInstructionArr),string($InstrForNxtAgtInstructionArr),string($LineSeparator),string($VariableSeparator))&quot;>&lt;/xsl:value-of>&lt;/ns6:Narrative>
                  &lt;/ns6:Line1>&lt;xsl:variable name=&quot;Result&quot;>
&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MT72FullField1Lines2to6withTruncate(string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:PstlAdr/ns3:TwnNm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:Nm),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:ClrSysId/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3/ns3:FinInstnId/ns3:ClrSysMmbId/ns3:MmbId),string($ServiceLevelPropArr),string($ServiceLevelCodeArr),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:LclInstrm/ns3:Prtry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:LclInstrm/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Prtry),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf/ns3:CtgyPurp/ns3:Cd),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:BrnchId/ns3:Id),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:BICFI),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt/ns3:FinInstnId/ns3:PstlAdr/ns3:Ctry),string($InstrForCdtrAgtCodeArr),string($InstrForCdtrAgtInstructionArr),string($InstrForNxtAgtInstructionArr),string($LineSeparator),string($VariableSeparator))&quot;>&lt;/xsl:value-of>
&lt;/xsl:variable>
&lt;xsl:call-template name=&quot;tokenize6&quot;>
    &lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-before($Result,'ENDOFOUTPUT')&quot;/>
&lt;/xsl:call-template>
 &lt;xsl:variable name=&quot;TruncTemp&quot;>
  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>
&lt;/xsl:variable>
                  &lt;ns6:Lines2to6>&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F72_Lines2to6ENDOFFIELDTAG',substring-after($Result,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Lines2to6>
                &lt;/ns6:NarrativeStructuredFormat>
              &lt;/ns6:F72>
            &lt;/ns6:F72a>
            &lt;ns6:F77a>
              &lt;ns6:F77B>
                &lt;ns6:Narrative>&lt;xsl:variable name=&quot;MXRegulatoryReporting&quot;>
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RgltryRptg&quot;>
		&lt;xsl:for-each select=&quot;./ns3:Dtls&quot;>
			&lt;xsl:for-each select=&quot;./ns3:Inf&quot;>
				&lt;xsl:value-of select=&quot;.&quot;/>
				&lt;xsl:value-of select=&quot;'ENDOFINFO'&quot;/>
			&lt;/xsl:for-each>
			&lt;xsl:value-of select=&quot;'ENDOFDETAIL'&quot;/>
		&lt;/xsl:for-each>
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>
	&lt;/xsl:for-each>
&lt;/xsl:variable>
		
&lt;xsl:variable name=&quot;F77B&quot;>	
	&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTRegulatoryReportingwithTruncate(string($MXRegulatoryReporting),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr/ns3:CtryOfRes),string($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr/ns3:CtryOfRes))&quot;>&lt;/xsl:value-of>
&lt;/xsl:variable>

&lt;xsl:call-template name=&quot;tokenizeLine&quot;>
	&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-before($F77B,'ENDOFOUTPUT')&quot;/>
	&lt;xsl:with-param name=&quot;separator&quot; select=&quot;$LineSeparator&quot;/>
&lt;/xsl:call-template>
&lt;xsl:variable name=&quot;TruncTemp&quot;>
  &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields')&quot;/>
&lt;/xsl:variable>
                  &lt;ns6:Line>&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Truncated_Fields', concat($TruncTemp,'F77B_Narrative_LineENDOFFIELDTAG',substring-after($F77B,'ENDOFOUTPUT'),'ENDOFTRUNCATEDFIELD'))&quot;/>&lt;/ns6:Line>
                &lt;/ns6:Narrative>
              &lt;/ns6:F77B>
            &lt;/ns6:F77a>
          &lt;/ns6:MT103>
        &lt;/ns6:Document>
      &lt;/ns5:Block4>
      &lt;ns5:Block5>
        &lt;ns5:PAC>&lt;xsl:if test=&quot;java:_getBooleanProperty($_TIF_MESSAGE_, 'isIncludeAdditionalDetails')&quot;>
&lt;xsl:variable name=&quot;settedString&quot;>
&lt;xsl:value-of select=&quot;''&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString1&quot;>
&lt;xsl:value-of select=&quot;'//InstrId//EndToEndId//UETR//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString2&quot;>
&lt;xsl:value-of select=&quot;'//ClrChanl//Cd//LclInstrm//CtgyPurp//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString3&quot;>
&lt;xsl:value-of select=&quot;'//Amt//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString4&quot;>
&lt;xsl:value-of select=&quot;'//AnyBIC//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString5&quot;>
&lt;xsl:value-of select=&quot;'//Prtry//LEI//PstlAdr//Othr//BrnchId//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString6&quot;>
&lt;xsl:value-of select=&quot;'//Prtry//LEI//PstlAdr//Othr//BrnchId//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString7&quot;>
&lt;xsl:value-of select=&quot;'//BICFI//ClrSysMmbId//MmbId//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString8&quot;>
&lt;xsl:value-of select=&quot;'//IBAN//Id//Cd//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString9&quot;>
&lt;xsl:value-of select=&quot;'//BICFI//ClrSysMmbId//MmbId//Nm//TwnNm//Ctry//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString10&quot;>
&lt;xsl:value-of select=&quot;'//Tp//Ccy//Nm//Prxy//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString11&quot;>
&lt;xsl:value-of select=&quot;'//LEI//AdrTp//Othr//BrnchId//Prtry//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString12&quot;>
&lt;xsl:value-of select=&quot;'//InstrInf//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString13&quot;>
&lt;xsl:value-of select=&quot;'//Inf//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString14&quot;>
&lt;xsl:value-of select=&quot;'//RmtId//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString15&quot;>
&lt;xsl:value-of select=&quot;'//BICFI//ClrSysMmbId//MmbId//Nm//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString16&quot;>
&lt;xsl:value-of select=&quot;'//BICFI//ClrSysMmbId//MmbId//Nm//Dept//SubDept//StrtNm//BldgNb//BldgNm//Flr//PstBx//Room//PstCd//TwnNm//TwnLctnNm//DstrctNm//CtrySubDvsn//Ctry//AdrLine//Id//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString17&quot;>
&lt;xsl:value-of select=&quot;'//Nm//Dept//SubDept//StrtNm//BldgNb//BldgNm//Flr//PstBx//Room//PstCd//TwnNm//TwnLctnNm//DstrctNm//CtrySubDvsn//Ctry//AdrLine//AnyBIC//LEI//CtryOfRes//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString18&quot;>
&lt;xsl:value-of select=&quot;'//Nm//TwnNm//Ctry//Id//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString19&quot;>
&lt;xsl:value-of select=&quot;'//Ustrd//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;settedString20&quot;>
&lt;xsl:value-of select=&quot;'//PmtId//PmtTpInf//IntrBkSttlmAmt//IntrBkSttlmDt//SttlmTmIndctn//SttlmTmReq//InstdAmt//XchgRate//ChrgBr//ChrgsInf//PrvsInstgAgt1//PrvsInstgAgt2//PrvsInstgAgt3//IntrmyAgt1//IntrmyAgt1Acct//IntrmyAgt2//IntrmyAgt3//Dbtr//DbtrAgt//DbtrAgtAcct//Cdtr//CdtrAgt//CdtrAgtAcct//'&quot;/>
&lt;/xsl:variable>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;> 
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString20&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;> 
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString1&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtTpInf&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString2&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:ChrgsInf&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString3&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString15&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt1Acct&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString15&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt2Acct&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString15&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PrvsInstgAgt3Acct&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstgAgt&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstdAgt&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString15&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt1Acct&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString8&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString9&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt2Acct&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString9&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:IntrmyAgt3Acct&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InitgPty&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Dbtr&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString4&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAcct&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgt&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString7&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:DbtrAgtAcct&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString8&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgt&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString16&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAgtAcct&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString8&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:Cdtr&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString17&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:CdtrAcct&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString8&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:UltmtCdtr&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString18&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:InstrForNxtAgt&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString12&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RgltryRptg&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString13&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RltdRmtInf&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString14&quot; />
&lt;/xsl:call-template>
&lt;xsl:call-template name=&quot;dynamicAdditionalData&quot;>
&lt;xsl:with-param name=&quot;roottag&quot; select = &quot;$document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:RmtInf&quot; />
&lt;xsl:with-param name = &quot;splitups&quot; select = &quot;$settedString19&quot; />
&lt;/xsl:call-template>
&lt;/xsl:if>&lt;/ns5:PAC>
        &lt;ns5:SYS>
          &lt;ns5:MIR>
            &lt;ns5:LTIdentifier>&lt;xsl:variable name=&quot;TruncatedWithLimitter&quot;>
&lt;xsl:value-of select=&quot;(concat(java:_getStringProperty($_TIF_MESSAGE_, 'Truncated_Fields'),'ENDOFTRUNK'))&quot;>&lt;/xsl:value-of>
&lt;/xsl:variable>
&lt;xsl:variable name=&quot;Truncated_Additional&quot;>
&lt;xsl:value-of select=&quot;(concat($TruncatedWithLimitter,java:_getStringProperty($_TIF_MESSAGE_, 'Additional_Fields')))&quot;>&lt;/xsl:value-of>
&lt;/xsl:variable>
&lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'File_Truncated', java:com.fiorano.xslt.functions.base64.Base64.getEncodedString(MXToMT:com.fiorano.funclet.MXtoMT.generateReadableData(string(concat($document_IN_PORT/ns1:Envelope/ns3:Document/ns3:FIToFICstmrCdtTrf/ns3:CdtTrfTxInf/ns3:PmtId/ns3:UETR,'ENDOFUETR',$Truncated_Additional)))))&quot;>&lt;/xsl:value-of>&lt;/ns5:LTIdentifier>
          &lt;/ns5:MIR>
        &lt;/ns5:SYS>
        &lt;ns5:MRF>
          &lt;ns5:MIR>
            &lt;ns5:ISN>
              &lt;xsl:variable name=&quot;if21&quot;>
                &lt;xsl:choose>
                  &lt;xsl:when test=&quot;QueryGenerator:isBlank(string(''))&quot;>
                    &lt;xsl:value-of select=&quot;''&quot;>&lt;/xsl:value-of>
                  &lt;/xsl:when>
                  &lt;xsl:otherwise>
                    &lt;xsl:value-of select=&quot;''&quot;>&lt;/xsl:value-of>
                  &lt;/xsl:otherwise>
                &lt;/xsl:choose>
              &lt;/xsl:variable>
              &lt;xsl:value-of select=&quot;$if21&quot;>&lt;/xsl:value-of>
            &lt;/ns5:ISN>
          &lt;/ns5:MIR>
        &lt;/ns5:MRF>
      &lt;/ns5:Block5>
    &lt;/ns5:FinMessage>
  &lt;/xsl:template>&lt;xsl:template name=&quot;tokenizeLine&quot;>&#xD;
 &lt;xsl:param name=&quot;text&quot; select=&quot;.&quot;/>&#xD;
 &lt;xsl:param name=&quot;separator&quot; select=&quot;'ENDOFLINE'&quot;/>&#xD;
        &lt;xsl:choose>&#xD;
            &lt;xsl:when test=&quot;not(contains($text, $separator))&quot;>&#xD;
                &lt;ns6:Line>&#xD;
                    &lt;xsl:value-of select=&quot;normalize-space($text)&quot;/>&#xD;
                &lt;/ns6:Line>&#xD;
            &lt;/xsl:when>&#xD;
            &lt;xsl:otherwise>&#xD;
               &lt;ns6:Line>&#xD;
                    &lt;xsl:value-of select=&quot;normalize-space(substring-before($text, $separator))&quot;/>&#xD;
               &lt;/ns6:Line>&#xD;
                &lt;xsl:call-template name=&quot;tokenizeLine&quot;>&#xD;
                    &lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-after($text, $separator)&quot;/>&#xD;
                &lt;/xsl:call-template>&#xD;
            &lt;/xsl:otherwise>&#xD;
        &lt;/xsl:choose>&#xD;
&lt;/xsl:template>&#xD;
&lt;xsl:template name=&quot;tokenizeF13C&quot;>&#xD;
 &lt;xsl:param name=&quot;text&quot; select=&quot;.&quot;/>&#xD;
 &lt;xsl:param name=&quot;separator&quot; select=&quot;'ENDOFLINE'&quot;/>&#xD;
        &lt;xsl:choose>&#xD;
            &lt;xsl:when test=&quot;not(contains($text, $separator))&quot;>&#xD;
			  &lt;xsl:if test=&quot;string-length($text)&quot;>  &#xD;
                &lt;xsl:call-template name=&quot;MXDateTimeOffsetF13C&quot;>&#xD;
					&lt;xsl:with-param name=&quot;text&quot; select=&quot;normalize-space($text)&quot;/>&#xD;
				&lt;/xsl:call-template>&#xD;
			  &lt;/xsl:if>&#xD;
            &lt;/xsl:when>&#xD;
            &lt;xsl:otherwise>&#xD;
                &lt;xsl:call-template name=&quot;MXDateTimeOffsetF13C&quot;>&#xD;
					&lt;xsl:with-param name=&quot;text&quot; select=&quot;normalize-space(substring-before($text, $separator))&quot;/>&#xD;
				&lt;/xsl:call-template>&#xD;
                &lt;xsl:call-template name=&quot;tokenizeF13C&quot;>&#xD;
                    &lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-after($text, $separator)&quot;/>&#xD;
                &lt;/xsl:call-template>&#xD;
            &lt;/xsl:otherwise>&#xD;
        &lt;/xsl:choose>&#xD;
&lt;/xsl:template>&#xD;
&#xD;
&#xD;
&#xD;
&lt;xsl:template name=&quot;MXDateTimeOffsetF13C&quot;>&#xD;
  &lt;xsl:param name=&quot;text&quot; select=&quot;.&quot;/>&#xD;
  &lt;ns6:F13a>&#xD;
      &lt;ns6:F13C>&#xD;
        &lt;ns6:Code>&#xD;
		  &lt;xsl:value-of select=&quot;substring($text,1,7)&quot;>&lt;/xsl:value-of>&#xD;
        &lt;/ns6:Code>&#xD;
		  &lt;xsl:choose>&#xD;
            &lt;xsl:when test=&quot;starts-with($text,'SNDTIME') or starts-with($text,'RNCTIME')&quot;>&#xD;
			  &lt;ns6:TimeIndication>&#xD;
				&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTDateTimeOffset_Time(string(substring($text,8)))&quot;>&lt;/xsl:value-of>&#xD;
			  &lt;/ns6:TimeIndication>&#xD;
			  &lt;ns6:Sign>&#xD;
				&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTDateTimeOffset_Sign(string(substring($text,8)))&quot;>&lt;/xsl:value-of>&#xD;
			  &lt;/ns6:Sign>&#xD;
			  &lt;ns6:TimeOffset>&#xD;
				&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTDateTimeOffset_Offset(string(substring($text,8)))&quot;>&lt;/xsl:value-of>&#xD;
			  &lt;/ns6:TimeOffset>&#xD;
			&lt;/xsl:when>  &#xD;
			&lt;xsl:otherwise>&#xD;
			  &lt;ns6:TimeIndication>&#xD;
				&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTTime_Time(string(substring($text,8)))&quot;>&lt;/xsl:value-of>&#xD;
			  &lt;/ns6:TimeIndication>&#xD;
			  &lt;ns6:Sign>&#xD;
				&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTTime_Sign(string(substring($text,8)))&quot;>&lt;/xsl:value-of>&#xD;
			  &lt;/ns6:Sign>&#xD;
			  &lt;ns6:TimeOffset>&#xD;
				&lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTTime_Offset(string(substring($text,8)))&quot;>&lt;/xsl:value-of>&#xD;
			  &lt;/ns6:TimeOffset>&#xD;
			&lt;/xsl:otherwise>&#xD;
		  &lt;/xsl:choose>&#xD;
	  &lt;/ns6:F13C>&#xD;
  &lt;/ns6:F13a>&#xD;
&lt;/xsl:template>&#xD;
&#xD;
&lt;xsl:template name=&quot;tokenize3&quot;>&#xD;
	&lt;xsl:param name=&quot;text&quot; select=&quot;.&quot;/>&#xD;
	&lt;xsl:param name=&quot;LineSeparator&quot; select=&quot;'ENDOFLINE'&quot;/>&#xD;
	&lt;xsl:param name=&quot;VarSeparator&quot; select=&quot;'ENDOFVAR'&quot;/>&#xD;
	&lt;xsl:choose>&#xD;
		&lt;xsl:when test=&quot;not(string-length($text))&quot;>&#xD;
		&lt;/xsl:when>&#xD;
		&lt;xsl:when test=&quot;not(contains($text, $LineSeparator))&quot;>&#xD;
			&lt;ns6:Lines2to5>&#xD;
				&lt;ns6:Number>&#xD;
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($text, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:Number>&#xD;
&#xD;
				&lt;xsl:variable name=&quot;Cdval&quot;>&#xD;
					&lt;xsl:value-of select=&quot;substring-after($text, $VarSeparator)&quot;/>&#xD;
				&lt;/xsl:variable>&#xD;
&#xD;
				&lt;ns6:Details>&#xD;
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($Cdval, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:Details>&#xD;
&#xD;
			&lt;/ns6:Lines2to5>&#xD;
		&lt;/xsl:when>&#xD;
		&lt;xsl:when test=&quot;((contains($text, $LineSeparator))) &quot;>&#xD;
&#xD;
			&lt;ns6:Lines2to5>&#xD;
				&lt;ns6:Number>&#xD;
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($text, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:Number>&#xD;
&#xD;
				&lt;xsl:variable name=&quot;Cdval1&quot;>&#xD;
					&lt;xsl:value-of select=&quot;substring-after($text, $VarSeparator)&quot;/>&#xD;
				&lt;/xsl:variable>&#xD;
&#xD;
				&lt;ns6:Details>&#xD;
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($Cdval1, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:Details>&#xD;
&#xD;
			&lt;/ns6:Lines2to5>&#xD;
			&lt;xsl:call-template name=&quot;tokenize3&quot;>&#xD;
				&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-after($text, $LineSeparator)&quot;/>&#xD;
			&lt;/xsl:call-template>&#xD;
		&lt;/xsl:when>&#xD;
	&lt;/xsl:choose>&#xD;
&lt;/xsl:template>&#xD;
&#xD;
&lt;xsl:template name=&quot;tokenizeF23E&quot;>&#xD;
	&lt;xsl:param name=&quot;text&quot; select=&quot;.&quot;/>&#xD;
	&lt;xsl:param name=&quot;LineSeparator&quot; select=&quot;'ENDOFLINE'&quot;/>&#xD;
	&lt;xsl:param name=&quot;VarSeparator&quot; select=&quot;'ENDOFVAR'&quot;/>&#xD;
	&lt;xsl:choose>&#xD;
		&lt;xsl:when test=&quot;not(string-length($text))&quot;>&#xD;
		&lt;/xsl:when>&#xD;
		&lt;xsl:when test=&quot;not(contains($text, $LineSeparator))&quot;>&#xD;
			&lt;ns6:F23a_2>&#xD;
			&lt;ns6:F23E>&#xD;
				&lt;ns6:InstructionCode>&#xD;
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($text, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:InstructionCode>&#xD;
&#xD;
				&lt;xsl:variable name=&quot;Cdval&quot;>&#xD;
					&lt;xsl:value-of select=&quot;substring-after($text, $VarSeparator)&quot;/>&#xD;
				&lt;/xsl:variable>&#xD;
&#xD;
				&lt;ns6:AdditionalInformation>&#xD;
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($Cdval, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:AdditionalInformation>&#xD;
&#xD;
			&lt;/ns6:F23E>&#xD;
			&lt;/ns6:F23a_2>&#xD;
		&lt;/xsl:when>&#xD;
		&lt;xsl:when test=&quot;((contains($text, $LineSeparator))) &quot;>&#xD;
&#xD;
			&lt;ns6:F23a_2>&#xD;
			&lt;ns6:F23E>&#xD;
				&lt;ns6:InstructionCode>&#xD;
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($text, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:InstructionCode>&#xD;
&#xD;
				&lt;xsl:variable name=&quot;Cdval1&quot;>&#xD;
					&lt;xsl:value-of select=&quot;substring-after($text, $VarSeparator)&quot;/>&#xD;
				&lt;/xsl:variable>&#xD;
&#xD;
				&lt;ns6:AdditionalInformation>&#xD;
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($Cdval1, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:AdditionalInformation>&#xD;
&#xD;
			&lt;/ns6:F23E>&#xD;
			&lt;/ns6:F23a_2>&#xD;
			&lt;xsl:call-template name=&quot;tokenizeF23E&quot;>&#xD;
				&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-after($text, $LineSeparator)&quot;/>&#xD;
			&lt;/xsl:call-template>&#xD;
		&lt;/xsl:when>&#xD;
	&lt;/xsl:choose>&#xD;
&lt;/xsl:template>&#xD;
&#xD;
&lt;xsl:template name=&quot;tokenize4&quot;>&#xD;
	&lt;xsl:param name=&quot;text&quot; select=&quot;.&quot;/>&#xD;
	&lt;xsl:param name=&quot;LineSeparator&quot; select=&quot;'ENDOFLINE'&quot;/>&#xD;
	&lt;xsl:param name=&quot;VarSeparator&quot; select=&quot;'ENDOFVAR'&quot;/>&#xD;
	&lt;xsl:choose>&#xD;
		&lt;xsl:when test=&quot;not(string-length($text))&quot;>&#xD;
		&lt;/xsl:when>&#xD;
		&lt;xsl:when test=&quot;not(contains($text, $LineSeparator))&quot;>&#xD;
			&lt;ns6:NumberNameAndAddressDetails>&#xD;
				&lt;ns6:Number>&#xD;
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($text, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:Number>&#xD;
&#xD;
				&lt;xsl:variable name=&quot;Cdval&quot;>&#xD;
					&lt;xsl:value-of select=&quot;substring-after($text, $VarSeparator)&quot;/>&#xD;
				&lt;/xsl:variable>&#xD;
&#xD;
				&lt;ns6:Details>&#xD;
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($Cdval, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:Details>&#xD;
&#xD;
			&lt;/ns6:NumberNameAndAddressDetails>&#xD;
		&lt;/xsl:when>&#xD;
		&lt;xsl:when test=&quot;((contains($text, $LineSeparator))) &quot;>&#xD;
&#xD;
			&lt;ns6:NumberNameAndAddressDetails>&#xD;
				&lt;ns6:Number>&#xD;
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($text, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:Number>&#xD;
&#xD;
				&lt;xsl:variable name=&quot;Cdval1&quot;>&#xD;
					&lt;xsl:value-of select=&quot;substring-after($text, $VarSeparator)&quot;/>&#xD;
				&lt;/xsl:variable>&#xD;
&#xD;
				&lt;ns6:Details>&#xD;
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($Cdval1, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:Details>&#xD;
&#xD;
			&lt;/ns6:NumberNameAndAddressDetails>&#xD;
			&lt;xsl:call-template name=&quot;tokenize4&quot;>&#xD;
				&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-after($text, $LineSeparator)&quot;/>&#xD;
			&lt;/xsl:call-template>&#xD;
		&lt;/xsl:when>&#xD;
	&lt;/xsl:choose>&#xD;
&lt;/xsl:template>&#xD;
&#xD;
&lt;xsl:template name=&quot;tokenize6&quot;>&#xD;
 &lt;xsl:param name=&quot;text&quot; select=&quot;.&quot;/>&#xD;
 &lt;xsl:param name=&quot;LineSeparator&quot; select=&quot;'ENDOFLINE'&quot;/>&#xD;
 &lt;xsl:param name=&quot;VarSeparator&quot; select=&quot;'ENDOFVAR'&quot;/>&#xD;
        &lt;xsl:choose>&#xD;
        &lt;xsl:when test=&quot;not(string-length($text))&quot;>&#xD;
        &lt;/xsl:when>&#xD;
            &lt;xsl:when test=&quot;not(contains($text, $LineSeparator))&quot;>&#xD;
            &lt;ns6:Lines2to6>&#xD;
                &lt;ns6:Narrative1>&#xD;
                &lt;xsl:value-of select=&quot;substring-before($text, $VarSeparator)&quot;/>&#xD;
                &lt;/ns6:Narrative1>&#xD;
&#xD;
                &lt;xsl:variable name=&quot;Cdval22&quot;>&#xD;
                &lt;xsl:value-of select=&quot;substring-after($text, $VarSeparator)&quot;/>&#xD;
                &lt;/xsl:variable>&#xD;
&#xD;
                &lt;ns6:Code>&#xD;
                &lt;xsl:value-of select=&quot;substring-before($Cdval22, $VarSeparator)&quot;/>&#xD;
                &lt;/ns6:Code>&#xD;
&#xD;
                &lt;xsl:variable name=&quot;Cdval&quot;>&#xD;
                &lt;xsl:value-of select=&quot;substring-after($Cdval22, $VarSeparator)&quot;/>&#xD;
                &lt;/xsl:variable>&#xD;
&#xD;
                &lt;ns6:Narrative2>&#xD;
                &lt;xsl:value-of select=&quot;substring-before($Cdval, $VarSeparator)&quot;/>&#xD;
                &lt;/ns6:Narrative2>&#xD;
&#xD;
                &lt;/ns6:Lines2to6>&#xD;
            &lt;/xsl:when>&#xD;
           &lt;xsl:when test=&quot;((contains($text, $LineSeparator))) &quot;>&#xD;
&#xD;
              &lt;ns6:Lines2to6>&#xD;
                &lt;ns6:Narrative1>&#xD;
                &lt;xsl:value-of select=&quot;substring-before($text, $VarSeparator)&quot;/>&#xD;
                &lt;/ns6:Narrative1>&#xD;
&#xD;
                &lt;xsl:variable name=&quot;Cdval111&quot;>&#xD;
                &lt;xsl:value-of select=&quot;substring-after($text, $VarSeparator)&quot;/>&#xD;
                &lt;/xsl:variable>&#xD;
&#xD;
                &lt;ns6:Code>&#xD;
                &lt;xsl:value-of select=&quot;substring-before($Cdval111, $VarSeparator)&quot;/>&#xD;
                &lt;/ns6:Code>&#xD;
&#xD;
                &lt;xsl:variable name=&quot;Cdval1&quot;>&#xD;
                &lt;xsl:value-of select=&quot;substring-after($Cdval111, $VarSeparator)&quot;/>&#xD;
                &lt;/xsl:variable>&#xD;
&#xD;
                &lt;ns6:Narrative2>&#xD;
                &lt;xsl:value-of select=&quot;substring-before($Cdval1, $VarSeparator)&quot;/>&#xD;
                &lt;/ns6:Narrative2>&#xD;
&#xD;
                &lt;/ns6:Lines2to6>&#xD;
                &lt;xsl:call-template name=&quot;tokenize6&quot;>&#xD;
                    &lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-after($text, $LineSeparator)&quot;/>&#xD;
                &lt;/xsl:call-template>&#xD;
            &lt;/xsl:when>&#xD;
        &lt;/xsl:choose>&#xD;
&lt;/xsl:template>&#xD;
&#xD;
 &lt;xsl:template name=&quot;tokenize7&quot;>&#xD;
 &lt;xsl:param name=&quot;text&quot; select=&quot;.&quot;/>&#xD;
 &lt;xsl:param name=&quot;LineSeparator&quot; select=&quot;'ENDOFLINE'&quot;/>&#xD;
 &lt;xsl:param name=&quot;VarSeparator&quot; select=&quot;'ENDOFVAR'&quot;/>&#xD;
        &lt;xsl:choose>&#xD;
		&lt;xsl:when test=&quot;not(string-length($text))&quot;>&#xD;
		&lt;/xsl:when>&#xD;
            &lt;xsl:when test=&quot;not(contains($text, $LineSeparator))&quot;>&#xD;
			&lt;ns6:F71a_2>&#xD;
			&lt;ns6:F71F>&#xD;
				&lt;ns6:Currency>&#xD;
				&lt;xsl:value-of select=&quot;normalize-space(substring-before($text, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:Currency>&#xD;
				&#xD;
				&lt;xsl:variable name=&quot;Cdval&quot;>&#xD;
				&lt;xsl:value-of select=&quot;substring-after($text, $VarSeparator)&quot;/>&#xD;
				&lt;/xsl:variable>&#xD;
				&#xD;
				&lt;ns6:Amount>&#xD;
				&lt;xsl:value-of select=&quot;normalize-space(substring-before($Cdval, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:Amount>&#xD;
&#xD;
                &lt;/ns6:F71F>&#xD;
				&lt;/ns6:F71a_2>&#xD;
            &lt;/xsl:when>&#xD;
           &lt;xsl:when test=&quot;((contains($text, $LineSeparator))) &quot;>&#xD;
              &lt;ns6:F71a_2>&#xD;
			  &lt;ns6:F71F>&#xD;
				&lt;ns6:Currency>&#xD;
				&lt;xsl:value-of select=&quot;normalize-space(substring-before($text, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:Currency>&#xD;
				&#xD;
				&lt;xsl:variable name=&quot;Cdval1&quot;>&#xD;
				&lt;xsl:value-of select=&quot;substring-after($text, $VarSeparator)&quot;/>&#xD;
				&lt;/xsl:variable>&#xD;
				&#xD;
				&lt;ns6:Amount>&#xD;
				&lt;xsl:value-of select=&quot;normalize-space(substring-before($Cdval1, $VarSeparator))&quot;/>&#xD;
				&lt;/ns6:Amount>&#xD;
&#xD;
				&lt;/ns6:F71F>&#xD;
				&lt;/ns6:F71a_2>&#xD;
                &lt;xsl:call-template name=&quot;tokenize7&quot;>&#xD;
                    &lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-after($text, $LineSeparator)&quot;/>&#xD;
                &lt;/xsl:call-template>&#xD;
            &lt;/xsl:when>&#xD;
        &lt;/xsl:choose>&#xD;
&lt;/xsl:template>&#xD;
&#xD;
&#xD;
&lt;!--The list of Extensions defined by user-->&#xD;
&lt;xsl:template name=&quot;myFunction&quot;>&#xD;
  &lt;xsl:param name = &quot;splitups&quot;/>&#xD;
  &lt;xsl:for-each select=&quot;*&quot;>&#xD;
  &lt;xsl:variable name=&quot;tag&quot;>&#xD;
  &lt;xsl:value-of select=&quot;local-name()&quot;>&lt;/xsl:value-of>&#xD;
  &lt;/xsl:variable>&#xD;
&lt;xsl:variable name = &quot;checker1&quot; >&#xD;
&lt;xsl:value-of select =&quot;substring-after($splitups,$tag)&quot;/>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name = &quot;checker2&quot;>&#xD;
 &lt;xsl:value-of select =&quot;string(substring-before($splitups,$tag))&quot;/>&#xD;
  &#xD;
  &lt;/xsl:variable> &#xD;
  &lt;xsl:choose>&#xD;
&lt;xsl:when test=&quot;starts-with(substring-after($splitups,$tag),'/') and  MX2MT:com.fiorano.funclet.MXtoMT.endsWith(substring-before($splitups,$tag),'/')='true' &quot;>&#xD;
    &lt;/xsl:when>&#xD;
    &lt;xsl:otherwise>&#xD;
&lt;xsl:value-of select=&quot;'&amp;#xd;&amp;#xa;'&quot;/>&#xD;
      &lt;xsl:variable name=&quot;tagFullForm&quot;>&#xD;
  &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.fullFormGenerator(local-name())&quot;>&lt;/xsl:value-of>&#xD;
&lt;/xsl:variable>&lt;xsl:if test=&quot;count(child::*)>0&quot;>-----------------Start of &lt;xsl:value-of select=&quot;$tagFullForm&quot;/> Details-----------------&lt;/xsl:if>&lt;xsl:if test=&quot;count(child::*)=0&quot;>&lt;xsl:value-of select=&quot;'&amp;#xd;&amp;#xa;'&quot;/>&lt;xsl:value-of select=&quot;$tagFullForm&quot;/>:&lt;/xsl:if>&lt;xsl:call-template name=&quot;myFunction&quot; >&lt;xsl:with-param name = &quot;splitups&quot; select=&quot;$splitups&quot;/>&lt;/xsl:call-template>&lt;xsl:if test = &quot;count(child::*)=0&quot;>&lt;xsl:value-of select=&quot;.&quot;/>&#xD;
&lt;/xsl:if>&#xD;
&lt;xsl:if test=&quot;count(child::*)>0&quot;>&lt;xsl:value-of select=&quot;'&amp;#xd;&amp;#xa;'&quot;/>-----------------End of &lt;xsl:value-of select=&quot;$tagFullForm&quot;/> Details-----------------&lt;xsl:value-of select=&quot;'&amp;#xd;&amp;#xa;'&quot;/>&lt;/xsl:if>&#xD;
    &lt;/xsl:otherwise>                &#xD;
&lt;/xsl:choose> &#xD;
&lt;/xsl:for-each>&#xD;
  &lt;/xsl:template>&#xD;
   &lt;xsl:template name=&quot;dynamicAdditionalData&quot;>&#xD;
  &lt;xsl:param name=&quot;roottag&quot;/>&#xD;
  &lt;xsl:param name=&quot;splitups&quot;/>&#xD;
  &lt;xsl:variable name=&quot;AdditionalData&quot;>&#xD;
    &lt;xsl:for-each select=&quot;$roottag&quot;>&#xD;
      &lt;xsl:variable name=&quot;tagFullForm&quot;>&#xD;
        &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.fullFormGenerator(local-name())&quot;>&lt;/xsl:value-of>&#xD;
      &lt;/xsl:variable>&#xD;
-----------------Start of &lt;xsl:value-of select=&quot;$tagFullForm&quot;/> Details-----------------&lt;xsl:call-template name=&quot;myFunction&quot;>&#xD;
        &lt;xsl:with-param name=&quot;splitups&quot; select=&quot;$splitups&quot;/>&#xD;
      &lt;/xsl:call-template>&#xD;
-----------------End of &lt;xsl:value-of select=&quot;$tagFullForm&quot;/> Details-----------------&lt;/xsl:for-each>&#xD;
&lt;xsl:value-of select=&quot;'&amp;#xd;&amp;#xa;'&quot;/>&#xD;
&lt;xsl:value-of select=&quot;'&amp;#xd;&amp;#xa;'&quot;/>&#xD;
&#xD;
  &lt;/xsl:variable>&#xD;
  &lt;xsl:variable name=&quot;settedString&quot;>&#xD;
        &lt;xsl:value-of select=&quot;java:_getStringProperty($_TIF_MESSAGE_, 'Additional_Fields')&quot;/>&#xD;
      &lt;/xsl:variable>&#xD;
  &lt;xsl:variable name=&quot;AdditionalDataWithLimitter&quot;>&#xD;
    &lt;xsl:choose>&#xD;
      &lt;xsl:when test=&quot;$settedString !=null or not(normalize-space($settedString)='')&quot;>&#xD;
        &lt;xsl:value-of select=&quot;(concat($settedString,$AdditionalData))&quot;/>&#xD;
      &lt;/xsl:when>&#xD;
      &lt;xsl:otherwise>&#xD;
        &lt;xsl:value-of select=&quot;$AdditionalData&quot;/>&#xD;
      &lt;/xsl:otherwise>&#xD;
    &lt;/xsl:choose>&#xD;
  &lt;/xsl:variable>&#xD;
  &lt;xsl:value-of select=&quot;java:_setStringProperty($_TIF_MESSAGE_, 'Additional_Fields',$AdditionalDataWithLimitter)&quot;/>&#xD;
&lt;/xsl:template>&#xD;
&lt;!--The list of parameters defined by user-->&#xD;
  &lt;xsl:param name=&quot;_TIF_MESSAGE_&quot;>&lt;/xsl:param>&#xD;
&lt;!--The list of Extensions defined by user-->
&lt;!--The list of parameters defined by user-->
  &lt;xsl:param name=&quot;_TIF_MESSAGE_&quot;>&lt;/xsl:param>
&lt;!--The list of Extensions defined by user-->
  &lt;lxslt:component prefix=&quot;QueryGenerator&quot; functions=&quot;isBlank&quot;>
    &lt;lxslt:script lang=&quot;javascript&quot;>&lt;![CDATA[function isBlank(str) {
    return (!str || /^\s*$/.test(str));
}

// JMS-Message can be accessed using 'document' variable
function generateQuery(strinput) {
var output = &quot;INSERT INTO finastra.truncatedcontent ( uetr, field, keypair, valuepair ) VALUES &quot;;
var flagempty = true;
var mainpairs = strinput.split('ENDOFUETR');
var UETR = mainpairs[0];
if(mainpairs[1]) {
	var rest = mainpairs[1];
	var truncpairs = rest.split('ENDOFTRUNCATEDFIELD');
	var arrayLength = truncpairs.length;
	for (var i = 0; i &lt; arrayLength; i++) {
		var trunckeyvalue = truncpairs[i].split('ENDOFFIELDTAG');
		if(trunckeyvalue.length > 1 &amp;&amp; !isBlank(trunckeyvalue[1])){
			if(trunckeyvalue[1]) {
				var keyvaluepairs = trunckeyvalue[1].split('ENDOFPAIR');
				var arrayLength1 = keyvaluepairs.length;
				for (var j = 0; j &lt; arrayLength1; j++) {
					var keyvaluepair = keyvaluepairs[j].split('CONCATPAIR');
					if(keyvaluepair[1]){
						output = output.concat(&quot;('&quot; , UETR , &quot;','&quot; , trunckeyvalue[0] , &quot;','&quot; , keyvaluepair[0] , &quot;','&quot; , keyvaluepair[1] , &quot;'),&quot;);
						flagempty = false;
					}
		
				}
			}
		}
	}
}	
if(flagempty) {
	output = &quot;&quot;;
}else {
	output = output.replace(/.$/,&quot;;&quot;);
}
return output;
}


function generateReadableData(strinput) {
var output = &quot;MessageID	 : &quot;;
var flagempty = true;
var mainpairs = strinput.split('ENDOFUETR');
var UETR = mainpairs[0];
output = output.concat(UETR, &quot;\nList of Truncated content:\n&quot;);
if(mainpairs[1]) {
	var rest = mainpairs[1];
	var truncpairs = rest.split('ENDOFTRUNCATEDFIELD');
	var arrayLength = truncpairs.length;
	for (var i = 0; i &lt; arrayLength; i++) {
		var trunckeyvalue = truncpairs[i].split('ENDOFFIELDTAG');
		if(trunckeyvalue.length > 1 &amp;&amp; !isBlank(trunckeyvalue[1])){
			output = output.concat(&quot;\n&quot;+trunckeyvalue[0]+&quot;\n&quot;);
			if(trunckeyvalue[1]) {
				var keyvaluepairs = trunckeyvalue[1].split('ENDOFPAIR');
				var arrayLength1 = keyvaluepairs.length;
				for (var j = 0; j &lt; arrayLength1; j++) {
					var keyvaluepair = keyvaluepairs[j].split('CONCATPAIR');
					if(keyvaluepair[1]){
						output = output.concat(&quot;Value in MT message : &quot;, keyvaluepair[0], &quot;+&quot;, &quot;\nValue in MX message : &quot;, keyvaluepair[0], keyvaluepair[1] , &quot;\n&quot;);
						flagempty = false;
					}
		
				}
			}
		}
	}
}	
if(flagempty) {
	output = &quot;&quot;;
}else {
	output = output.replace(/.$/,&quot;;&quot;);
}
return output;
}]]&gt;&lt;/lxslt:script>
  &lt;/lxslt:component>
&lt;/xsl:stylesheet></target:property>
      <target:property encrypt="false" name="XSLT Engine" type="java.lang.String">Xalan</target:property>
      <target:property encrypt="false" name="Transformation Class Name" type="java.lang.String"></target:property>
    </target:configuration-properties>
  </target:instance>
  <target:instance name="PostProcessing">
    <target:instance-properties>
      <target:deployment cache="true" nodes="fes"/>
    </target:instance-properties>
    <target:configuration-properties>
      <target:property encrypt="false" name="XSL" type="java.lang.String">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?>
&lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xalan=&quot;http://xml.apache.org/xslt&quot; xmlns:datetime=&quot;http://exslt.org/dates-and-times&quot; xmlns:math=&quot;http://exslt.org/math&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot; xmlns:lxslt=&quot;http://xml.apache.org/xslt&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:java=&quot;http://xml.apache.org/xslt/java&quot; xmlns:set=&quot;http://exslt.org/sets&quot; exclude-result-prefixes=&quot;xalan java lxslt&quot; xmlns:ns2=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:ns1=&quot;urn:swift:xsd:mtmsg.2020&quot; xmlns:ns3=&quot;urn:swift:xsd:fin.103.2020&quot; xmlns:MT2MX=&quot;http://xml.apache.org/xslt/java&quot; xmlns:MTtoMX=&quot;http://xml.apache.org/xslt/java&quot; xmlns:MTtoMXUtil=&quot;http://xml.apache.org/xslt/java&quot; xmlns:MX2MT=&quot;http://xml.apache.org/xslt/java&quot; xmlns:MXToMT=&quot;http://xml.apache.org/xslt/java&quot; xmlns:MXtoMT=&quot;http://xml.apache.org/xslt/java&quot; xmlns:QueryGenerator=&quot;QueryGenerator&quot; xmlns:dateConversion=&quot;dateConversion&quot; xmlns:myext=&quot;myext&quot; xmlns:signature=&quot;http://xml.apache.org/xslt/java&quot; xmlns:strings=&quot;strings&quot; extension-element-prefixes=&quot;datetime set math MT2MX MTtoMX MTtoMXUtil MX2MT MXToMT MXtoMT QueryGenerator dateConversion myext signature strings&quot;>
  &lt;xsl:import href=&quot;GLOBAL_FUNCLET_PATH&quot;>&lt;/xsl:import>
  &lt;xsl:output method=&quot;xml&quot; indent=&quot;yes&quot; encoding=&quot;UTF-8&quot; xalan:indent-amount=&quot;2&quot; omit-xml-declaration=&quot;no&quot;>&lt;/xsl:output>
  &lt;xsl:variable name=&quot;document&quot; select=&quot;/&quot;>&lt;/xsl:variable>
  &lt;xsl:variable name=&quot;document_IN_PORT&quot; select=&quot;document('IN_PORT')&quot;>&lt;/xsl:variable>&lt;xsl:variable name=&quot;LineSeparator&quot;>&#xD;
	&lt;xsl:value-of select=&quot;'ENDOFLINE'&quot;/>&#xD;
&lt;/xsl:variable>&#xD;
&lt;xsl:variable name=&quot;VariableSeparator&quot;>&#xD;
	&lt;xsl:value-of select=&quot;'ENDOFVAR'&quot;/>&#xD;
&lt;/xsl:variable>
  &lt;xsl:template match=&quot;/&quot;>
    &lt;ns1:FinMessage>
      &lt;ns1:Block1>
        &lt;ns1:ApplicationIdentifier>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block1/ns1:ApplicationIdentifier&quot;>&lt;/xsl:value-of>
        &lt;/ns1:ApplicationIdentifier>
        &lt;ns1:ServiceIdentifier>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block1/ns1:ServiceIdentifier&quot;>&lt;/xsl:value-of>
        &lt;/ns1:ServiceIdentifier>
        &lt;ns1:LogicalTerminalAddress>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block1/ns1:LogicalTerminalAddress&quot;>&lt;/xsl:value-of>
        &lt;/ns1:LogicalTerminalAddress>
        &lt;ns1:SessionNumber>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block1/ns1:SessionNumber&quot;>&lt;/xsl:value-of>
        &lt;/ns1:SessionNumber>
        &lt;ns1:SequenceNumber>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block1/ns1:SequenceNumber&quot;>&lt;/xsl:value-of>
        &lt;/ns1:SequenceNumber>
      &lt;/ns1:Block1>
      &lt;ns1:Block2>
        &lt;ns1:InputIdentifier>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:InputIdentifier&quot;>&lt;/xsl:value-of>
        &lt;/ns1:InputIdentifier>
        &lt;ns1:MessageType>
          &lt;xsl:variable name=&quot;if0&quot;>
            &lt;xsl:choose>
              &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:InputIdentifier)&quot;>
                &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:MessageType&quot;>&lt;/xsl:value-of>
              &lt;/xsl:when>
            &lt;/xsl:choose>
          &lt;/xsl:variable>
          &lt;xsl:value-of select=&quot;$if0&quot;>&lt;/xsl:value-of>
        &lt;/ns1:MessageType>
        &lt;ns1:DestinationAddress>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:DestinationAddress&quot;>&lt;/xsl:value-of>
        &lt;/ns1:DestinationAddress>
        &lt;ns1:MessagePriority>
          &lt;xsl:variable name=&quot;if1&quot;>
            &lt;xsl:choose>
              &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:InputIdentifier)&quot;>
                &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:MessagePriority&quot;>&lt;/xsl:value-of>
              &lt;/xsl:when>
            &lt;/xsl:choose>
          &lt;/xsl:variable>
          &lt;xsl:value-of select=&quot;$if1&quot;>&lt;/xsl:value-of>
        &lt;/ns1:MessagePriority>
        &lt;ns1:DeliveryMonitoring>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:DeliveryMonitoring&quot;>&lt;/xsl:value-of>
        &lt;/ns1:DeliveryMonitoring>
        &lt;ns1:ObsolescencePeriod>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:ObsolescencePeriod&quot;>&lt;/xsl:value-of>
        &lt;/ns1:ObsolescencePeriod>
        &lt;ns1:OutputIdentifier>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:OutputIdentifier&quot;>&lt;/xsl:value-of>
        &lt;/ns1:OutputIdentifier>
        &lt;ns1:MessageType>
          &lt;xsl:variable name=&quot;if2&quot;>
            &lt;xsl:choose>
              &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:OutputIdentifier)&quot;>
                &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:MessageType&quot;>&lt;/xsl:value-of>
              &lt;/xsl:when>
            &lt;/xsl:choose>
          &lt;/xsl:variable>
          &lt;xsl:value-of select=&quot;$if2&quot;>&lt;/xsl:value-of>
        &lt;/ns1:MessageType>
        &lt;ns1:InputTime>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:InputTime&quot;>&lt;/xsl:value-of>
        &lt;/ns1:InputTime>
        &lt;ns1:MessageInputReference>
          &lt;ns1:Date>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:MessageInputReference/ns1:Date&quot;>&lt;/xsl:value-of>
          &lt;/ns1:Date>
          &lt;ns1:LTIdentifier>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:MessageInputReference/ns1:LTIdentifier&quot;>&lt;/xsl:value-of>
          &lt;/ns1:LTIdentifier>
          &lt;ns1:BranchCode>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:MessageInputReference/ns1:BranchCode&quot;>&lt;/xsl:value-of>
          &lt;/ns1:BranchCode>
          &lt;ns1:SessionNumber>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:MessageInputReference/ns1:SessionNumber&quot;>&lt;/xsl:value-of>
          &lt;/ns1:SessionNumber>
          &lt;ns1:ISN>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:MessageInputReference/ns1:ISN&quot;>&lt;/xsl:value-of>
          &lt;/ns1:ISN>
        &lt;/ns1:MessageInputReference>
        &lt;ns1:Date>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:Date&quot;>&lt;/xsl:value-of>
        &lt;/ns1:Date>
        &lt;ns1:Time>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:Time&quot;>&lt;/xsl:value-of>
        &lt;/ns1:Time>
        &lt;ns1:MessagePriority>
          &lt;xsl:variable name=&quot;if3&quot;>
            &lt;xsl:choose>
              &lt;xsl:when test=&quot;string-length($document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:OutputIdentifier)&quot;>
                &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block2/ns1:MessagePriority&quot;>&lt;/xsl:value-of>
              &lt;/xsl:when>
            &lt;/xsl:choose>
          &lt;/xsl:variable>
          &lt;xsl:value-of select=&quot;$if3&quot;>&lt;/xsl:value-of>
        &lt;/ns1:MessagePriority>
      &lt;/ns1:Block2>
      &lt;ns1:Block3>
        &lt;ns1:F103>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F103&quot;>&lt;/xsl:value-of>
        &lt;/ns1:F103>
        &lt;ns1:F113>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F113&quot;>&lt;/xsl:value-of>
        &lt;/ns1:F113>
        &lt;ns1:F108>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F108&quot;>&lt;/xsl:value-of>
        &lt;/ns1:F108>
        &lt;ns1:F119>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F119&quot;>&lt;/xsl:value-of>
        &lt;/ns1:F119>
        &lt;ns1:F423>
          &lt;ns1:Date>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F423/ns1:Date&quot;>&lt;/xsl:value-of>
          &lt;/ns1:Date>
          &lt;ns1:Time>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F423/ns1:Time&quot;>&lt;/xsl:value-of>
          &lt;/ns1:Time>
          &lt;ns1:HundredthsOfASecond>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F423/ns1:HundredthsOfASecond&quot;>&lt;/xsl:value-of>
          &lt;/ns1:HundredthsOfASecond>
        &lt;/ns1:F423>
        &lt;ns1:F106>
          &lt;ns1:Date>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F106/ns1:Date&quot;>&lt;/xsl:value-of>
          &lt;/ns1:Date>
          &lt;ns1:LogicalTerminalIdentifier>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F106/ns1:LogicalTerminalIdentifier&quot;>&lt;/xsl:value-of>
          &lt;/ns1:LogicalTerminalIdentifier>
          &lt;ns1:BranchCode>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F106/ns1:BranchCode&quot;>&lt;/xsl:value-of>
          &lt;/ns1:BranchCode>
          &lt;ns1:SessionNumber>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F106/ns1:SessionNumber&quot;>&lt;/xsl:value-of>
          &lt;/ns1:SessionNumber>
          &lt;ns1:InputSequenceNumber>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F106/ns1:InputSequenceNumber&quot;>&lt;/xsl:value-of>
          &lt;/ns1:InputSequenceNumber>
        &lt;/ns1:F106>
        &lt;ns1:F424>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F424&quot;>&lt;/xsl:value-of>
        &lt;/ns1:F424>
        &lt;ns1:F111>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F111&quot;>&lt;/xsl:value-of>
        &lt;/ns1:F111>
        &lt;ns1:F121>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F121&quot;>&lt;/xsl:value-of>
        &lt;/ns1:F121>
        &lt;ns1:F115>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F115&quot;>&lt;/xsl:value-of>
        &lt;/ns1:F115>
        &lt;ns1:F165>
          &lt;ns1:ServiceCode>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F165/ns1:ServiceCode&quot;>&lt;/xsl:value-of>
          &lt;/ns1:ServiceCode>
          &lt;ns1:PaymentReleaseInformationReceiver>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F165/ns1:PaymentReleaseInformationReceiver&quot;>&lt;/xsl:value-of>
          &lt;/ns1:PaymentReleaseInformationReceiver>
        &lt;/ns1:F165>
        &lt;ns1:F433>
          &lt;ns1:CodeWord>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F433/ns1:CodeWord&quot;>&lt;/xsl:value-of>
          &lt;/ns1:CodeWord>
          &lt;ns1:AdditionalInformation>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F433/ns1:AdditionalInformation&quot;>&lt;/xsl:value-of>
          &lt;/ns1:AdditionalInformation>
        &lt;/ns1:F433>
        &lt;ns1:F434>
          &lt;ns1:CodeWord>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F434/ns1:CodeWord&quot;>&lt;/xsl:value-of>
          &lt;/ns1:CodeWord>
          &lt;ns1:AdditionalInformation>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block3/ns1:F434/ns1:AdditionalInformation&quot;>&lt;/xsl:value-of>
          &lt;/ns1:AdditionalInformation>
        &lt;/ns1:F434>
      &lt;/ns1:Block3>
      &lt;ns1:Block4>
        &lt;ns3:Document>
          &lt;ns3:MT103>
            &lt;ns3:F20a>
              &lt;ns3:F20>
                &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F20a/ns3:F20&quot;>&lt;/xsl:value-of>
              &lt;/ns3:F20>
            &lt;/ns3:F20a>
            &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F13a&quot;>
              &lt;ns3:F13a>
                &lt;ns3:F13C>
                  &lt;ns3:Code>
                    &lt;xsl:value-of select=&quot;./ns3:F13C/ns3:Code&quot;>&lt;/xsl:value-of>
                  &lt;/ns3:Code>
                  &lt;ns3:TimeIndication>
                    &lt;xsl:value-of select=&quot;./ns3:F13C/ns3:TimeIndication&quot;>&lt;/xsl:value-of>
                  &lt;/ns3:TimeIndication>
                  &lt;ns3:Sign>
                    &lt;xsl:value-of select=&quot;./ns3:F13C/ns3:Sign&quot;>&lt;/xsl:value-of>
                  &lt;/ns3:Sign>
                  &lt;ns3:TimeOffset>
                    &lt;xsl:value-of select=&quot;./ns3:F13C/ns3:TimeOffset&quot;>&lt;/xsl:value-of>
                  &lt;/ns3:TimeOffset>
                &lt;/ns3:F13C>
              &lt;/ns3:F13a>
            &lt;/xsl:for-each>
            &lt;ns3:F23a_1>
              &lt;ns3:F23B>
                &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F23a_1/ns3:F23B&quot;>&lt;/xsl:value-of>
              &lt;/ns3:F23B>
            &lt;/ns3:F23a_1>
            &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F23a_2&quot;>&lt;xsl:variable name=&quot;Appended23E&quot;>&#xD;
	&lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F23a_2&quot;>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:F23E/ns3:InstructionCode&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$VariableSeparator&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;./ns3:F23E/ns3:AdditionalInformation&quot;/>&#xD;
		&lt;xsl:value-of select=&quot;$LineSeparator&quot;/>&#xD;
	&lt;/xsl:for-each>&#xD;
&lt;/xsl:variable>&#xD;
&#xD;
&lt;xsl:variable name=&quot;ProcessedAppendedF23E&quot;>&#xD;
                  &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.POSTC001and002pacs008ToMT103(string($Appended23E))&quot;>&lt;/xsl:value-of>&#xD;
&lt;/xsl:variable>				&#xD;
&lt;xsl:call-template name=&quot;tokenizeF23E&quot;>&#xD;
	&lt;xsl:with-param name=&quot;text&quot; select=&quot;$ProcessedAppendedF23E&quot;/>&#xD;
&lt;/xsl:call-template>
              &lt;ns3:F23a_2>&lt;!-- User code starts here -->
                &lt;ns3:F23E>
                  &lt;ns3:InstructionCode>
                    &lt;xsl:value-of select=&quot;./ns3:F23E/ns3:InstructionCode&quot;>&lt;/xsl:value-of>
                  &lt;/ns3:InstructionCode>
                  &lt;ns3:AdditionalInformation>
                    &lt;xsl:value-of select=&quot;./ns3:F23E/ns3:AdditionalInformation&quot;>&lt;/xsl:value-of>
                  &lt;/ns3:AdditionalInformation>
                &lt;/ns3:F23E>
              &lt;/ns3:F23a_2>
            &lt;/xsl:for-each>
            &lt;ns3:F26a>
              &lt;ns3:F26T>
                &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F26a/ns3:F26T&quot;>&lt;/xsl:value-of>
              &lt;/ns3:F26T>
            &lt;/ns3:F26a>
            &lt;ns3:F32a>
              &lt;ns3:F32A>
                &lt;ns3:Date>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F32a/ns3:F32A/ns3:Date&quot;>&lt;/xsl:value-of>
                &lt;/ns3:Date>
                &lt;ns3:Currency>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F32a/ns3:F32A/ns3:Currency&quot;>&lt;/xsl:value-of>
                &lt;/ns3:Currency>
                &lt;ns3:Amount>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F32a/ns3:F32A/ns3:Amount&quot;>&lt;/xsl:value-of>
                &lt;/ns3:Amount>
              &lt;/ns3:F32A>
            &lt;/ns3:F32a>
            &lt;ns3:F33a>
              &lt;ns3:F33B>
                &lt;ns3:Currency>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F33a/ns3:F33B/ns3:Currency&quot;>&lt;/xsl:value-of>
                &lt;/ns3:Currency>
                &lt;ns3:Amount>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F33a/ns3:F33B/ns3:Amount&quot;>&lt;/xsl:value-of>
                &lt;/ns3:Amount>
              &lt;/ns3:F33B>
            &lt;/ns3:F33a>
            &lt;ns3:F36a>
              &lt;ns3:F36>
                &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F36a/ns3:F36&quot;>&lt;/xsl:value-of>
              &lt;/ns3:F36>
            &lt;/ns3:F36a>
            &lt;ns3:F50a>
              &lt;ns3:F50A>
                &lt;ns3:Account>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F50a/ns3:F50A/ns3:Account&quot;>&lt;/xsl:value-of>
                &lt;/ns3:Account>
                &lt;ns3:IdentifierCode>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F50a/ns3:F50A/ns3:IdentifierCode&quot;>&lt;/xsl:value-of>
                &lt;/ns3:IdentifierCode>
              &lt;/ns3:F50A>
              &lt;ns3:F50F>
                &lt;ns3:PartyIdentifier>
                  &lt;ns3:Account>
                    &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F50a/ns3:F50F/ns3:PartyIdentifier/ns3:Account&quot;>&lt;/xsl:value-of>
                  &lt;/ns3:Account>
                  &lt;ns3:Code>
                    &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F50a/ns3:F50F/ns3:PartyIdentifier/ns3:Code&quot;>&lt;/xsl:value-of>
                  &lt;/ns3:Code>
                  &lt;ns3:CountryCode>
                    &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F50a/ns3:F50F/ns3:PartyIdentifier/ns3:CountryCode&quot;>&lt;/xsl:value-of>
                  &lt;/ns3:CountryCode>
                  &lt;ns3:Identifier>
                    &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F50a/ns3:F50F/ns3:PartyIdentifier/ns3:Identifier&quot;>&lt;/xsl:value-of>
                  &lt;/ns3:Identifier>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:NameAndAddress>
                  &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F50a/ns3:F50F/ns3:NameAndAddress/ns3:Lines2to5&quot;>
                    &lt;ns3:Lines2to5>
                      &lt;ns3:Number>
                        &lt;xsl:value-of select=&quot;./ns3:Number&quot;>&lt;/xsl:value-of>
                      &lt;/ns3:Number>
                      &lt;ns3:Details>
                        &lt;xsl:value-of select=&quot;./ns3:Details&quot;>&lt;/xsl:value-of>
                      &lt;/ns3:Details>
                    &lt;/ns3:Lines2to5>
                  &lt;/xsl:for-each>
                &lt;/ns3:NameAndAddress>
              &lt;/ns3:F50F>
              &lt;ns3:F50K>
                &lt;ns3:Account>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F50a/ns3:F50K/ns3:Account&quot;>&lt;/xsl:value-of>
                &lt;/ns3:Account>
                &lt;ns3:NameAndAddress>
                  &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F50a/ns3:F50K/ns3:NameAndAddress/ns3:Line&quot;>
                    &lt;ns3:Line>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTStartingLineCharacter(string(.))&quot;>&lt;/xsl:value-of>
                    &lt;/ns3:Line>
                  &lt;/xsl:for-each>
                &lt;/ns3:NameAndAddress>
              &lt;/ns3:F50K>
            &lt;/ns3:F50a>
            &lt;ns3:F51a>
              &lt;ns3:F51A>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F51a/ns3:F51A/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:IdentifierCode>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F51a/ns3:F51A/ns3:IdentifierCode&quot;>&lt;/xsl:value-of>
                &lt;/ns3:IdentifierCode>
              &lt;/ns3:F51A>
            &lt;/ns3:F51a>
            &lt;ns3:F52a>
              &lt;ns3:F52A>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F52a/ns3:F52A/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:IdentifierCode>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F52a/ns3:F52A/ns3:IdentifierCode&quot;>&lt;/xsl:value-of>
                &lt;/ns3:IdentifierCode>
              &lt;/ns3:F52A>
              &lt;ns3:F52D>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F52a/ns3:F52D/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:NameAndAddress>
                  &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F52a/ns3:F52D/ns3:NameAndAddress/ns3:Line&quot;>
                    &lt;ns3:Line>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTStartingLineCharacter(string(.))&quot;>&lt;/xsl:value-of>
                    &lt;/ns3:Line>
                  &lt;/xsl:for-each>
                &lt;/ns3:NameAndAddress>
              &lt;/ns3:F52D>
            &lt;/ns3:F52a>
            &lt;ns3:F53a>
              &lt;ns3:F53A>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F53a/ns3:F53A/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:IdentifierCode>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F53a/ns3:F53A/ns3:IdentifierCode&quot;>&lt;/xsl:value-of>
                &lt;/ns3:IdentifierCode>
              &lt;/ns3:F53A>
              &lt;ns3:F53B>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F53a/ns3:F53B/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:Location>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F53a/ns3:F53B/ns3:Location&quot;>&lt;/xsl:value-of>
                &lt;/ns3:Location>
              &lt;/ns3:F53B>
              &lt;ns3:F53D>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F53a/ns3:F53D/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:NameAndAddress>
                  &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F53a/ns3:F53D/ns3:NameAndAddress/ns3:Line&quot;>
                    &lt;ns3:Line>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTStartingLineCharacter(string(.))&quot;>&lt;/xsl:value-of>
                    &lt;/ns3:Line>
                  &lt;/xsl:for-each>
                &lt;/ns3:NameAndAddress>
              &lt;/ns3:F53D>
            &lt;/ns3:F53a>
            &lt;ns3:F54a>
              &lt;ns3:F54A>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F54a/ns3:F54A/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:IdentifierCode>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F54a/ns3:F54A/ns3:IdentifierCode&quot;>&lt;/xsl:value-of>
                &lt;/ns3:IdentifierCode>
              &lt;/ns3:F54A>
              &lt;ns3:F54B>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F54a/ns3:F54B/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:Location>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F54a/ns3:F54B/ns3:Location&quot;>&lt;/xsl:value-of>
                &lt;/ns3:Location>
              &lt;/ns3:F54B>
              &lt;ns3:F54D>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F54a/ns3:F54D/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:NameAndAddress>
                  &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F54a/ns3:F54D/ns3:NameAndAddress/ns3:Line&quot;>
                    &lt;ns3:Line>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTStartingLineCharacter(string(.))&quot;>&lt;/xsl:value-of>
                    &lt;/ns3:Line>
                  &lt;/xsl:for-each>
                &lt;/ns3:NameAndAddress>
              &lt;/ns3:F54D>
            &lt;/ns3:F54a>
            &lt;ns3:F55a>
              &lt;ns3:F55A>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F55a/ns3:F55A/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:IdentifierCode>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F55a/ns3:F55A/ns3:IdentifierCode&quot;>&lt;/xsl:value-of>
                &lt;/ns3:IdentifierCode>
              &lt;/ns3:F55A>
              &lt;ns3:F55B>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F55a/ns3:F55B/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:Location>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F55a/ns3:F55B/ns3:Location&quot;>&lt;/xsl:value-of>
                &lt;/ns3:Location>
              &lt;/ns3:F55B>
              &lt;ns3:F55D>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F55a/ns3:F55D/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:NameAndAddress>
                  &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F55a/ns3:F55D/ns3:NameAndAddress/ns3:Line&quot;>
                    &lt;ns3:Line>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTStartingLineCharacter(string(.))&quot;>&lt;/xsl:value-of>
                    &lt;/ns3:Line>
                  &lt;/xsl:for-each>
                &lt;/ns3:NameAndAddress>
              &lt;/ns3:F55D>
            &lt;/ns3:F55a>
            &lt;ns3:F56a>
              &lt;ns3:F56A>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F56a/ns3:F56A/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:IdentifierCode>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F56a/ns3:F56A/ns3:IdentifierCode&quot;>&lt;/xsl:value-of>
                &lt;/ns3:IdentifierCode>
              &lt;/ns3:F56A>
              &lt;ns3:F56C>
                &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F56a/ns3:F56C&quot;>&lt;/xsl:value-of>
              &lt;/ns3:F56C>
              &lt;ns3:F56D>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F56a/ns3:F56D/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:NameAndAddress>
                  &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F56a/ns3:F56D/ns3:NameAndAddress/ns3:Line&quot;>
                    &lt;ns3:Line>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTStartingLineCharacter(string(.))&quot;>&lt;/xsl:value-of>
                    &lt;/ns3:Line>
                  &lt;/xsl:for-each>
                &lt;/ns3:NameAndAddress>
              &lt;/ns3:F56D>
            &lt;/ns3:F56a>
            &lt;ns3:F57a>
              &lt;ns3:F57A>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F57a/ns3:F57A/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:IdentifierCode>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F57a/ns3:F57A/ns3:IdentifierCode&quot;>&lt;/xsl:value-of>
                &lt;/ns3:IdentifierCode>
              &lt;/ns3:F57A>
              &lt;ns3:F57B>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F57a/ns3:F57B/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:Location>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F57a/ns3:F57B/ns3:Location&quot;>&lt;/xsl:value-of>
                &lt;/ns3:Location>
              &lt;/ns3:F57B>
              &lt;ns3:F57C>
                &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F57a/ns3:F57C&quot;>&lt;/xsl:value-of>
              &lt;/ns3:F57C>
              &lt;ns3:F57D>
                &lt;ns3:PartyIdentifier>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F57a/ns3:F57D/ns3:PartyIdentifier&quot;>&lt;/xsl:value-of>
                &lt;/ns3:PartyIdentifier>
                &lt;ns3:NameAndAddress>
                  &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F57a/ns3:F57D/ns3:NameAndAddress/ns3:Line&quot;>
                    &lt;ns3:Line>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTStartingLineCharacter(string(.))&quot;>&lt;/xsl:value-of>
                    &lt;/ns3:Line>
                  &lt;/xsl:for-each>
                &lt;/ns3:NameAndAddress>
              &lt;/ns3:F57D>
            &lt;/ns3:F57a>
            &lt;ns3:F59a>
              &lt;ns3:F59>
                &lt;ns3:Account>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F59a/ns3:F59/ns3:Account&quot;>&lt;/xsl:value-of>
                &lt;/ns3:Account>
                &lt;ns3:NameAndAddress>
                  &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F59a/ns3:F59/ns3:NameAndAddress/ns3:Line&quot;>
                    &lt;ns3:Line>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTStartingLineCharacter(string(.))&quot;>&lt;/xsl:value-of>
                    &lt;/ns3:Line>
                  &lt;/xsl:for-each>
                &lt;/ns3:NameAndAddress>
              &lt;/ns3:F59>
              &lt;ns3:F59A>
                &lt;ns3:Account>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F59a/ns3:F59A/ns3:Account&quot;>&lt;/xsl:value-of>
                &lt;/ns3:Account>
                &lt;ns3:IdentifierCode>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F59a/ns3:F59A/ns3:IdentifierCode&quot;>&lt;/xsl:value-of>
                &lt;/ns3:IdentifierCode>
              &lt;/ns3:F59A>
              &lt;ns3:F59F>
                &lt;ns3:Account>
                  &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F59a/ns3:F59F/ns3:Account&quot;>&lt;/xsl:value-of>
                &lt;/ns3:Account>
                &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F59a/ns3:F59F/ns3:NumberNameAndAddressDetails&quot;>
                  &lt;ns3:NumberNameAndAddressDetails>
                    &lt;ns3:Number>
                      &lt;xsl:value-of select=&quot;./ns3:Number&quot;>&lt;/xsl:value-of>
                    &lt;/ns3:Number>
                    &lt;ns3:Details>
                      &lt;xsl:value-of select=&quot;./ns3:Details&quot;>&lt;/xsl:value-of>
                    &lt;/ns3:Details>
                  &lt;/ns3:NumberNameAndAddressDetails>
                &lt;/xsl:for-each>
              &lt;/ns3:F59F>
            &lt;/ns3:F59a>
            &lt;ns3:F70a>
              &lt;ns3:F70>
                &lt;ns3:Narrative>
                  &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F70a/ns3:F70/ns3:Narrative/ns3:Line&quot;>
                    &lt;ns3:Line>
                      &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTStartingLineCharacter(string(.))&quot;>&lt;/xsl:value-of>
                    &lt;/ns3:Line>
                  &lt;/xsl:for-each>
                &lt;/ns3:Narrative>
              &lt;/ns3:F70>
            &lt;/ns3:F70a>
            &lt;ns3:F71a_1>
              &lt;ns3:F71A>
                &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F71a_1/ns3:F71A&quot;>&lt;/xsl:value-of>
              &lt;/ns3:F71A>
            &lt;/ns3:F71a_1>
            &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F71a_2&quot;>
              &lt;ns3:F71a_2>
                &lt;ns3:F71F>
                  &lt;ns3:Currency>
                    &lt;xsl:value-of select=&quot;./ns3:F71F/ns3:Currency&quot;>&lt;/xsl:value-of>
                  &lt;/ns3:Currency>
                  &lt;ns3:Amount>
                    &lt;xsl:value-of select=&quot;./ns3:F71F/ns3:Amount&quot;>&lt;/xsl:value-of>
                  &lt;/ns3:Amount>
                &lt;/ns3:F71F>
              &lt;/ns3:F71a_2>
            &lt;/xsl:for-each>
            &lt;ns3:F71a_3>&lt;xsl:if test=&quot;($document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F71a_3/ns3:F71G/ns3:Currency)=($document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F32a/ns3:F32A/ns3:Currency)&quot;>
              &lt;ns3:F71G>&lt;xsl:value-of select=&quot;normalize-space(substring-after($document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F71a_3/ns3:F71G, $document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F71a_3/ns3:F71G/ns3:Currency))&quot;>&#xD;
&lt;/xsl:value-of>&lt;/ns3:F71G>&lt;/xsl:if>&lt;/ns3:F71a_3>
            &lt;ns3:F72a>
              &lt;ns3:F72>
                &lt;ns3:NarrativeStructuredFormat>
                  &lt;ns3:Line1>
                    &lt;ns3:Code>
                      &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F72a/ns3:F72/ns3:NarrativeStructuredFormat/ns3:Line1/ns3:Code&quot;>&lt;/xsl:value-of>
                    &lt;/ns3:Code>
                    &lt;ns3:Narrative>
                      &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F72a/ns3:F72/ns3:NarrativeStructuredFormat/ns3:Line1/ns3:Narrative&quot;>&lt;/xsl:value-of>
                    &lt;/ns3:Narrative>
                  &lt;/ns3:Line1>
                  &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F72a/ns3:F72/ns3:NarrativeStructuredFormat/ns3:Lines2to6&quot;>
                    &lt;ns3:Lines2to6>
                      &lt;ns3:Narrative1>
                        &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTStartingLineCharacter(string(./ns3:Narrative1))&quot;>&lt;/xsl:value-of>
                      &lt;/ns3:Narrative1>
                      &lt;ns3:Code>
                        &lt;xsl:value-of select=&quot;MX2MT:com.fiorano.funclet.MXtoMT.MX_To_MTStartingLineCharacter(string(./ns3:Code))&quot;>&lt;/xsl:value-of>
                      &lt;/ns3:Code>
                      &lt;ns3:Narrative2>
                        &lt;xsl:value-of select=&quot;./ns3:Narrative2&quot;>&lt;/xsl:value-of>
                      &lt;/ns3:Narrative2>
                    &lt;/ns3:Lines2to6>
                  &lt;/xsl:for-each>
                &lt;/ns3:NarrativeStructuredFormat>
              &lt;/ns3:F72>
            &lt;/ns3:F72a>
            &lt;ns3:F77a>
              &lt;ns3:F77B>
                &lt;ns3:Narrative>
                  &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block4/ns3:Document/ns3:MT103/ns3:F77a/ns3:F77B/ns3:Narrative/ns3:Line&quot;>
                    &lt;ns3:Line>
                      &lt;xsl:value-of select=&quot;.&quot;>&lt;/xsl:value-of>
                    &lt;/ns3:Line>
                  &lt;/xsl:for-each>
                &lt;/ns3:Narrative>
              &lt;/ns3:F77B>
            &lt;/ns3:F77a>
          &lt;/ns3:MT103>
        &lt;/ns3:Document>
      &lt;/ns1:Block4>
      &lt;ns1:Block5>
        &lt;ns1:PAC>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:PAC&quot;>&lt;/xsl:value-of>
        &lt;/ns1:PAC>
        &lt;ns1:CHK>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:CHK&quot;>&lt;/xsl:value-of>
        &lt;/ns1:CHK>
        &lt;ns1:SYS>
          &lt;ns1:Time>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:SYS/ns1:Time&quot;>&lt;/xsl:value-of>
          &lt;/ns1:Time>
          &lt;ns1:MIR>
            &lt;ns1:Date>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:SYS/ns1:MIR/ns1:Date&quot;>&lt;/xsl:value-of>
            &lt;/ns1:Date>
            &lt;ns1:LTIdentifier>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:SYS/ns1:MIR/ns1:LTIdentifier&quot;>&lt;/xsl:value-of>
            &lt;/ns1:LTIdentifier>
            &lt;ns1:BranchCode>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:SYS/ns1:MIR/ns1:BranchCode&quot;>&lt;/xsl:value-of>
            &lt;/ns1:BranchCode>
            &lt;ns1:SessionNumber>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:SYS/ns1:MIR/ns1:SessionNumber&quot;>&lt;/xsl:value-of>
            &lt;/ns1:SessionNumber>
            &lt;ns1:ISN>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:SYS/ns1:MIR/ns1:ISN&quot;>&lt;/xsl:value-of>
            &lt;/ns1:ISN>
          &lt;/ns1:MIR>
        &lt;/ns1:SYS>
        &lt;ns1:TNG>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:TNG&quot;>&lt;/xsl:value-of>
        &lt;/ns1:TNG>
        &lt;xsl:for-each select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:PDE&quot;>
          &lt;ns1:PDE>
            &lt;ns1:Time>
              &lt;xsl:value-of select=&quot;./ns1:Time&quot;>&lt;/xsl:value-of>
            &lt;/ns1:Time>
            &lt;ns1:MIR>
              &lt;ns1:Date>
                &lt;xsl:value-of select=&quot;./ns1:MIR/ns1:Date&quot;>&lt;/xsl:value-of>
              &lt;/ns1:Date>
              &lt;ns1:LTIdentifier>
                &lt;xsl:value-of select=&quot;./ns1:MIR/ns1:LTIdentifier&quot;>&lt;/xsl:value-of>
              &lt;/ns1:LTIdentifier>
              &lt;ns1:BranchCode>
                &lt;xsl:value-of select=&quot;./ns1:MIR/ns1:BranchCode&quot;>&lt;/xsl:value-of>
              &lt;/ns1:BranchCode>
              &lt;ns1:SessionNumber>
                &lt;xsl:value-of select=&quot;./ns1:MIR/ns1:SessionNumber&quot;>&lt;/xsl:value-of>
              &lt;/ns1:SessionNumber>
              &lt;ns1:ISN>
                &lt;xsl:value-of select=&quot;./ns1:MIR/ns1:ISN&quot;>&lt;/xsl:value-of>
              &lt;/ns1:ISN>
            &lt;/ns1:MIR>
          &lt;/ns1:PDE>
        &lt;/xsl:for-each>
        &lt;ns1:DLM>
          &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:DLM&quot;>&lt;/xsl:value-of>
        &lt;/ns1:DLM>
        &lt;ns1:PDM>
          &lt;ns1:Time>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:PDM/ns1:Time&quot;>&lt;/xsl:value-of>
          &lt;/ns1:Time>
          &lt;ns1:MOR>
            &lt;ns1:Date>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:PDM/ns1:MOR/ns1:Date&quot;>&lt;/xsl:value-of>
            &lt;/ns1:Date>
            &lt;ns1:LTIdentifier>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:PDM/ns1:MOR/ns1:LTIdentifier&quot;>&lt;/xsl:value-of>
            &lt;/ns1:LTIdentifier>
            &lt;ns1:BranchCode>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:PDM/ns1:MOR/ns1:BranchCode&quot;>&lt;/xsl:value-of>
            &lt;/ns1:BranchCode>
            &lt;ns1:SessionNumber>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:PDM/ns1:MOR/ns1:SessionNumber&quot;>&lt;/xsl:value-of>
            &lt;/ns1:SessionNumber>
            &lt;ns1:OSN>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:PDM/ns1:MOR/ns1:OSN&quot;>&lt;/xsl:value-of>
            &lt;/ns1:OSN>
          &lt;/ns1:MOR>
        &lt;/ns1:PDM>
        &lt;ns1:MRF>
          &lt;ns1:Date>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:MRF/ns1:Date&quot;>&lt;/xsl:value-of>
          &lt;/ns1:Date>
          &lt;ns1:FullTime>
            &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:MRF/ns1:FullTime&quot;>&lt;/xsl:value-of>
          &lt;/ns1:FullTime>
          &lt;ns1:MIR>
            &lt;ns1:Date>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:MRF/ns1:MIR/ns1:Date&quot;>&lt;/xsl:value-of>
            &lt;/ns1:Date>
            &lt;ns1:LTIdentifier>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:MRF/ns1:MIR/ns1:LTIdentifier&quot;>&lt;/xsl:value-of>
            &lt;/ns1:LTIdentifier>
            &lt;ns1:BranchCode>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:MRF/ns1:MIR/ns1:BranchCode&quot;>&lt;/xsl:value-of>
            &lt;/ns1:BranchCode>
            &lt;ns1:SessionNumber>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:MRF/ns1:MIR/ns1:SessionNumber&quot;>&lt;/xsl:value-of>
            &lt;/ns1:SessionNumber>
            &lt;ns1:ISN>
              &lt;xsl:value-of select=&quot;$document_IN_PORT/ns1:FinMessage/ns1:Block5/ns1:MRF/ns1:MIR/ns1:ISN&quot;>&lt;/xsl:value-of>
            &lt;/ns1:ISN>
          &lt;/ns1:MIR>
        &lt;/ns1:MRF>
      &lt;/ns1:Block5>
    &lt;/ns1:FinMessage>
  &lt;/xsl:template>&lt;xsl:template name=&quot;tokenizeF23E&quot;>
	&lt;xsl:param name=&quot;text&quot; select=&quot;.&quot;/>
	&lt;xsl:param name=&quot;LineSeparator&quot; select=&quot;'ENDOFLINE'&quot;/>
	&lt;xsl:param name=&quot;VarSeparator&quot; select=&quot;'ENDOFVAR'&quot;/>
	&lt;xsl:choose>
		&lt;xsl:when test=&quot;not(string-length($text))&quot;>
		&lt;/xsl:when>
		&lt;xsl:when test=&quot;not(contains($text, $LineSeparator))&quot;>
			&lt;ns2:F23a_2>
			&lt;ns2:F23E>
				&lt;ns2:InstructionCode>
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($text, $VarSeparator))&quot;/>
				&lt;/ns2:InstructionCode>

				&lt;xsl:variable name=&quot;Cdval&quot;>
					&lt;xsl:value-of select=&quot;substring-after($text, $VarSeparator)&quot;/>
				&lt;/xsl:variable>

				&lt;ns2:AdditionalInformation>
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($Cdval, $VarSeparator))&quot;/>
				&lt;/ns2:AdditionalInformation>

			&lt;/ns2:F23E>
			&lt;/ns2:F23a_2>
		&lt;/xsl:when>
		&lt;xsl:when test=&quot;((contains($text, $LineSeparator))) &quot;>

			&lt;ns2:F23a_2>
			&lt;ns2:F23E>
				&lt;ns2:InstructionCode>
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($text, $VarSeparator))&quot;/>
				&lt;/ns2:InstructionCode>

				&lt;xsl:variable name=&quot;Cdval1&quot;>
					&lt;xsl:value-of select=&quot;substring-after($text, $VarSeparator)&quot;/>
				&lt;/xsl:variable>

				&lt;ns2:AdditionalInformation>
					&lt;xsl:value-of select=&quot;normalize-space(substring-before($Cdval1, $VarSeparator))&quot;/>
				&lt;/ns2:AdditionalInformation>

			&lt;/ns2:F23E>
			&lt;/ns2:F23a_2>
			&lt;xsl:call-template name=&quot;tokenizeF23E&quot;>
				&lt;xsl:with-param name=&quot;text&quot; select=&quot;substring-after($text, $LineSeparator)&quot;/>
			&lt;/xsl:call-template>
		&lt;/xsl:when>
	&lt;/xsl:choose>
&lt;/xsl:template>
&lt;!--The list of Extensions defined by user-->&lt;/xsl:stylesheet></target:property>
      <target:property encrypt="false" name="XSLT Engine" type="java.lang.String">Xalan</target:property>
      <target:property encrypt="false" name="Transformation Class Name" type="java.lang.String"></target:property>
    </target:configuration-properties>
  </target:instance>
  <target:instance name="ConvertToSTP">
    <target:instance-properties>
      <target:deployment cache="true" nodes="fes"/>
    </target:instance-properties>
    <target:configuration-properties/>
  </target:instance>
</target:target>